import './polyfills.server.mjs';
import{b as kS,d as xS,e as xo,f as bd,g as MS,h as PS,j as Id,k as je,l as LS,m as dn,n as FS,o as BS,p as qS,q as US,r as VS,t as Ad}from"./chunk-FDUMXABO.mjs";import{c as ae,f as T,h as OS,i as Cd,j as g}from"./chunk-H6KHSOBK.mjs";var ie=T(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Bt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Bt.Propagate=Bt.LogVerbosity=Bt.Status=void 0;var iE=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(iE||(Bt.Status=iE={})),sE=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(sE||(Bt.LogVerbosity=sE={})),oE=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(oE||(Bt.Propagate=oE={}));Bt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Bt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var vf=T((fV,eD)=>{eD.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ae=T(St=>{"use strict";var Sf,Tf,Ef,wf;Object.defineProperty(St,"__esModule",{value:!0});St.isTracerEnabled=St.trace=St.log=St.setLoggerVerbosity=St.setLogger=St.getLogger=void 0;var lr=ie(),tD=ae("process"),nD=vf().version,rD={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},ui=rD,es=lr.LogVerbosity.ERROR,iD=(Tf=(Sf=process.env.GRPC_NODE_VERBOSITY)!==null&&Sf!==void 0?Sf:process.env.GRPC_VERBOSITY)!==null&&Tf!==void 0?Tf:"";switch(iD.toUpperCase()){case"DEBUG":es=lr.LogVerbosity.DEBUG;break;case"INFO":es=lr.LogVerbosity.INFO;break;case"ERROR":es=lr.LogVerbosity.ERROR;break;case"NONE":es=lr.LogVerbosity.NONE;break;default:}var sD=()=>ui;St.getLogger=sD;var oD=n=>{ui=n};St.setLogger=oD;var aD=n=>{es=n};St.setLoggerVerbosity=aD;var lD=(n,...e)=>{let t;if(n>=es){switch(n){case lr.LogVerbosity.DEBUG:t=ui.debug;break;case lr.LogVerbosity.INFO:t=ui.info;break;case lr.LogVerbosity.ERROR:t=ui.error;break}t||(t=ui.error),t&&t.bind(ui)(...e)}};St.log=lD;var cD=(wf=(Ef=process.env.GRPC_NODE_TRACE)!==null&&Ef!==void 0?Ef:process.env.GRPC_TRACE)!==null&&wf!==void 0?wf:"",_f=new Set,aE=new Set;for(let n of cD.split(","))n.startsWith("-")?aE.add(n.substring(1)):_f.add(n);var uD=_f.has("all");function hD(n,e,t){lE(e)&&(0,St.log)(n,new Date().toISOString()+" | v"+nD+" "+tD.pid+" | "+e+" | "+t)}St.trace=hD;function lE(n){return!aE.has(n)&&(uD||_f.has(n))}St.isTracerEnabled=lE});var ac=T(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.getErrorCode=ts.getErrorMessage=void 0;function dD(n){return n instanceof Error?n.message:String(n)}ts.getErrorMessage=dD;function fD(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}ts.getErrorCode=fD});var Tt=T(cc=>{"use strict";Object.defineProperty(cc,"__esModule",{value:!0});cc.Metadata=void 0;var pD=Ae(),gD=ie(),mD=ac(),yD=/^[0-9a-z_.-]+$/,vD=/^[ -~]*$/;function SD(n){return yD.test(n)}function TD(n){return vD.test(n)}function uE(n){return n.endsWith("-bin")}function ED(n){return!n.startsWith("grpc-")}function lc(n){return n.toLowerCase()}function cE(n,e){if(!SD(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(uE(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!TD(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Cf=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=lc(e),cE(e,t),this.internalRepr.set(e,[t])}add(e,t){e=lc(e),cE(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=lc(e),this.internalRepr.delete(e)}get(e){return e=lc(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(wD);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{uE(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(ED(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,mD.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,pD.log)(gD.LogVerbosity.ERROR,o)}}return t}};cc.Metadata=Cf;var wD=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Df=T(uc=>{"use strict";Object.defineProperty(uc,"__esModule",{value:!0});uc.CallCredentials=void 0;var Rf=Tt();function _D(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var ns=class n{static createFromMetadataGenerator(e){return new If(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;_D(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Rf.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new Af}};uc.CallCredentials=ns;var bf=class n extends ns{constructor(e){super(),this.creds=e}generateMetadata(e){return g(this,null,function*(){let t=new Rf.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},If=class n extends ns{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new bf([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Af=class n extends ns{generateMetadata(e){return Promise.resolve(new Rf.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Of=T(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.getDefaultRootsData=rs.CIPHER_SUITES=void 0;var CD=ae("fs");rs.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var hE=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Nf=null;function bD(){return hE?(Nf===null&&(Nf=CD.readFileSync(hE)),Nf):null}rs.getDefaultRootsData=bD});var fc=T(dc=>{"use strict";Object.defineProperty(dc,"__esModule",{value:!0});dc.ChannelCredentials=void 0;var ID=ae("tls"),AD=Df(),dE=Of();function kf(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var is=class{constructor(e){this.callCredentials=e||AD.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(kf(e,"Root certificate"),kf(t,"Private key"),kf(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,ID.createSecureContext)({ca:(s=e??(0,dE.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:dE.CIPHER_SUITES});return new hc(o,i??{})}static createFromSecureContext(e,t){return new hc(e,t??{})}static createInsecure(){return new xf}};dc.ChannelCredentials=is;var xf=class n extends is{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},hc=class n extends is{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Mf(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Mf=class n extends is{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var ur=T(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.validateLoadBalancingConfig=ht.getFirstUsableConfig=ht.isLoadBalancerNameRegistered=ht.createLoadBalancer=ht.registerDefaultLoadBalancerType=ht.registerLoadBalancerType=ht.createChildChannelControlHelper=void 0;function RD(n,e){var t,r,i,s,o,a,l,c,u,h;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(h=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&h!==void 0?h:n.removeChannelzChild.bind(n)}}ht.createChildChannelControlHelper=RD;var cr={},Pf=null;function DD(n,e,t){cr[n]={LoadBalancer:e,LoadBalancingConfig:t}}ht.registerLoadBalancerType=DD;function ND(n){Pf=n}ht.registerDefaultLoadBalancerType=ND;function OD(n,e){let t=n.getLoadBalancerName();return t in cr?new cr[t].LoadBalancer(e):null}ht.createLoadBalancer=OD;function kD(n){return n in cr}ht.isLoadBalancerNameRegistered=kD;function xD(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in cr)return t;return e&&Pf?new cr[Pf].LoadBalancingConfig:null}ht.getFirstUsableConfig=xD;function MD(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in cr)return cr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}ht.validateLoadBalancingConfig=MD});var Lf=T(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.extractAndSelectServiceConfig=hr.validateServiceConfig=hr.validateRetryThrottling=void 0;var PD=ae("os"),pc=ie(),LD=ur(),gc=/^\d+(\.\d{1,9})?s$/,FD="node";function BD(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function qD(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!gc.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!gc.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(pc.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(pc.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function UD(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!gc.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(pc.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(pc.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function VD(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(BD(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&gc.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=qD(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=UD(n.hedgingPolicy));return t}function fE(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}hr.validateRetryThrottling=fE;function pE(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,LD.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(VD(r));"retryThrottling"in n&&(e.retryThrottling=fE(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}hr.validateServiceConfig=pE;function zD(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:pE(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function GD(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=zD(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===PD.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===FD&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function jD(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return GD(i,e)}return null}hr.extractAndSelectServiceConfig=jD});var qt=T(mc=>{"use strict";Object.defineProperty(mc,"__esModule",{value:!0});mc.ConnectivityState=void 0;var gE=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(gE||(mc.ConnectivityState=gE={}))});var Ot=T(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.uriToString=dr.splitHostPort=dr.parseUri=void 0;var KD=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function WD(n){let e=KD.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}dr.parseUri=WD;var mE=/^\d+$/;function HD(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return mE.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?mE.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}dr.splitHostPort=HD;function $D(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}dr.uriToString=$D});var mn=T(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.mapUriDefaultScheme=Ut.getDefaultAuthority=Ut.createResolver=Ut.registerDefaultScheme=Ut.registerResolver=void 0;var Bf=Ot(),ss={},Ff=null;function QD(n,e){ss[n]=e}Ut.registerResolver=QD;function YD(n){Ff=n}Ut.registerDefaultScheme=YD;function XD(n,e,t){if(n.scheme!==void 0&&n.scheme in ss)return new ss[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Bf.uriToString)(n)}`)}Ut.createResolver=XD;function JD(n){if(n.scheme!==void 0&&n.scheme in ss)return ss[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Bf.uriToString)(n)}`)}Ut.getDefaultAuthority=JD;function ZD(n){return n.scheme===void 0||!(n.scheme in ss)?Ff!==null?{scheme:Ff,authority:void 0,path:(0,Bf.uriToString)(n)}:null:n}Ut.mapUriDefaultScheme=ZD});var pr=T(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.QueuePicker=fr.UnavailablePicker=fr.PickResultType=void 0;var e1=Tt(),t1=ie(),yc=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(yc||(fr.PickResultType=yc={})),qf=class{constructor(e){this.status=Object.assign({code:t1.Status.UNAVAILABLE,details:"No connection established",metadata:new e1.Metadata},e)}pick(e){return{pickResultType:yc.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};fr.UnavailablePicker=qf;var Uf=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:yc.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};fr.QueuePicker=Uf});var na=T(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});vc.BackoffTimeout=void 0;var n1=1e3,r1=1.6,i1=12e4,s1=.2;function o1(n,e){return Math.random()*(e-n)+n}var Vf=class{constructor(e,t){this.callback=e,this.initialDelay=n1,this.multiplier=r1,this.maxDelay=i1,this.jitter=s1,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o1(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};vc.BackoffTimeout=Vf});var Tc=T(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.ChildLoadBalancerHandler=void 0;var a1=ur(),l1=qt(),c1="child_load_balancer_helper",zf=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===l1.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,a1.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return c1}};Sc.ChildLoadBalancerHandler=zf});var vE=T(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.ResolvingLoadBalancer=void 0;var u1=ur(),h1=Lf(),bt=qt(),d1=mn(),os=pr(),f1=na(),Gf=ie(),p1=Tt(),g1=Ae(),m1=ie(),y1=Ot(),v1=Tc(),S1="resolving_load_balancer";function yE(n){g1.trace(m1.LogVerbosity.DEBUG,S1,n)}var T1=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function E1(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function w1(n,e,t,r){for(let i of t)if(E1(n,e,i,r))return i;return null}function _1(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of T1){let u=w1(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Gf.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Gf.Status.OK,dynamicFilterFactories:[]}}}var jf=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=bt.ConnectivityState.IDLE,this.latestChildPicker=new os.QueuePicker(this),this.currentState=bt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,h1.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(bt.ConnectivityState.IDLE,new os.QueuePicker(this)),this.childLoadBalancer=new v1.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(yE("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,d1.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,h)=>{var d;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let v=(d=p?.loadBalancingConfig)!==null&&d!==void 0?d:[],S=(0,u1.getFirstUsableConfig)(v,!0);if(S===null){this.handleResolutionFailure({code:Gf.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new p1.Metadata});return}this.childLoadBalancer.updateAddressList(a,S,h);let E=p??this.defaultServiceConfig;this.onSuccessfulResolution(E,u??_1(E))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new f1.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===bt.ConnectivityState.IDLE&&this.updateState(bt.ConnectivityState.CONNECTING,new os.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){yE((0,y1.uriToString)(this.target)+" "+bt.ConnectivityState[this.currentState]+" -> "+bt.ConnectivityState[e]),e===bt.ConnectivityState.IDLE&&(t=new os.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===bt.ConnectivityState.IDLE&&(this.updateState(bt.ConnectivityState.TRANSIENT_FAILURE,new os.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===bt.ConnectivityState.IDLE||this.currentState===bt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=bt.ConnectivityState.IDLE,this.latestChildPicker=new os.QueuePicker(this),this.currentState=bt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Ec.ResolvingLoadBalancer=jf});var SE=T(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});as.channelOptionsEqual=as.recognizedOptions=void 0;as.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function C1(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}as.channelOptionsEqual=C1});var vn=T(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.stringToSubchannelAddress=yn.subchannelAddressToString=yn.subchannelAddressEqual=yn.isTcpSubchannelAddress=void 0;var b1=ae("net");function ra(n){return"port"in n}yn.isTcpSubchannelAddress=ra;function I1(n,e){return!n&&!e?!0:!n||!e?!1:ra(n)?ra(e)&&n.host===e.host&&n.port===e.port:!ra(e)&&n.path===e.path}yn.subchannelAddressEqual=I1;function A1(n){return ra(n)?n.host+":"+n.port:n.path}yn.subchannelAddressToString=A1;var R1=443;function D1(n,e){return(0,b1.isIP)(n)?{host:n,port:e??R1}:{path:n}}yn.stringToSubchannelAddress=D1});var wc=T(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.addAdminServicesToServer=ls.registerAdminService=void 0;var TE=[];function N1(n,e){TE.push({getServiceDefinition:n,getHandlers:e})}ls.registerAdminService=N1;function O1(n){for(let{getServiceDefinition:e,getHandlers:t}of TE)n.addService(e(),t())}ls.addAdminServicesToServer=O1});var EE=T(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.ClientDuplexStreamImpl=Vt.ClientWritableStreamImpl=Vt.ClientReadableStreamImpl=Vt.ClientUnaryCallImpl=Vt.callErrorFromStatus=void 0;var k1=ae("events"),Qf=ae("stream"),ia=ie();function x1(n,e){let t=`${n.code} ${ia.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Vt.callErrorFromStatus=x1;var Kf=class extends k1.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ia.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Vt.ClientUnaryCallImpl=Kf;var Wf=class extends Qf.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ia.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Vt.ClientReadableStreamImpl=Wf;var Hf=class extends Qf.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ia.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Vt.ClientWritableStreamImpl=Hf;var $f=class extends Qf.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ia.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Vt.ClientDuplexStreamImpl=$f});var wE=T(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.InterceptingListenerImpl=cs.isInterceptingListener=void 0;function M1(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}cs.isInterceptingListener=M1;var Yf=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};cs.InterceptingListenerImpl=Yf});var rp=T(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.getInterceptingCall=zt.InterceptingCall=zt.RequesterBuilder=zt.ListenerBuilder=zt.InterceptorConfigurationError=void 0;var P1=Tt(),_E=wE(),CE=ie(),bE=ac(),oa=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};zt.InterceptorConfigurationError=oa;var Jf=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};zt.ListenerBuilder=Jf;var Zf=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};zt.RequesterBuilder=Zf;var Xf={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},sa={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},ep=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:sa.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:sa.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:sa.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:sa.cancel}:this.requester=sa}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,h)=>{var d,p,v;this.processingMetadata=!1;let S;if((0,_E.isInterceptingListener)(h))S=h;else{let E={onReceiveMetadata:(d=h.onReceiveMetadata)!==null&&d!==void 0?d:Xf.onReceiveMetadata,onReceiveMessage:(p=h.onReceiveMessage)!==null&&p!==void 0?p:Xf.onReceiveMessage,onReceiveStatus:(v=h.onReceiveStatus)!==null&&v!==void 0?v:Xf.onReceiveStatus};S=new _E.InterceptingListenerImpl(E,c)}this.nextCall.start(u,S),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};zt.InterceptingCall=ep;function L1(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var _c=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(CE.Status.INTERNAL,`Request message serialization failure: ${(0,bE.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:CE.Status.INTERNAL,details:`Response message parsing error: ${(0,bE.getErrorMessage)(a)}`,metadata:new P1.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},tp=class extends _c{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},np=class extends _c{};function F1(n,e,t){let r=L1(n,t.path,e);return t.responseStream?new np(r,t):new tp(r,t)}function B1(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new oa("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new oa("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>F1(r,a,e))(s)}zt.getInterceptingCall=B1});var op=T(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.Client=void 0;var Sn=EE(),q1=ap(),U1=qt(),gr=ie(),us=Tt(),Cc=rp(),Zt=Symbol(),hs=Symbol(),ds=Symbol(),zn=Symbol();function ip(n){return typeof n=="function"}function fs(n){return n.stack.split(`
`).slice(1).join(`
`)}var sp=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[hs]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[ds]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[hs].length>0&&this[ds].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[zn]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Zt]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Zt]=o(e,t,r)}else this[Zt]=new q1.ChannelImplementation(e,t,r)}close(){this[Zt].close()}getChannel(){return this[Zt]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Zt].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===U1.ConnectivityState.READY)t();else try{this[Zt].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(ip(e))return{metadata:new us.Metadata,options:{},callback:e};if(ip(t))return e instanceof us.Metadata?{metadata:e,options:{},callback:t}:{metadata:new us.Metadata,options:e,callback:t};if(!(e instanceof us.Metadata&&t instanceof Object&&ip(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),h={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:u.metadata,call:new Sn.ClientUnaryCallImpl,channel:this[Zt],methodDefinition:h,callOptions:u.options,callback:u.callback};this[zn]&&(d=this[zn](d));let p=d.call,v={clientInterceptors:this[hs],clientInterceptorProviders:this[ds],callInterceptors:(l=d.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=d.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},S=(0,Cc.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);p.call=S;let E=null,D=!1,C=new Error;return S.start(d.metadata,{onReceiveMetadata:B=>{p.emit("metadata",B)},onReceiveMessage(B){E!==null&&S.cancelWithStatus(gr.Status.INTERNAL,"Too many responses received"),E=B},onReceiveStatus(B){if(!D){if(D=!0,B.code===gr.Status.OK)if(E===null){let k=fs(C);d.callback((0,Sn.callErrorFromStatus)({code:gr.Status.INTERNAL,details:"No message received",metadata:B.metadata},k))}else d.callback(null,E);else{let k=fs(C);d.callback((0,Sn.callErrorFromStatus)(B,k))}C=null,p.emit("status",B)}}}),S.sendMessage(i),S.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={metadata:c.metadata,call:new Sn.ClientWritableStreamImpl(t),channel:this[Zt],methodDefinition:u,callOptions:c.options,callback:c.callback};this[zn]&&(h=this[zn](h));let d=h.call,p={clientInterceptors:this[hs],clientInterceptorProviders:this[ds],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},v=(0,Cc.getInterceptingCall)(p,h.methodDefinition,h.callOptions,h.channel);d.call=v;let S=null,E=!1,D=new Error;return v.start(h.metadata,{onReceiveMetadata:C=>{d.emit("metadata",C)},onReceiveMessage(C){S!==null&&v.cancelWithStatus(gr.Status.INTERNAL,"Too many responses received"),S=C},onReceiveStatus(C){if(!E){if(E=!0,C.code===gr.Status.OK)if(S===null){let B=fs(D);h.callback((0,Sn.callErrorFromStatus)({code:gr.Status.INTERNAL,details:"No message received",metadata:C.metadata},B))}else h.callback(null,S);else{let B=fs(D);h.callback((0,Sn.callErrorFromStatus)(C,B))}D=null,d.emit("status",C)}}}),d}checkMetadataAndOptions(e,t){let r,i;return e instanceof us.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new us.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:c.metadata,call:new Sn.ClientReadableStreamImpl(r),channel:this[Zt],methodDefinition:u,callOptions:c.options};this[zn]&&(h=this[zn](h));let d=h.call,p={clientInterceptors:this[hs],clientInterceptorProviders:this[ds],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},v=(0,Cc.getInterceptingCall)(p,h.methodDefinition,h.callOptions,h.channel);d.call=v;let S=!1,E=new Error;return v.start(h.metadata,{onReceiveMetadata(D){d.emit("metadata",D)},onReceiveMessage(D){d.push(D)},onReceiveStatus(D){if(!S){if(S=!0,d.push(null),D.code!==gr.Status.OK){let C=fs(E);d.emit("error",(0,Sn.callErrorFromStatus)(D,C))}E=null,d.emit("status",D)}}}),v.sendMessage(i),v.halfClose(),d}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Sn.ClientDuplexStreamImpl(t,r),channel:this[Zt],methodDefinition:c,callOptions:l.options};this[zn]&&(u=this[zn](u));let h=u.call,d={clientInterceptors:this[hs],clientInterceptorProviders:this[ds],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,Cc.getInterceptingCall)(d,u.methodDefinition,u.callOptions,u.channel);h.call=p;let v=!1,S=new Error;return p.start(u.metadata,{onReceiveMetadata(E){h.emit("metadata",E)},onReceiveMessage(E){h.push(E)},onReceiveStatus(E){if(!v){if(v=!0,h.push(null),E.code!==gr.Status.OK){let D=fs(S);h.emit("error",(0,Sn.callErrorFromStatus)(E,D))}S=null,h.emit("status",E)}}}),h}};bc.Client=sp});var cp=T(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.loadPackageDefinition=ps.makeClientConstructor=void 0;var aa=op(),V1={unary:aa.Client.prototype.makeUnaryRequest,server_stream:aa.Client.prototype.makeServerStreamRequest,client_stream:aa.Client.prototype.makeClientStreamRequest,bidi:aa.Client.prototype.makeBidiStreamRequest};function lp(n){return["__proto__","prototype","constructor"].includes(n)}function IE(n,e,t){t||(t={});class r extends aa.Client{}return Object.keys(n).forEach(i=>{if(lp(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=z1(V1[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!lp(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}ps.makeClientConstructor=IE;function z1(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function G1(n){return"format"in n}function j1(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>lp(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];G1(r)?o[s]=r:o[s]=IE(r,s,{})}return e}ps.loadPackageDefinition=j1});var XE=T((qV,YE)=>{"use strict";var K1=1/0,W1="[object Symbol]",H1=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$1=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ac="\\ud800-\\udfff",ME="\\u0300-\\u036f\\ufe20-\\ufe23",PE="\\u20d0-\\u20f0",LE="\\u2700-\\u27bf",FE="a-z\\xdf-\\xf6\\xf8-\\xff",Q1="\\xac\\xb1\\xd7\\xf7",Y1="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",X1="\\u2000-\\u206f",J1=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",BE="A-Z\\xc0-\\xd6\\xd8-\\xde",qE="\\ufe0e\\ufe0f",UE=Q1+Y1+X1+J1,hp="['\u2019]",Z1="["+Ac+"]",AE="["+UE+"]",Ic="["+ME+PE+"]",VE="\\d+",eN="["+LE+"]",zE="["+FE+"]",GE="[^"+Ac+UE+VE+LE+FE+BE+"]",up="\\ud83c[\\udffb-\\udfff]",tN="(?:"+Ic+"|"+up+")",jE="[^"+Ac+"]",dp="(?:\\ud83c[\\udde6-\\uddff]){2}",fp="[\\ud800-\\udbff][\\udc00-\\udfff]",gs="["+BE+"]",KE="\\u200d",RE="(?:"+zE+"|"+GE+")",nN="(?:"+gs+"|"+GE+")",DE="(?:"+hp+"(?:d|ll|m|re|s|t|ve))?",NE="(?:"+hp+"(?:D|LL|M|RE|S|T|VE))?",WE=tN+"?",HE="["+qE+"]?",rN="(?:"+KE+"(?:"+[jE,dp,fp].join("|")+")"+HE+WE+")*",$E=HE+WE+rN,iN="(?:"+[eN,dp,fp].join("|")+")"+$E,sN="(?:"+[jE+Ic+"?",Ic,dp,fp,Z1].join("|")+")",oN=RegExp(hp,"g"),aN=RegExp(Ic,"g"),lN=RegExp(up+"(?="+up+")|"+sN+$E,"g"),cN=RegExp([gs+"?"+zE+"+"+DE+"(?="+[AE,gs,"$"].join("|")+")",nN+"+"+NE+"(?="+[AE,gs+RE,"$"].join("|")+")",gs+"?"+RE+"+"+DE,gs+"+"+NE,VE,iN].join("|"),"g"),uN=RegExp("["+KE+Ac+ME+PE+qE+"]"),hN=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,dN={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},fN=typeof global=="object"&&global&&global.Object===Object&&global,pN=typeof self=="object"&&self&&self.Object===Object&&self,gN=fN||pN||Function("return this")();function mN(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function yN(n){return n.split("")}function vN(n){return n.match(H1)||[]}function SN(n){return function(e){return n?.[e]}}var TN=SN(dN);function QE(n){return uN.test(n)}function EN(n){return hN.test(n)}function wN(n){return QE(n)?_N(n):yN(n)}function _N(n){return n.match(lN)||[]}function CN(n){return n.match(cN)||[]}var bN=Object.prototype,IN=bN.toString,OE=gN.Symbol,kE=OE?OE.prototype:void 0,xE=kE?kE.toString:void 0;function AN(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function RN(n){if(typeof n=="string")return n;if(xN(n))return xE?xE.call(n):"";var e=n+"";return e=="0"&&1/n==-K1?"-0":e}function DN(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:AN(n,e,t)}function NN(n){return function(e){e=Rc(e);var t=QE(e)?wN(e):void 0,r=t?t[0]:e.charAt(0),i=t?DN(t,1).join(""):e.slice(1);return r[n]()+i}}function ON(n){return function(e){return mN(BN(LN(e).replace(oN,"")),n,"")}}function kN(n){return!!n&&typeof n=="object"}function xN(n){return typeof n=="symbol"||kN(n)&&IN.call(n)==W1}function Rc(n){return n==null?"":RN(n)}var MN=ON(function(n,e,t){return e=e.toLowerCase(),n+(t?PN(e):e)});function PN(n){return FN(Rc(n).toLowerCase())}function LN(n){return n=Rc(n),n&&n.replace($1,TN).replace(aN,"")}var FN=NN("toUpperCase");function BN(n,e,t){return n=Rc(n),e=t?void 0:e,e===void 0?EN(n)?CN(n):vN(n):n.match(e)||[]}YE.exports=MN});var pp=T((UV,JE)=>{"use strict";JE.exports=qN;function qN(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d++]=arguments[d];a.apply(null,h)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var nw=T(tw=>{"use strict";var Dc=tw;Dc.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var ms=new Array(64),ew=new Array(123);for(en=0;en<64;)ew[ms[en]=en<26?en+65:en<52?en+71:en<62?en-4:en-59|43]=en++;var en;Dc.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=ms[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=ms[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=ms[l|c>>6],s[o++]=ms[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=ms[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var ZE="invalid encoding";Dc.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=ew[l])===void 0)throw Error(ZE);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(ZE);return r-i};Dc.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var iw=T((zV,rw)=>{"use strict";rw.exports=Nc;function Nc(){this._listeners={}}Nc.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Nc.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Nc.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var hw=T((GV,uw)=>{"use strict";uw.exports=sw(sw);function sw(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,ow),n.writeFloatBE=e.bind(null,aw);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,lw),n.readFloatBE=t.bind(null,cw)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),u=o*Math.pow(2,-h),r(u*4503599627370496>>>0,a,l+i),r((c<<31|h+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,ow,0,4),n.writeDoubleBE=e.bind(null,aw,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,h=c>>>20&2047,d=4294967296*(c&1048575)+l;return h===2047?d?NaN:u*(1/0):h===0?u*5e-324*d:u*Math.pow(2,h-1075)*(d+4503599627370496)}n.readDoubleLE=t.bind(null,lw,0,4),n.readDoubleBE=t.bind(null,cw,4,0)}(),n}function ow(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function aw(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function lw(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function cw(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var gp=T((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var fw=T(dw=>{"use strict";var mp=dw;mp.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};mp.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};mp.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var gw=T((KV,pw)=>{"use strict";pw.exports=UN;function UN(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var yw=T((WV,mw)=>{"use strict";mw.exports=Qe;var la=Tn();function Qe(n,e){this.lo=n>>>0,this.hi=e>>>0}var hi=Qe.zero=new Qe(0,0);hi.toNumber=function(){return 0};hi.zzEncode=hi.zzDecode=function(){return this};hi.length=function(){return 1};var VN=Qe.zeroHash="\0\0\0\0\0\0\0\0";Qe.fromNumber=function(e){if(e===0)return hi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Qe(r,i)};Qe.from=function(e){if(typeof e=="number")return Qe.fromNumber(e);if(la.isString(e))if(la.Long)e=la.Long.fromString(e);else return Qe.fromNumber(parseInt(e,10));return e.low||e.high?new Qe(e.low>>>0,e.high>>>0):hi};Qe.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Qe.prototype.toLong=function(e){return la.Long?new la.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var mr=String.prototype.charCodeAt;Qe.fromHash=function(e){return e===VN?hi:new Qe((mr.call(e,0)|mr.call(e,1)<<8|mr.call(e,2)<<16|mr.call(e,3)<<24)>>>0,(mr.call(e,4)|mr.call(e,5)<<8|mr.call(e,6)<<16|mr.call(e,7)<<24)>>>0)};Qe.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Qe.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Qe.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Qe.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Tn=T(yp=>{"use strict";var U=yp;U.asPromise=pp();U.base64=nw();U.EventEmitter=iw();U.float=hw();U.inquire=gp();U.utf8=fw();U.pool=gw();U.LongBits=yw();U.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);U.global=U.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||yp;U.emptyArray=Object.freeze?Object.freeze([]):[];U.emptyObject=Object.freeze?Object.freeze({}):{};U.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};U.isString=function(e){return typeof e=="string"||e instanceof String};U.isObject=function(e){return e&&typeof e=="object"};U.isset=U.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};U.Buffer=function(){try{var n=U.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();U._Buffer_from=null;U._Buffer_allocUnsafe=null;U.newBuffer=function(e){return typeof e=="number"?U.Buffer?U._Buffer_allocUnsafe(e):new U.Array(e):U.Buffer?U._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};U.Array=typeof Uint8Array<"u"?Uint8Array:Array;U.Long=U.global.dcodeIO&&U.global.dcodeIO.Long||U.global.Long||U.inquire("long");U.key2Re=/^true|false|0|1$/;U.key32Re=/^-?(?:0|[1-9][0-9]*)$/;U.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;U.longToHash=function(e){return e?U.LongBits.from(e).toHash():U.LongBits.zeroHash};U.longFromHash=function(e,t){var r=U.LongBits.fromHash(e);return U.Long?U.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function vw(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}U.merge=vw;U.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Sw(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&vw(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}U.newError=Sw;U.ProtocolError=Sw("ProtocolError");U.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};U.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};U.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};U._configure=function(){var n=U.Buffer;if(!n){U._Buffer_from=U._Buffer_allocUnsafe=null;return}U._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},U._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var kc=T(($V,_w)=>{"use strict";_w.exports=re;var Gt=Tn(),vp,Oc=Gt.LongBits,Tw=Gt.base64,Ew=Gt.utf8;function ca(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Tp(){}function zN(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function re(){this.len=0,this.head=new ca(Tp,0,0),this.tail=this.head,this.states=null}var ww=function(){return Gt.Buffer?function(){return(re.create=function(){return new vp})()}:function(){return new re}};re.create=ww();re.alloc=function(e){return new Gt.Array(e)};Gt.Array!==Array&&(re.alloc=Gt.pool(re.alloc,Gt.Array.prototype.subarray));re.prototype._push=function(e,t,r){return this.tail=this.tail.next=new ca(e,t,r),this.len+=t,this};function Ep(n,e,t){e[t]=n&255}function GN(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function wp(n,e){this.len=n,this.next=void 0,this.val=e}wp.prototype=Object.create(ca.prototype);wp.prototype.fn=GN;re.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new wp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};re.prototype.int32=function(e){return e<0?this._push(_p,10,Oc.fromNumber(e)):this.uint32(e)};re.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function _p(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}re.prototype.uint64=function(e){var t=Oc.from(e);return this._push(_p,t.length(),t)};re.prototype.int64=re.prototype.uint64;re.prototype.sint64=function(e){var t=Oc.from(e).zzEncode();return this._push(_p,t.length(),t)};re.prototype.bool=function(e){return this._push(Ep,1,e?1:0)};function Sp(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}re.prototype.fixed32=function(e){return this._push(Sp,4,e>>>0)};re.prototype.sfixed32=re.prototype.fixed32;re.prototype.fixed64=function(e){var t=Oc.from(e);return this._push(Sp,4,t.lo)._push(Sp,4,t.hi)};re.prototype.sfixed64=re.prototype.fixed64;re.prototype.float=function(e){return this._push(Gt.float.writeFloatLE,4,e)};re.prototype.double=function(e){return this._push(Gt.float.writeDoubleLE,8,e)};var jN=Gt.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};re.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Ep,1,0);if(Gt.isString(e)){var r=re.alloc(t=Tw.length(e));Tw.decode(e,r,0),e=r}return this.uint32(t)._push(jN,t,e)};re.prototype.string=function(e){var t=Ew.length(e);return t?this.uint32(t)._push(Ew.write,t,e):this._push(Ep,1,0)};re.prototype.fork=function(){return this.states=new zN(this),this.head=this.tail=new ca(Tp,0,0),this.len=0,this};re.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ca(Tp,0,0),this.len=0),this};re.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};re.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};re._configure=function(n){vp=n,re.create=ww(),vp._configure()}});var Iw=T((QV,bw)=>{"use strict";bw.exports=En;var Cw=kc();(En.prototype=Object.create(Cw.prototype)).constructor=En;var yr=Tn();function En(){Cw.call(this)}En._configure=function(){En.alloc=yr._Buffer_allocUnsafe,En.writeBytesBuffer=yr.Buffer&&yr.Buffer.prototype instanceof Uint8Array&&yr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};En.prototype.bytes=function(e){yr.isString(e)&&(e=yr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(En.writeBytesBuffer,t,e),this};function KN(n,e,t){n.length<40?yr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}En.prototype.string=function(e){var t=yr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(KN,t,e),this};En._configure()});var Mc=T((YV,Ow)=>{"use strict";Ow.exports=Oe;var tn=Tn(),bp,Dw=tn.LongBits,WN=tn.utf8;function nn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Oe(n){this.buf=n,this.pos=0,this.len=n.length}var Aw=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Oe(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Oe(e);throw Error("illegal buffer")},Nw=function(){return tn.Buffer?function(t){return(Oe.create=function(i){return tn.Buffer.isBuffer(i)?new bp(i):Aw(i)})(t)}:Aw};Oe.create=Nw();Oe.prototype._slice=tn.Array.prototype.subarray||tn.Array.prototype.slice;Oe.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,nn(this,10);return e}}();Oe.prototype.int32=function(){return this.uint32()|0};Oe.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Cp(){var n=new Dw(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw nn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw nn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Oe.prototype.bool=function(){return this.uint32()!==0};function xc(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Oe.prototype.fixed32=function(){if(this.pos+4>this.len)throw nn(this,4);return xc(this.buf,this.pos+=4)};Oe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw nn(this,4);return xc(this.buf,this.pos+=4)|0};function Rw(){if(this.pos+8>this.len)throw nn(this,8);return new Dw(xc(this.buf,this.pos+=4),xc(this.buf,this.pos+=4))}Oe.prototype.float=function(){if(this.pos+4>this.len)throw nn(this,4);var e=tn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Oe.prototype.double=function(){if(this.pos+8>this.len)throw nn(this,4);var e=tn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Oe.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw nn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=tn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Oe.prototype.string=function(){var e=this.bytes();return WN.read(e,0,e.length)};Oe.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw nn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw nn(this);while(this.buf[this.pos++]&128);return this};Oe.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Oe._configure=function(n){bp=n,Oe.create=Nw(),bp._configure();var e=tn.Long?"toLong":"toNumber";tn.merge(Oe.prototype,{int64:function(){return Cp.call(this)[e](!1)},uint64:function(){return Cp.call(this)[e](!0)},sint64:function(){return Cp.call(this).zzDecode()[e](!1)},fixed64:function(){return Rw.call(this)[e](!0)},sfixed64:function(){return Rw.call(this)[e](!1)}})}});var Pw=T((XV,Mw)=>{"use strict";Mw.exports=di;var xw=Mc();(di.prototype=Object.create(xw.prototype)).constructor=di;var kw=Tn();function di(n){xw.call(this,n)}di._configure=function(){kw.Buffer&&(di.prototype._slice=kw.Buffer.prototype.slice)};di.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};di._configure()});var Fw=T((JV,Lw)=>{"use strict";Lw.exports=ua;var Ip=Tn();(ua.prototype=Object.create(Ip.EventEmitter.prototype)).constructor=ua;function ua(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");Ip.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}ua.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Ip.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};ua.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Ap=T(Bw=>{"use strict";var HN=Bw;HN.Service=Fw()});var Rp=T((ez,qw)=>{"use strict";qw.exports={}});var zw=T(Vw=>{"use strict";var It=Vw;It.build="minimal";It.Writer=kc();It.BufferWriter=Iw();It.Reader=Mc();It.BufferReader=Pw();It.util=Tn();It.rpc=Ap();It.roots=Rp();It.configure=Uw;function Uw(){It.util._configure(),It.Writer._configure(It.BufferWriter),It.Reader._configure(It.BufferReader)}Uw()});var jw=T((nz,Gw)=>{"use strict";Gw.exports=Dp;function Dp(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Dp.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d]=arguments[++d];if(d=0,s=s.replace(/%([%dfijs])/g,function(v,S){var E=h[d++];switch(S){case"d":case"f":return String(Number(E));case"i":return String(Math.floor(E));case"j":return JSON.stringify(E);case"s":return String(E)}return"%"}),d!==h.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Dp.verbose=!1});var Ww=T((rz,Kw)=>{"use strict";Kw.exports=ha;var $N=pp(),QN=gp(),Np=QN("fs");function ha(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Np&&Np.readFile?Np.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?ha.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):ha.xhr(n,e,t):$N(ha,this,n,e)}ha.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var Qw=T($w=>{"use strict";var kp=$w,Hw=kp.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Op=kp.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=Hw(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};kp.resolve=function(e,t,r){return r||(t=Op(t)),Hw(t)?t:(r||(e=Op(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Op(e+"/"+t):t)}});var fi=T(Yw=>{"use strict";var da=Yw,YN=Ye(),XN=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function fa(n,e){var t=0,r={};for(e|=0;t<n.length;)r[XN[t+e]]=n[t++];return r}da.basic=fa([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);da.defaults=fa([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",YN.emptyArray,null]);da.long=fa([0,0,0,1,1],7);da.mapKey=fa([0,0,0,5,5,0,0,0,1,1,0,2],2);da.packed=fa([1,5,0,0,0,5,5,0,0,0,1,1,0])});var vr=T((oz,Zw)=>{"use strict";Zw.exports=jt;var Pc=pi();((jt.prototype=Object.create(Pc.prototype)).constructor=jt).className="Field";var Xw=rn(),Jw=fi(),qe=Ye(),xp,JN=/^required|optional|repeated$/;jt.fromJSON=function(e,t){return new jt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function jt(n,e,t,r,i,s,o){if(qe.isObject(r)?(o=i,s=r,r=i=void 0):qe.isObject(i)&&(o=s,s=i,i=void 0),Pc.call(this,n,s),!qe.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!qe.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!JN.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!qe.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=qe.Long?Jw.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(jt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});jt.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Pc.prototype.setOption.call(this,e,t,r)};jt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return qe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};jt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=Jw.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof xp?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Xw&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Xw))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=qe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;qe.base64.test(this.typeDefault)?qe.base64.decode(this.typeDefault,e=qe.newBuffer(qe.base64.length(this.typeDefault)),0):qe.utf8.write(this.typeDefault,e=qe.newBuffer(qe.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=qe.emptyObject:this.repeated?this.defaultValue=qe.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof xp&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Pc.prototype.resolve.call(this)};jt.d=function(e,t,r,i){return typeof t=="function"?t=qe.decorateType(t).name:t&&typeof t=="object"&&(t=qe.decorateEnum(t).name),function(o,a){qe.decorateType(o.constructor).add(new jt(a,e,t,r,{default:i}))}};jt._configure=function(e){xp=e}});var ys=T((az,n0)=>{"use strict";n0.exports=Kt;var Fc=pi();((Kt.prototype=Object.create(Fc.prototype)).constructor=Kt).className="OneOf";var e0=vr(),Lc=Ye();function Kt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Fc.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Kt.fromJSON=function(e,t){return new Kt(e,t.oneof,t.options,t.comment)};Kt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Lc.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function t0(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Kt.prototype.add=function(e){if(!(e instanceof e0))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,t0(this),this};Kt.prototype.remove=function(e){if(!(e instanceof e0))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Kt.prototype.onAdd=function(e){Fc.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}t0(this)};Kt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Fc.prototype.onRemove.call(this,e)};Kt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Lc.decorateType(i.constructor).add(new Kt(s,e)),Object.defineProperty(i,s,{get:Lc.oneOfGetter(e),set:Lc.oneOfSetter(e)})}}});var Ts=T((lz,o0)=>{"use strict";o0.exports=se;var Mp=pi();((se.prototype=Object.create(Mp.prototype)).constructor=se).className="Namespace";var r0=vr(),Bc=Ye(),ZN=ys(),vs,pa,Ss;se.fromJSON=function(e,t){return new se(e,t.options).addJSON(t.nested)};function i0(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}se.arrayToJSON=i0;se.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};se.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function se(n,e){Mp.call(this,n,e),this.nested=void 0,this._nestedArray=null}function s0(n){return n._nestedArray=null,n}Object.defineProperty(se.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Bc.toArray(this.nested))}});se.prototype.toJSON=function(e){return Bc.toObject(["options",this.options,"nested",i0(this.nestedArray,e)])};se.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?vs.fromJSON:s.values!==void 0?Ss.fromJSON:s.methods!==void 0?pa.fromJSON:s.id!==void 0?r0.fromJSON:se.fromJSON)(r[i],s));return this};se.prototype.get=function(e){return this.nested&&this.nested[e]||null};se.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Ss)return this.nested[e].values;throw Error("no such enum: "+e)};se.prototype.add=function(e){if(!(e instanceof r0&&e.extend!==void 0||e instanceof vs||e instanceof ZN||e instanceof Ss||e instanceof pa||e instanceof se))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof se&&e instanceof se&&!(t instanceof vs||t instanceof pa)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),s0(this)};se.prototype.remove=function(e){if(!(e instanceof Mp))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),s0(this)};se.prototype.define=function(e,t){if(Bc.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof se))throw Error("path conflicts with non-namespace objects")}else r.add(r=new se(i))}return t&&r.addJSON(t),r};se.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof se?e[t++].resolveAll():e[t++].resolve();return this.resolve()};se.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Bc.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof se&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof se&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};se.prototype.lookupType=function(e){var t=this.lookup(e,[vs]);if(!t)throw Error("no such type: "+e);return t};se.prototype.lookupEnum=function(e){var t=this.lookup(e,[Ss]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};se.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[vs,Ss]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};se.prototype.lookupService=function(e){var t=this.lookup(e,[pa]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};se._configure=function(n,e,t){vs=n,pa=e,Ss=t}});var qc=T((cz,a0)=>{"use strict";a0.exports=Gn;var Pp=vr();((Gn.prototype=Object.create(Pp.prototype)).constructor=Gn).className="MapField";var eO=fi(),ga=Ye();function Gn(n,e,t,r,i,s){if(Pp.call(this,n,e,r,void 0,void 0,i,s),!ga.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Gn.fromJSON=function(e,t){return new Gn(e,t.id,t.keyType,t.type,t.options,t.comment)};Gn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ga.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Gn.prototype.resolve=function(){if(this.resolved)return this;if(eO.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Pp.prototype.resolve.call(this)};Gn.d=function(e,t,r){return typeof r=="function"?r=ga.decorateType(r).name:r&&typeof r=="object"&&(r=ga.decorateEnum(r).name),function(s,o){ga.decorateType(s.constructor).add(new Gn(o,e,t,r))}}});var Uc=T((uz,l0)=>{"use strict";l0.exports=gi;var Lp=pi();((gi.prototype=Object.create(Lp.prototype)).constructor=gi).className="Method";var Es=Ye();function gi(n,e,t,r,i,s,o,a,l){if(Es.isObject(i)?(o=i,i=s=void 0):Es.isObject(s)&&(o=s,s=void 0),!(e===void 0||Es.isString(e)))throw TypeError("type must be a string");if(!Es.isString(t))throw TypeError("requestType must be a string");if(!Es.isString(r))throw TypeError("responseType must be a string");Lp.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}gi.fromJSON=function(e,t){return new gi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};gi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Es.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};gi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Lp.prototype.resolve.call(this))}});var Vc=T((hz,u0)=>{"use strict";u0.exports=Wt;var Sr=Ts();((Wt.prototype=Object.create(Sr.prototype)).constructor=Wt).className="Service";var Fp=Uc(),ma=Ye(),tO=Ap();function Wt(n,e){Sr.call(this,n,e),this.methods={},this._methodsArray=null}Wt.fromJSON=function(e,t){var r=new Wt(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Fp.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Wt.prototype.toJSON=function(e){var t=Sr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ma.toObject(["options",t&&t.options||void 0,"methods",Sr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Wt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=ma.toArray(this.methods))}});function c0(n){return n._methodsArray=null,n}Wt.prototype.get=function(e){return this.methods[e]||Sr.prototype.get.call(this,e)};Wt.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Sr.prototype.resolve.call(this)};Wt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Fp?(this.methods[e.name]=e,e.parent=this,c0(this)):Sr.prototype.add.call(this,e)};Wt.prototype.remove=function(e){if(e instanceof Fp){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c0(this)}return Sr.prototype.remove.call(this,e)};Wt.prototype.create=function(e,t,r){for(var i=new tO.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=ma.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=ma.codegen(["r","c"],ma.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var zc=T((dz,h0)=>{"use strict";h0.exports=wn;var nO=Tn();function wn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}wn.create=function(e){return this.$type.create(e)};wn.encode=function(e,t){return this.$type.encode(e,t)};wn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};wn.decode=function(e){return this.$type.decode(e)};wn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};wn.verify=function(e){return this.$type.verify(e)};wn.fromObject=function(e){return this.$type.fromObject(e)};wn.toObject=function(e,t){return this.$type.toObject(e,t)};wn.prototype.toJSON=function(){return this.$type.toObject(this,nO.toJSONOptions)}});var Bp=T((fz,f0)=>{"use strict";f0.exports=sO;var rO=rn(),jn=fi(),d0=Ye();function iO(n){return"missing required '"+n.name+"'"}function sO(n){var e=d0.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof rO?"int32":r.type,s="m"+d0.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),jn.defaults[r.keyType]!==void 0?e("k=%j",jn.defaults[r.keyType]):e("k=null"),jn.defaults[i]!==void 0?e("value=%j",jn.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),jn.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),jn.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),jn.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),jn.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):jn.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",iO(o))}return e("return m")}});var Vp=T((pz,p0)=>{"use strict";p0.exports=lO;var oO=rn(),qp=Ye();function Ht(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Up(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof oO){n("switch(%s){",r)("default:")("return%j",Ht(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Ht(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Ht(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Ht(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Ht(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Ht(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Ht(e,"buffer"));break}return n}function aO(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Ht(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Ht(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Ht(e,"boolean key"));break}return n}function lO(n){var e=qp.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+qp.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",Ht(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),aO(e,s,"k[i]"),Up(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Ht(s,"array"))("for(var i=0;i<%s.length;++i){",o),Up(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=qp.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}Up(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var jp=T(m0=>{"use strict";var g0=m0,ya=rn(),_n=Ye();function zp(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof ya){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}g0.fromObject=function(e){var t=e.fieldsArray,r=_n.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=_n.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),zp(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),zp(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof ya||r("if(d%s!=null){",o),zp(r,s,i,o),s.resolvedType instanceof ya||r("}"))}return r("return m")};function Gp(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof ya?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}g0.toObject=function(e){var t=e.fieldsArray.slice().sort(_n.compareFieldsById);if(!t.length)return _n.codegen()("return {}");for(var r=_n.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",_n.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",_n.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=_n.safeProp(l.name);if(l.resolvedType instanceof ya)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var h=!1;for(a=0;a<t.length;++a){var l=t[a],d=e._fieldsArray.indexOf(l),c=_n.safeProp(l.name);l.map?(h||(h=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Gp(r,l,d,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Gp(r,l,d,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Gp(r,l,d,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",_n.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Kp=T(y0=>{"use strict";var cO=y0,uO=zc();cO[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof uO){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Kc=T((yz,S0)=>{"use strict";S0.exports=pe;var sn=Ts();((pe.prototype=Object.create(sn.prototype)).constructor=pe).className="Type";var hO=rn(),$p=ys(),Gc=vr(),dO=qc(),fO=Vc(),Wp=zc(),Hp=Mc(),pO=kc(),dt=Ye(),gO=Qp(),mO=Bp(),yO=Vp(),v0=jp(),vO=Kp();function pe(n,e){sn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(pe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=dt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=dt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=pe.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Wp||((n.prototype=new Wp).constructor=n,dt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,dt.merge(n,Wp,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:dt.oneOfGetter(this._oneofsArray[t].oneof),set:dt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});pe.generateConstructor=function(e){for(var t=dt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",dt.safeProp(i.name)):i.repeated&&t("this%s=[]",dt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function jc(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}pe.fromJSON=function(e,t){var r=new pe(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?dO.fromJSON:Gc.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add($p.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Gc.fromJSON:o.fields!==void 0?pe.fromJSON:o.values!==void 0?hO.fromJSON:o.methods!==void 0?fO.fromJSON:sn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};pe.prototype.toJSON=function(e){var t=sn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return dt.toObject(["options",t&&t.options||void 0,"oneofs",sn.arrayToJSON(this.oneofsArray,e),"fields",sn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};pe.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return sn.prototype.resolveAll.call(this)};pe.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};pe.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Gc&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),jc(this)}return e instanceof $p?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),jc(this)):sn.prototype.add.call(this,e)};pe.prototype.remove=function(e){if(e instanceof Gc&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),jc(this)}if(e instanceof $p){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),jc(this)}return sn.prototype.remove.call(this,e)};pe.prototype.isReservedId=function(e){return sn.isReservedId(this.reserved,e)};pe.prototype.isReservedName=function(e){return sn.isReservedName(this.reserved,e)};pe.prototype.create=function(e){return new this.ctor(e)};pe.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=gO(this)({Writer:pO,types:t,util:dt}),this.decode=mO(this)({Reader:Hp,types:t,util:dt}),this.verify=yO(this)({types:t,util:dt}),this.fromObject=v0.fromObject(this)({types:t,util:dt}),this.toObject=v0.toObject(this)({types:t,util:dt});var i=vO[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};pe.prototype.encode=function(e,t){return this.setup().encode(e,t)};pe.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};pe.prototype.decode=function(e,t){return this.setup().decode(e,t)};pe.prototype.decodeDelimited=function(e){return e instanceof Hp||(e=Hp.create(e)),this.decode(e,e.uint32())};pe.prototype.verify=function(e){return this.setup().verify(e)};pe.prototype.fromObject=function(e){return this.setup().fromObject(e)};pe.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};pe.d=function(e){return function(r){dt.decorateType(r,e)}}});var $c=T((vz,C0)=>{"use strict";C0.exports=kt;var Hc=Ts();((kt.prototype=Object.create(Hc.prototype)).constructor=kt).className="Root";var Xp=vr(),E0=rn(),SO=ys(),Tr=Ye(),w0,Yp,va;function kt(n){Hc.call(this,"",n),this.deferred=[],this.files=[]}kt.fromJSON=function(e,t){return t||(t=new kt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};kt.prototype.resolvePath=Tr.path.resolve;kt.prototype.fetch=Tr.fetch;function _0(){}kt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Tr.asPromise(n,i,e,t);var s=r===_0;function o(p,v){if(r){if(s)throw p;var S=r;r=null,S(p,v)}}function a(p){var v=p.lastIndexOf("google/protobuf/");if(v>-1){var S=p.substring(v);if(S in va)return S}return null}function l(p,v){try{if(Tr.isString(v)&&v.charAt(0)==="{"&&(v=JSON.parse(v)),!Tr.isString(v))i.setOptions(v.options).addJSON(v.nested);else{Yp.filename=p;var S=Yp(v,i,t),E,D=0;if(S.imports)for(;D<S.imports.length;++D)(E=a(S.imports[D])||i.resolvePath(p,S.imports[D]))&&c(E);if(S.weakImports)for(D=0;D<S.weakImports.length;++D)(E=a(S.weakImports[D])||i.resolvePath(p,S.weakImports[D]))&&c(E,!0)}}catch(C){o(C)}!s&&!u&&o(null,i)}function c(p,v){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in va){s?l(p,va[p]):(++u,setTimeout(function(){--u,l(p,va[p])}));return}if(s){var S;try{S=Tr.fs.readFileSync(p).toString("utf8")}catch(E){v||o(E);return}l(p,S)}else++u,i.fetch(p,function(E,D){if(--u,!!r){if(E){v?u||o(null,i):o(E);return}l(p,D)}})}}var u=0;Tr.isString(e)&&(e=[e]);for(var h=0,d;h<e.length;++h)(d=i.resolvePath("",e[h]))&&c(d);if(s)return i;u||o(null,i)};kt.prototype.loadSync=function(e,t){if(!Tr.isNode)throw Error("not supported");return this.load(e,t,_0)};kt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Hc.prototype.resolveAll.call(this)};var Wc=/^[A-Z]/;function T0(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Xp(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}kt.prototype._handleAdd=function(e){if(e instanceof Xp)e.extend!==void 0&&!e.extensionField&&(T0(this,e)||this.deferred.push(e));else if(e instanceof E0)Wc.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof SO)){if(e instanceof w0)for(var t=0;t<this.deferred.length;)T0(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Wc.test(e.name)&&(e.parent[e.name]=e)}};kt.prototype._handleRemove=function(e){if(e instanceof Xp){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof E0)Wc.test(e.name)&&delete e.parent[e.name];else if(e instanceof Hc){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Wc.test(e.name)&&delete e.parent[e.name]}};kt._configure=function(n,e,t){w0=n,Yp=e,va=t}});var Ye=T((Sz,I0)=>{"use strict";var ke=I0.exports=Tn(),b0=Rp(),Jp,Zp;ke.codegen=jw();ke.fetch=Ww();ke.path=Qw();ke.fs=ke.inquire("fs");ke.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};ke.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var TO=/\\/g,EO=/"/g;ke.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ke.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ke.isReserved(e)?'["'+e.replace(TO,"\\\\").replace(EO,'\\"')+'"]':"."+e};ke.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var wO=/_([a-z])/g;ke.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(wO,function(t,r){return r.toUpperCase()})};ke.compareFieldsById=function(e,t){return e.id-t.id};ke.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ke.decorateRoot.remove(e.$type),e.$type.name=t,ke.decorateRoot.add(e.$type)),e.$type;Jp||(Jp=Kc());var r=new Jp(t||e.name);return ke.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var _O=0;ke.decorateEnum=function(e){if(e.$type)return e.$type;Zp||(Zp=rn());var t=new Zp("Enum"+_O++,e);return ke.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ke.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(ke,"decorateRoot",{get:function(){return b0.decorated||(b0.decorated=new($c()))}})});var pi=T((Tz,A0)=>{"use strict";A0.exports=xt;xt.className="ReflectionObject";var Qc=Ye(),Yc;function xt(n,e){if(!Qc.isString(n))throw TypeError("name must be a string");if(e&&!Qc.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(xt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});xt.prototype.toJSON=function(){throw Error()};xt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Yc&&t._handleAdd(this)};xt.prototype.onRemove=function(e){var t=e.root;t instanceof Yc&&t._handleRemove(this),this.parent=null,this.resolved=!1};xt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Yc&&(this.resolved=!0),this)};xt.prototype.getOption=function(e){if(this.options)return this.options[e]};xt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};xt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Qc.setProperty(o,r,t)}else s={},s[e]=Qc.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};xt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};xt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};xt._configure=function(n){Yc=n}});var rn=T((Ez,N0)=>{"use strict";N0.exports=Cn;var R0=pi();((Cn.prototype=Object.create(R0.prototype)).constructor=Cn).className="Enum";var D0=Ts(),Xc=Ye();function Cn(n,e,t,r,i,s){if(R0.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Cn.fromJSON=function(e,t){var r=new Cn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Cn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Xc.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Cn.prototype.add=function(e,t,r,i){if(!Xc.isString(e))throw TypeError("name must be a string");if(!Xc.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Cn.prototype.remove=function(e){if(!Xc.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Cn.prototype.isReservedId=function(e){return D0.isReservedId(this.reserved,e)};Cn.prototype.isReservedName=function(e){return D0.isReservedName(this.reserved,e)}});var Qp=T((wz,k0)=>{"use strict";k0.exports=bO;var CO=rn(),eg=fi(),tg=Ye();function O0(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function bO(n){for(var e=tg.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(tg.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof CO?"int32":s.type,l=eg.basic[a];r="m"+tg.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|eg.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&eg.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?O0(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?O0(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var M0=T((_z,x0)=>{"use strict";var ee=x0.exports=zw();ee.build="light";function IO(n,e,t){return typeof e=="function"?(t=e,e=new ee.Root):e||(e=new ee.Root),e.load(n,t)}ee.load=IO;function AO(n,e){return e||(e=new ee.Root),e.loadSync(n)}ee.loadSync=AO;ee.encoder=Qp();ee.decoder=Bp();ee.verifier=Vp();ee.converter=jp();ee.ReflectionObject=pi();ee.Namespace=Ts();ee.Root=$c();ee.Enum=rn();ee.Type=Kc();ee.Field=vr();ee.OneOf=ys();ee.MapField=qc();ee.Service=Vc();ee.Method=Uc();ee.Message=zc();ee.wrappers=Kp();ee.types=fi();ee.util=Ye();ee.ReflectionObject._configure(ee.Root);ee.Namespace._configure(ee.Type,ee.Service,ee.Enum);ee.Root._configure(ee.Type);ee.Field._configure(ee.Type)});var rg=T((Cz,F0)=>{"use strict";F0.exports=L0;var ng=/[\s{}=;:[\],'"()<>]/g,RO=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,DO=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,NO=/^ *[*/]+ */,OO=/^\s*\*?\/*/,kO=/\n/g,xO=/\s/,MO=/\\(.?)/g,PO={0:"\0",r:"\r",n:`
`,t:"	"};function P0(n){return n.replace(MO,function(e,t){switch(t){case"\\":case"":return t;default:return PO[t]||""}})}L0.unescape=P0;function L0(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(k){return Error("illegal "+k+" (line "+i+")")}function u(){var k=l==="'"?DO:RO;k.lastIndex=t-1;var j=k.exec(n);if(!j)throw c("string");return t=k.lastIndex,E(l),l=null,P0(j[1])}function h(k){return n.charAt(k)}function d(k,j,W){var Z={type:n.charAt(k++),lineEmpty:!1,leading:W},Ge;e?Ge=2:Ge=3;var ot=k-Ge,fe;do if(--ot<0||(fe=n.charAt(ot))===`
`){Z.lineEmpty=!0;break}while(fe===" "||fe==="	");for(var w=n.substring(k,j).split(kO),Ce=0;Ce<w.length;++Ce)w[Ce]=w[Ce].replace(e?OO:NO,"").trim();Z.text=w.join(`
`).trim(),o[i]=Z,s=i}function p(k){var j=v(k),W=n.substring(k,j),Z=/^\s*\/\//.test(W);return Z}function v(k){for(var j=k;j<r&&h(j)!==`
`;)j++;return j}function S(){if(a.length>0)return a.shift();if(l)return u();var k,j,W,Z,Ge,ot=t===0;do{if(t===r)return null;for(k=!1;xO.test(W=h(t));)if(W===`
`&&(ot=!0,++i),++t===r)return null;if(h(t)==="/"){if(++t===r)throw c("comment");if(h(t)==="/")if(e){if(Z=t,Ge=!1,p(t-1)){Ge=!0;do if(t=v(t),t===r||(t++,!ot))break;while(p(t))}else t=Math.min(r,v(t)+1);Ge&&(d(Z,t,ot),ot=!0),i++,k=!0}else{for(Ge=h(Z=t+1)==="/";h(++t)!==`
`;)if(t===r)return null;++t,Ge&&(d(Z,t-1,ot),ot=!0),++i,k=!0}else if((W=h(t))==="*"){Z=t+1,Ge=e||h(Z)==="*";do{if(W===`
`&&++i,++t===r)throw c("comment");j=W,W=h(t)}while(j!=="*"||W!=="/");++t,Ge&&(d(Z,t-2,ot),ot=!0),k=!0}else return"/"}}while(k);var fe=t;ng.lastIndex=0;var w=ng.test(h(fe++));if(!w)for(;fe<r&&!ng.test(h(fe));)++fe;var Ce=n.substring(t,t=fe);return(Ce==='"'||Ce==="'")&&(l=Ce),Ce}function E(k){a.push(k)}function D(){if(!a.length){var k=S();if(k===null)return null;E(k)}return a[0]}function C(k,j){var W=D(),Z=W===k;if(Z)return S(),!0;if(!j)throw c("token '"+W+"', '"+k+"' expected");return!1}function B(k){var j=null,W;return k===void 0?(W=o[i-1],delete o[i-1],W&&(e||W.type==="*"||W.lineEmpty)&&(j=W.leading?W.text:null)):(s<k&&D(),W=o[k],delete o[k],W&&!W.lineEmpty&&(e||W.type==="/")&&(j=W.leading?null:W.text)),j}return Object.defineProperty({next:S,peek:D,push:E,skip:C,cmnt:B},"line",{get:function(){return i}})}});var G0=T((bz,z0)=>{"use strict";z0.exports=Kn;Kn.filename=null;Kn.defaults={keepCase:!1};var LO=rg(),B0=$c(),q0=Kc(),U0=vr(),FO=qc(),V0=ys(),BO=rn(),qO=Vc(),UO=Uc(),ig=fi(),sg=Ye(),VO=/^[1-9][0-9]*$/,zO=/^-?[1-9][0-9]*$/,GO=/^0[x][0-9a-fA-F]+$/,jO=/^-?0[x][0-9a-fA-F]+$/,KO=/^0[0-7]+$/,WO=/^-?0[0-7]+$/,HO=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,bn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,In=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,$O=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Kn(n,e,t){e instanceof B0||(t=e,e=new B0),t||(t=Kn.defaults);var r=t.preferTrailingComment||!1,i=LO(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,h,d,p,v,S=!1,E=e,D=t.keepCase?function(I){return I}:sg.camelCase;function C(I,A,N){var G=Kn.filename;return N||(Kn.filename=null),Error("illegal "+(A||"token")+" '"+I+"' ("+(G?G+", ":"")+"line "+i.line+")")}function B(){var I=[],A;do{if((A=s())!=='"'&&A!=="'")throw C(A);I.push(s()),l(A),A=a()}while(A==='"'||A==="'");return I.join("")}function k(I){var A=s();switch(A){case"'":case'"':return o(A),B();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return W(A,!0)}catch{if(I&&In.test(A))return A;throw C(A,"value")}}function j(I,A){var N,G;do A&&((N=a())==='"'||N==="'")?I.push(B()):I.push([G=Z(s()),l("to",!0)?Z(s()):G]);while(l(",",!0));l(";")}function W(I,A){var N=1;switch(I.charAt(0)==="-"&&(N=-1,I=I.substring(1)),I){case"inf":case"INF":case"Inf":return N*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(VO.test(I))return N*parseInt(I,10);if(GO.test(I))return N*parseInt(I,16);if(KO.test(I))return N*parseInt(I,8);if(HO.test(I))return N*parseFloat(I);throw C(I,"number",A)}function Z(I,A){switch(I){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!A&&I.charAt(0)==="-")throw C(I,"id");if(zO.test(I))return parseInt(I,10);if(jO.test(I))return parseInt(I,16);if(WO.test(I))return parseInt(I,8);throw C(I,"id")}function Ge(){if(h!==void 0)throw C("package");if(h=s(),!In.test(h))throw C(h,"name");E=E.define(h),l(";")}function ot(){var I=a(),A;switch(I){case"weak":A=p||(p=[]),s();break;case"public":s();default:A=d||(d=[]);break}I=B(),l(";"),A.push(I)}function fe(){if(l("="),v=B(),S=v==="proto3",!S&&v!=="proto2")throw C(v,"syntax");l(";")}function w(I,A){switch(A){case"option":return me(I,A),l(";"),!0;case"message":return _(I,A),!0;case"enum":return ue(I,A),!0;case"service":return Be(I,A),!0;case"extend":return Hi(I,A),!0}return!1}function Ce(I,A,N){var G=i.line;if(I&&(typeof I.comment!="string"&&(I.comment=c()),I.filename=Kn.filename),l("{",!0)){for(var V;(V=s())!=="}";)A(V);l(";",!0)}else N&&N(),l(";"),I&&(typeof I.comment!="string"||r)&&(I.comment=c(G)||I.comment)}function _(I,A){if(!bn.test(A=s()))throw C(A,"type name");var N=new q0(A);Ce(N,function(V){if(!w(N,V))switch(V){case"map":ne(N,V);break;case"required":case"repeated":f(N,V);break;case"optional":S?f(N,"proto3_optional"):f(N,"optional");break;case"oneof":Se(N,V);break;case"extensions":j(N.extensions||(N.extensions=[]));break;case"reserved":j(N.reserved||(N.reserved=[]),!0);break;default:if(!S||!In.test(V))throw C(V);o(V),f(N,"optional");break}}),I.add(N)}function f(I,A,N){var G=s();if(G==="group"){P(I,A);return}for(;G.endsWith(".")||a().startsWith(".");)G+=s();if(!In.test(G))throw C(G,"type");var V=s();if(!bn.test(V))throw C(V,"name");V=D(V),l("=");var X=new U0(V,Z(s()),G,A,N);if(Ce(X,function(Dt){if(Dt==="option")me(X,Dt),l(";");else throw C(Dt)},function(){at(X)}),A==="proto3_optional"){var tt=new V0("_"+V);X.setOption("proto3_optional",!0),tt.add(X),I.add(tt)}else I.add(X);!S&&X.repeated&&(ig.packed[G]!==void 0||ig.basic[G]===void 0)&&X.setOption("packed",!1,!0)}function P(I,A){var N=s();if(!bn.test(N))throw C(N,"name");var G=sg.lcFirst(N);N===G&&(N=sg.ucFirst(N)),l("=");var V=Z(s()),X=new q0(N);X.group=!0;var tt=new U0(G,V,N,A);tt.filename=Kn.filename,Ce(X,function(Dt){switch(Dt){case"option":me(X,Dt),l(";");break;case"required":case"repeated":f(X,Dt);break;case"optional":S?f(X,"proto3_optional"):f(X,"optional");break;case"message":_(X,Dt);break;case"enum":ue(X,Dt);break;default:throw C(Dt)}}),I.add(X).add(tt)}function ne(I){l("<");var A=s();if(ig.mapKey[A]===void 0)throw C(A,"type");l(",");var N=s();if(!In.test(N))throw C(N,"type");l(">");var G=s();if(!bn.test(G))throw C(G,"name");l("=");var V=new FO(D(G),Z(s()),A,N);Ce(V,function(tt){if(tt==="option")me(V,tt),l(";");else throw C(tt)},function(){at(V)}),I.add(V)}function Se(I,A){if(!bn.test(A=s()))throw C(A,"name");var N=new V0(D(A));Ce(N,function(V){V==="option"?(me(N,V),l(";")):(o(V),f(N,"optional"))}),I.add(N)}function ue(I,A){if(!bn.test(A=s()))throw C(A,"name");var N=new BO(A);Ce(N,function(V){switch(V){case"option":me(N,V),l(";");break;case"reserved":j(N.reserved||(N.reserved=[]),!0);break;default:Ne(N,V)}}),I.add(N)}function Ne(I,A){if(!bn.test(A))throw C(A,"name");l("=");var N=Z(s(),!0),G={options:void 0};G.setOption=function(V,X){this.options===void 0&&(this.options={}),this.options[V]=X},Ce(G,function(X){if(X==="option")me(G,X),l(";");else throw C(X)},function(){at(G)}),I.add(A,N,G.comment,G.options)}function me(I,A){var N=l("(",!0);if(!In.test(A=s()))throw C(A,"name");var G=A,V=G,X;N&&(l(")"),G="("+G+")",V=G,A=a(),$O.test(A)&&(X=A.slice(1),G+=A,s())),l("=");var tt=mt(I,G);be(I,V,tt,X)}function mt(I,A){if(l("{",!0)){for(var N={};!l("}",!0);){if(!bn.test(lt=s()))throw C(lt,"name");if(lt===null)throw C(lt,"end of input");var G,V=lt;if(l(":",!0),a()==="{")G=mt(I,A+"."+lt);else if(a()==="["){G=[];var X;if(l("[",!0)){do X=k(!0),G.push(X);while(l(",",!0));l("]"),typeof X<"u"&&Fe(I,A+"."+lt,X)}}else G=k(!0),Fe(I,A+"."+lt,G);var tt=N[V];tt&&(G=[].concat(tt).concat(G)),N[V]=G,l(",",!0),l(";",!0)}return N}var sr=k(!0);return Fe(I,A,sr),sr}function Fe(I,A,N){I.setOption&&I.setOption(A,N)}function be(I,A,N,G){I.setParsedOption&&I.setParsedOption(A,N,G)}function at(I){if(l("[",!0)){do me(I,"option");while(l(",",!0));l("]")}return I}function Be(I,A){if(!bn.test(A=s()))throw C(A,"service name");var N=new qO(A);Ce(N,function(V){if(!w(N,V))if(V==="rpc")yt(N,V);else throw C(V)}),I.add(N)}function yt(I,A){var N=c(),G=A;if(!bn.test(A=s()))throw C(A,"name");var V=A,X,tt,sr,Dt;if(l("("),l("stream",!0)&&(tt=!0),!In.test(A=s())||(X=A,l(")"),l("returns"),l("("),l("stream",!0)&&(Dt=!0),!In.test(A=s())))throw C(A);sr=A,l(")");var kl=new UO(V,G,X,sr,tt,Dt);kl.comment=N,Ce(kl,function(_d){if(_d==="option")me(kl,_d),l(";");else throw C(_d)}),I.add(kl)}function Hi(I,A){if(!In.test(A=s()))throw C(A,"reference");var N=A;Ce(null,function(V){switch(V){case"required":case"repeated":f(I,V,N);break;case"optional":S?f(I,"proto3_optional",N):f(I,"optional",N);break;default:if(!S||!In.test(V))throw C(V);o(V),f(I,"optional",N);break}})}for(var lt;(lt=s())!==null;)switch(lt){case"package":if(!u)throw C(lt);Ge();break;case"import":if(!u)throw C(lt);ot();break;case"syntax":if(!u)throw C(lt);fe();break;case"option":me(E,lt),l(";");break;default:if(w(E,lt)){u=!1;continue}throw C(lt)}return Kn.filename=null,{package:h,imports:d,weakImports:p,syntax:v,root:e}}});var W0=T((Iz,K0)=>{"use strict";K0.exports=on;var QO=/\/|\./;function on(n,e){QO.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),on[n]=e}on("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var j0;on("duration",{Duration:j0={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});on("timestamp",{Timestamp:j0});on("empty",{Empty:{fields:{}}});on("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});on("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});on("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});on.get=function(e){return on[e]||null}});var $0=T((Az,H0)=>{"use strict";var Er=H0.exports=M0();Er.build="full";Er.tokenize=rg();Er.parse=G0();Er.common=W0();Er.Root._configure(Er.Type,Er.parse,Er.common)});var Jc=T((Rz,Q0)=>{"use strict";Q0.exports=$0()});var og=T((Dz,YO)=>{YO.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var e_=T((Y,Z0)=>{"use strict";var Et=Jc();Z0.exports=Y=Et.descriptor=Et.Root.fromJSON(og()).lookup(".google.protobuf");var Y0=Et.Namespace,Sa=Et.Root,Wn=Et.Enum,wr=Et.Type,_r=Et.Field,XO=Et.MapField,Zc=Et.OneOf,Ta=Et.Service,eu=Et.Method;Sa.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.FileDescriptorSet.decode(e));var t=new Sa;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(wr.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Wn.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(_r.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Ta.fromDescriptor(r.service[o]));var a=ws(r.options,Y.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Sa.prototype.toDescriptor=function(e){var t=Y.FileDescriptorSet.create();return X0(this,t.file,e),t};function X0(n,e,t){var r=Y.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Sa||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof wr?r.messageType.push(s.toDescriptor(t)):s instanceof Wn?r.enumType.push(s.toDescriptor()):s instanceof _r?r.extension.push(s.toDescriptor(t)):s instanceof Ta?r.service.push(s.toDescriptor()):s instanceof Y0&&X0(s,e,t);r.options=_s(n.options,Y.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var JO=0;wr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=Y.DescriptorProto.decode(e));var r=new wr(e.name.length?e.name:"Type"+JO++,ws(e.options,Y.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Zc.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=_r.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(_r.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(wr.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Wn.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};wr.prototype.toDescriptor=function(e){var t=Y.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof XO){var s=ag(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=ag(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&J0(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(Y.DescriptorProto.create({name:i.typeName,field:[Y.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),Y.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:Y.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof _r?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof wr?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Wn&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(Y.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(Y.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=_s(this.options,Y.MessageOptions),t};var ZO=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;_r.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=Y.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=ik(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new _r(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=ws(e.options,Y.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=ZO.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return sk(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};_r.prototype.toDescriptor=function(e){var t=Y.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Et.util.ucFirst(this.name),t.label=3;else{switch(t.type=ag(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?J0(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=_s(this.options,Y.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=Y.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=Y.FieldOptions.create())).packed=!0),t};var ek=0;Wn.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Wn(e.name&&e.name.length?e.name:"Enum"+ek++,t,ws(e.options,Y.EnumOptions))};Wn.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(Y.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return Y.EnumDescriptorProto.create({name:this.name,value:e,options:_s(this.options,Y.EnumOptions)})};var tk=0;Zc.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Y.OneofDescriptorProto.decode(e)),new Zc(e.name&&e.name.length?e.name:"oneof"+tk++)};Zc.prototype.toDescriptor=function(){return Y.OneofDescriptorProto.create({name:this.name})};var nk=0;Ta.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.ServiceDescriptorProto.decode(e));var t=new Ta(e.name&&e.name.length?e.name:"Service"+nk++,ws(e.options,Y.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(eu.fromDescriptor(e.method[r]));return t};Ta.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return Y.ServiceDescriptorProto.create({name:this.name,method:e,options:_s(this.options,Y.ServiceOptions)})};var rk=0;eu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Y.MethodDescriptorProto.decode(e)),new eu(e.name&&e.name.length?e.name:"Method"+rk++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,ws(e.options,Y.MethodOptions))};eu.prototype.toDescriptor=function(){return Y.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:_s(this.options,Y.MethodOptions)})};function ik(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function sk(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function ag(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Wn)return 14;if(e instanceof wr)return e.group?10:11;throw Error("illegal type: "+n)}function ws(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Wn&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(ok(s),o));return t.length?Et.util.toObject(t):void 0}}function _s(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Et.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Et.util.toObject(t)):void 0}}function J0(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Sa)&&e instanceof Y0)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function ok(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var t_=T((Nz,ak)=>{ak.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var n_=T((Oz,lk)=>{lk.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var r_=T((kz,ck)=>{ck.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var a_=T(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.addCommonProtos=Cr.loadProtosWithOptionsSync=Cr.loadProtosWithOptions=void 0;var i_=ae("fs"),s_=ae("path"),Cs=Jc();function o_(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(s_.isAbsolute(i))return i;for(let s of e){let o=s_.join(s,i);try{return i_.accessSync(o,i_.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function uk(n,e){return g(this,null,function*(){let t=new Cs.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));o_(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}Cr.loadProtosWithOptions=uk;function hk(n,e){let t=new Cs.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");o_(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}Cr.loadProtosWithOptionsSync=hk;function dk(){let n=t_(),e=og(),t=n_(),r=r_();Cs.common("api",n.nested.google.nested.protobuf.nested),Cs.common("descriptor",e.nested.google.nested.protobuf.nested),Cs.common("source_context",t.nested.google.nested.protobuf.nested),Cs.common("type",r.nested.google.nested.protobuf.nested)}Cr.addCommonProtos=dk});var u_=T((c_,lg)=>{"use strict";var l_=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(_,f,P){this.low=_|0,this.high=f|0,this.unsigned=!!P}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(_){return(_&&_.__isLong__)===!0}function i(_){var f=Math.clz32(_&-_);return _?31-f:f}t.isLong=r;var s={},o={};function a(_,f){var P,ne,Se;return f?(_>>>=0,(Se=0<=_&&_<256)&&(ne=o[_],ne)?ne:(P=c(_,0,!0),Se&&(o[_]=P),P)):(_|=0,(Se=-128<=_&&_<128)&&(ne=s[_],ne)?ne:(P=c(_,_<0?-1:0,!1),Se&&(s[_]=P),P))}t.fromInt=a;function l(_,f){if(isNaN(_))return f?k:B;if(f){if(_<0)return k;if(_>=E)return ot}else{if(_<=-D)return fe;if(_+1>=D)return Ge}return _<0?l(-_,f).neg():c(_%S|0,_/S|0,f)}t.fromNumber=l;function c(_,f,P){return new t(_,f,P)}t.fromBits=c;var u=Math.pow;function h(_,f,P){if(_.length===0)throw Error("empty string");if(typeof f=="number"?(P=f,f=!1):f=!!f,_==="NaN"||_==="Infinity"||_==="+Infinity"||_==="-Infinity")return f?k:B;if(P=P||10,P<2||36<P)throw RangeError("radix");var ne;if((ne=_.indexOf("-"))>0)throw Error("interior hyphen");if(ne===0)return h(_.substring(1),f,P).neg();for(var Se=l(u(P,8)),ue=B,Ne=0;Ne<_.length;Ne+=8){var me=Math.min(8,_.length-Ne),mt=parseInt(_.substring(Ne,Ne+me),P);if(me<8){var Fe=l(u(P,me));ue=ue.mul(Fe).add(l(mt))}else ue=ue.mul(Se),ue=ue.add(l(mt))}return ue.unsigned=f,ue}t.fromString=h;function d(_,f){return typeof _=="number"?l(_,f):typeof _=="string"?h(_,f):c(_.low,_.high,typeof f=="boolean"?f:_.unsigned)}t.fromValue=d;var p=65536,v=1<<24,S=p*p,E=S*S,D=E/2,C=a(v),B=a(0);t.ZERO=B;var k=a(0,!0);t.UZERO=k;var j=a(1);t.ONE=j;var W=a(1,!0);t.UONE=W;var Z=a(-1);t.NEG_ONE=Z;var Ge=c(-1,2147483647,!1);t.MAX_VALUE=Ge;var ot=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=ot;var fe=c(0,-2147483648,!1);t.MIN_VALUE=fe;var w=t.prototype;w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*S+(this.low>>>0):this.high*S+(this.low>>>0)},w.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(fe)){var P=l(f),ne=this.div(P),Se=ne.mul(P).sub(this);return ne.toString(f)+Se.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var ue=l(u(f,6),this.unsigned),Ne=this,me="";;){var mt=Ne.div(ue),Fe=Ne.sub(mt.mul(ue)).toInt()>>>0,be=Fe.toString(f);if(Ne=mt,Ne.isZero())return be+me;for(;be.length<6;)be="0"+be;me=""+be+me}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fe)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,P=31;P>0&&!(f&1<<P);P--);return this.high!=0?P+33:P+1},w.isZero=function(){return this.high===0&&this.low===0},w.eqz=w.isZero,w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return(this.low&1)===1},w.isEven=function(){return(this.low&1)===0},w.equals=function(f){return r(f)||(f=d(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},w.eq=w.equals,w.notEquals=function(f){return!this.eq(f)},w.neq=w.notEquals,w.ne=w.notEquals,w.lessThan=function(f){return this.comp(f)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(f){return this.comp(f)<=0},w.lte=w.lessThanOrEqual,w.le=w.lessThanOrEqual,w.greaterThan=function(f){return this.comp(f)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(f){return this.comp(f)>=0},w.gte=w.greaterThanOrEqual,w.ge=w.greaterThanOrEqual,w.compare=function(f){if(r(f)||(f=d(f)),this.eq(f))return 0;var P=this.isNegative(),ne=f.isNegative();return P&&!ne?-1:!P&&ne?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(fe)?fe:this.not().add(j)},w.neg=w.negate,w.add=function(f){r(f)||(f=d(f));var P=this.high>>>16,ne=this.high&65535,Se=this.low>>>16,ue=this.low&65535,Ne=f.high>>>16,me=f.high&65535,mt=f.low>>>16,Fe=f.low&65535,be=0,at=0,Be=0,yt=0;return yt+=ue+Fe,Be+=yt>>>16,yt&=65535,Be+=Se+mt,at+=Be>>>16,Be&=65535,at+=ne+me,be+=at>>>16,at&=65535,be+=P+Ne,be&=65535,c(Be<<16|yt,be<<16|at,this.unsigned)},w.subtract=function(f){return r(f)||(f=d(f)),this.add(f.neg())},w.sub=w.subtract,w.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=d(f)),e){var P=e.mul(this.low,this.high,f.low,f.high);return c(P,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?k:B;if(this.eq(fe))return f.isOdd()?fe:B;if(f.eq(fe))return this.isOdd()?fe:B;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(C)&&f.lt(C))return l(this.toNumber()*f.toNumber(),this.unsigned);var ne=this.high>>>16,Se=this.high&65535,ue=this.low>>>16,Ne=this.low&65535,me=f.high>>>16,mt=f.high&65535,Fe=f.low>>>16,be=f.low&65535,at=0,Be=0,yt=0,Hi=0;return Hi+=Ne*be,yt+=Hi>>>16,Hi&=65535,yt+=ue*be,Be+=yt>>>16,yt&=65535,yt+=Ne*Fe,Be+=yt>>>16,yt&=65535,Be+=Se*be,at+=Be>>>16,Be&=65535,Be+=ue*Fe,at+=Be>>>16,Be&=65535,Be+=Ne*mt,at+=Be>>>16,Be&=65535,at+=ne*be+Se*Fe+ue*mt+Ne*me,at&=65535,c(yt<<16|Hi,at<<16|Be,this.unsigned)},w.mul=w.multiply,w.divide=function(f){if(r(f)||(f=d(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var P=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(P,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?k:B;var ne,Se,ue;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return k;if(f.gt(this.shru(1)))return W;ue=k}else{if(this.eq(fe)){if(f.eq(j)||f.eq(Z))return fe;if(f.eq(fe))return j;var Ne=this.shr(1);return ne=Ne.div(f).shl(1),ne.eq(B)?f.isNegative()?j:Z:(Se=this.sub(f.mul(ne)),ue=ne.add(Se.div(f)),ue)}else if(f.eq(fe))return this.unsigned?k:B;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();ue=B}for(Se=this;Se.gte(f);){ne=Math.max(1,Math.floor(Se.toNumber()/f.toNumber()));for(var me=Math.ceil(Math.log(ne)/Math.LN2),mt=me<=48?1:u(2,me-48),Fe=l(ne),be=Fe.mul(f);be.isNegative()||be.gt(Se);)ne-=mt,Fe=l(ne,this.unsigned),be=Fe.mul(f);Fe.isZero()&&(Fe=j),ue=ue.add(Fe),Se=Se.sub(be)}return ue},w.div=w.divide,w.modulo=function(f){if(r(f)||(f=d(f)),e){var P=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(P,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},w.mod=w.modulo,w.rem=w.modulo,w.not=function(){return c(~this.low,~this.high,this.unsigned)},w.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},w.clz=w.countLeadingZeros,w.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},w.ctz=w.countTrailingZeros,w.and=function(f){return r(f)||(f=d(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},w.or=function(f){return r(f)||(f=d(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},w.xor=function(f){return r(f)||(f=d(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},w.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.shr_u=w.shiftRightUnsigned,w.rotateLeft=function(f){var P;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(P=32-f,c(this.low<<f|this.high>>>P,this.high<<f|this.low>>>P,this.unsigned)):(f-=32,P=32-f,c(this.high<<f|this.low>>>P,this.low<<f|this.high>>>P,this.unsigned))},w.rotl=w.rotateLeft,w.rotateRight=function(f){var P;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(P=32-f,c(this.high<<P|this.low>>>f,this.low<<P|this.high>>>f,this.unsigned)):(f-=32,P=32-f,c(this.low<<P|this.high>>>f,this.high<<P|this.low>>>f,this.unsigned))},w.rotr=w.rotateRight,w.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},w.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var f=this.high,P=this.low;return[P&255,P>>>8&255,P>>>16&255,P>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},w.toBytesBE=function(){var f=this.high,P=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,P>>>24,P>>>16&255,P>>>8&255,P&255]},t.fromBytes=function(f,P,ne){return ne?t.fromBytesLE(f,P):t.fromBytesBE(f,P)},t.fromBytesLE=function(f,P){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,P)},t.fromBytesBE=function(f,P){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],P)};var Ce=t;return n.default=Ce,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return l_}):typeof lg=="object"&&typeof c_=="object"&&(lg.exports=l_)});var dg=T(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.loadFileDescriptorSetFromObject=Ke.loadFileDescriptorSetFromBuffer=Ke.fromJSON=Ke.loadSync=Ke.load=Ke.IdempotencyLevel=Ke.isAnyExtension=Ke.Long=void 0;var fk=XE(),An=Jc(),ug=e_(),hg=a_(),pk=u_();Ke.Long=pk;function gk(n){return"@type"in n&&typeof n["@type"]=="string"}Ke.isAnyExtension=gk;var f_;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(f_=Ke.IdempotencyLevel||(Ke.IdempotencyLevel={}));var p_={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function mk(n,e){return n===""?e:n+"."+e}function yk(n){return n instanceof An.Service||n instanceof An.Type||n instanceof An.Enum}function vk(n){return n instanceof An.Namespace||n instanceof An.Root}function g_(n,e){let t=mk(e,n.name);return yk(n)?[[t,n]]:vk(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>g_(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function h_(n,e){return function(r){return n.toObject(n.decode(r),e)}}function d_(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function Sk(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:f_.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function Tk(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:d_(i),requestDeserialize:h_(i,t),responseSerialize:d_(s),responseDeserialize:h_(s,t),originalName:fk(n.name),requestType:cg(i,r),responseType:cg(s,r),options:Sk(n.parsedOptions)}}function Ek(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=Tk(s,e,t,r);return i}function cg(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,p_),fileDescriptorProtos:e}}function wk(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,p_),fileDescriptorProtos:e}}function _k(n,e,t,r){if(n instanceof An.Service)return Ek(n,e,t,r);if(n instanceof An.Type)return cg(n,r);if(n instanceof An.Enum)return wk(n,r);throw new Error("Type mismatch in reflection object handling")}function tu(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(ug.FileDescriptorProto.encode(s).finish()));for(let[s,o]of g_(n,""))t[s]=_k(o,s,e,i);return t}function m_(n,e){e=e||{};let t=An.Root.fromDescriptor(n);return t.resolveAll(),tu(t,e)}function Ck(n,e){return(0,hg.loadProtosWithOptions)(n,e).then(t=>tu(t,e))}Ke.load=Ck;function bk(n,e){let t=(0,hg.loadProtosWithOptionsSync)(n,e);return tu(t,e)}Ke.loadSync=bk;function Ik(n,e){e=e||{};let t=An.Root.fromJSON(n);return t.resolveAll(),tu(t,e)}Ke.fromJSON=Ik;function Ak(n,e){let t=ug.FileDescriptorSet.decode(n);return m_(t,e)}Ke.loadFileDescriptorSetFromBuffer=Ak;function Rk(n,e){let t=ug.FileDescriptorSet.fromObject(n);return m_(t,e)}Ke.loadFileDescriptorSetFromObject=Rk;(0,hg.addCommonProtos)()});var mi=T(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.setup=Te.getChannelzServiceDefinition=Te.getChannelzHandlers=Te.unregisterChannelzRef=Te.registerChannelzSocket=Te.registerChannelzServer=Te.registerChannelzSubchannel=Te.registerChannelzChannel=Te.ChannelzCallTracker=Te.ChannelzChildrenTracker=Te.ChannelzTrace=void 0;var y_=ae("net"),Ea=qt(),_a=ie(),Dk=vn(),Nk=wc(),Ok=cp();function fg(n){return{channel_id:n.id,name:n.name}}function yg(n){return{subchannel_id:n.id,name:n.name}}function kk(n){return{server_id:n.id}}function ru(n){return{socket_id:n.id,name:n.name}}var v_=32,pg=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=v_*2&&(this.events=this.events.slice(v_)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Hn(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Hn(e.timestamp),channel_ref:e.childChannel?fg(e.childChannel):null,subchannel_ref:e.childSubchannel?yg(e.childSubchannel):null}))}}};Te.ChannelzTrace=pg;var gg=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Te.ChannelzChildrenTracker=gg;var mg=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Te.ChannelzCallTracker=mg;var xk=1;function iu(){return xk++}var wa=[],vg=[],br=[],Sg=[];function Mk(n,e,t){let r=iu(),i={id:r,name:n,kind:"channel"};return t&&(wa[r]={ref:i,getInfo:e}),i}Te.registerChannelzChannel=Mk;function Pk(n,e,t){let r=iu(),i={id:r,name:n,kind:"subchannel"};return t&&(vg[r]={ref:i,getInfo:e}),i}Te.registerChannelzSubchannel=Pk;function Lk(n,e){let t=iu(),r={id:t,kind:"server"};return e&&(br[t]={ref:r,getInfo:n}),r}Te.registerChannelzServer=Lk;function Fk(n,e,t){let r=iu(),i={id:r,name:n,kind:"socket"};return t&&(Sg[r]={ref:i,getInfo:e}),i}Te.registerChannelzSocket=Fk;function Bk(n){switch(n.kind){case"channel":delete wa[n.id];return;case"subchannel":delete vg[n.id];return;case"server":delete br[n.id];return;case"socket":delete Sg[n.id];return}}Te.unregisterChannelzRef=Bk;function qk(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function S_(n){if(n==="")return[];let e=n.split(":").map(r=>qk(r));return[].concat(...e)}function Uk(n){if((0,y_.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,y_.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(S_(e)),s=Buffer.from(S_(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function E_(n){switch(n){case Ea.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Ea.ConnectivityState.IDLE:return{state:"IDLE"};case Ea.ConnectivityState.READY:return{state:"READY"};case Ea.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Ea.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Hn(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function w_(n){let e=n.getInfo();return{ref:fg(n.ref),data:{target:e.target,state:E_(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Hn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>fg(t)),subchannel_ref:e.children.subchannels.map(t=>yg(t))}}function Vk(n,e){let t=Number.parseInt(n.request.channel_id),r=wa[t];if(r===void 0){e({code:_a.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:w_(r)})}function zk(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<wa.length;i++){let s=wa[i];if(s!==void 0&&(r.push(w_(s)),r.length>=t))break}e(null,{channel:r,end:i>=br.length})}function __(n){let e=n.getInfo();return{ref:kk(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Hn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ru(t))}}function Gk(n,e){let t=Number.parseInt(n.request.server_id),r=br[t];if(r===void 0){e({code:_a.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:__(r)})}function jk(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<br.length;i++){let s=br[i];if(s!==void 0&&(r.push(__(s)),r.length>=t))break}e(null,{server:r,end:i>=br.length})}function Kk(n,e){let t=Number.parseInt(n.request.subchannel_id),r=vg[t];if(r===void 0){e({code:_a.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:yg(r.ref),data:{target:i.target,state:E_(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Hn(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>ru(o))};e(null,{subchannel:s})}function T_(n){var e;return(0,Dk.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=Uk(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function Wk(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Sg[a];if(l===void 0){e({code:_a.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,h={ref:ru(l.ref),local:c.localAddress?T_(c.localAddress):null,remote:c.remoteAddress?T_(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Hn(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Hn(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Hn(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Hn(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:h})}function Hk(n,e){let t=Number.parseInt(n.request.server_id),r=br[t];if(r===void 0){e({code:_a.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,h)=>u.id-h.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(ru(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function C_(){return{GetChannel:Vk,GetTopChannels:zk,GetServer:Gk,GetServers:jk,GetSubchannel:Kk,GetSocket:Wk,GetServerSockets:Hk}}Te.getChannelzHandlers=C_;var nu=null;function b_(){if(nu)return nu;let n=dg().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return nu=(0,Ok.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,nu}Te.getChannelzServiceDefinition=b_;function $k(){(0,Nk.registerAdminService)(b_,C_)}Te.setup=$k});var I_=T(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.Subchannel=void 0;var ge=qt(),Qk=na(),Tg=Ae(),su=ie(),Yk=Ot(),Xk=vn(),bs=mi(),Jk="subchannel",Zk=~(1<<31),Eg=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=ge.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new bs.ChannelzCallTracker,this.childrenTracker=new bs.ChannelzChildrenTracker,this.streamTracker=new bs.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Qk.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,Xk.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new bs.ChannelzTrace,this.channelzRef=(0,bs.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Tg.trace(su.LogVerbosity.DEBUG,Jk,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Tg.trace(su.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([ge.ConnectivityState.TRANSIENT_FAILURE],ge.ConnectivityState.CONNECTING):this.transitionToState([ge.ConnectivityState.TRANSIENT_FAILURE],ge.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,Zk);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([ge.ConnectivityState.CONNECTING],ge.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([ge.ConnectivityState.READY],ge.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Tg.log(su.LogVerbosity.ERROR,`Connection to ${(0,Yk.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([ge.ConnectivityState.CONNECTING],ge.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(ge.ConnectivityState[this.connectivityState]+" -> "+ge.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ge.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case ge.ConnectivityState.READY:this.stopBackoff();break;case ge.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case ge.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case ge.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,bs.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([ge.ConnectivityState.CONNECTING,ge.ConnectivityState.READY],ge.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===su.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([ge.ConnectivityState.IDLE],ge.ConnectivityState.CONNECTING)||this.connectivityState===ge.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([ge.ConnectivityState.TRANSIENT_FAILURE],ge.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};ou.Subchannel=Eg});var bg=T(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.setup=Rr.DEFAULT_PORT=void 0;var A_=mn(),D_=ae("dns"),N_=ae("util"),ex=Lf(),wg=ie(),_g=Tt(),tx=Ae(),nx=ie(),Ir=Ot(),R_=ae("net"),rx=na(),ix="dns_resolver";function Ar(n){tx.trace(nx.LogVerbosity.DEBUG,ix,n)}Rr.DEFAULT_PORT=443;var sx=3e4,ox=N_.promisify(D_.resolveTxt),ax=N_.promisify(D_.lookup);function lx(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Cg=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Ar("Resolver constructed for target "+(0,Ir.uriToString)(e));let a=(0,Ir.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,R_.isIPv4)(a.host)||(0,R_.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Rr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Rr.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:wg.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Ir.uriToString)(this.target)}`,metadata:new _g.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new rx.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:sx,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Ar("Returning IP address for target "+(0,Ir.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Ar("Failed to parse DNS address "+(0,Ir.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:wg.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Ir.uriToString)(this.target)}`,metadata:new _g.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Ar("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=ax(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=lx(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(Ar("Resolved addresses for target "+(0,Ir.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Ar("Resolution error for target "+(0,Ir.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=ox(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,ex.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:wg.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new _g.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Ar('resolution update delayed by "min time between resolutions" rate limit'):Ar("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function cx(){(0,A_.registerResolver)("dns",Cg),(0,A_.registerDefaultScheme)("dns")}Rr.setup=cx});var Ig=T(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});Rs.getProxiedConnection=Rs.mapProxyName=void 0;var Ca=Ae(),Is=ie(),ux=mn(),hx=ae("http"),dx=ae("tls"),fx=Ae(),O_=vn(),As=Ot(),px=ae("url"),gx=bg(),mx="proxy";function Dr(n){fx.trace(Is.LogVerbosity.DEBUG,mx,n)}function yx(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new px.URL(n)}catch{return(0,Ca.log)(Is.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Ca.log)(Is.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Ca.log)(Is.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Dr("Proxy server "+o.address+" set by environment variable "+e),o}function vx(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Dr("No proxy server list set by environment variable "+e),n.split(",")):[]}function Sx(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=yx();if(!i.address)return r;let s=(0,As.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of vx())if(l===o)return Dr("Not using proxy for target in no_proxy list: "+(0,As.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,As.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Rs.mapProxyName=Sx;function Tx(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,As.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,As.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:gx.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,O_.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,O_.subchannelAddressToString)(n);return Dr("Using proxy "+u+" to connect to "+l.path),new Promise((h,d)=>{let p=hx.request(l);p.once("connect",(v,S,E)=>{var D;if(p.removeAllListeners(),S.removeAllListeners(),v.statusCode===200)if(Dr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let C=(0,ux.getDefaultAuthority)(s),B=(0,As.splitHostPort)(C),k=(D=B?.host)!==null&&D!==void 0?D:C,j=dx.connect(Object.assign({host:k,servername:k,socket:S},t),()=>{Dr("Successfully established a TLS connection to "+l.path+" through proxy "+u),h({socket:j,realTarget:s})});j.on("error",W=>{Dr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+W.message),d()})}else Dr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),h({socket:S,realTarget:s});else(0,Ca.log)(Is.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+v.statusCode),d()}),p.once("error",v=>{p.removeAllListeners(),(0,Ca.log)(Is.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+v.message),d()}),p.end()})}Rs.getProxiedConnection=Tx});var Rg=T(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.StreamDecoder=void 0;var $n=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}($n||{}),Ag=class{constructor(){this.readState=$n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case $n.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=$n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case $n.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=$n.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=$n.NO_DATA,i.push(s)}break;case $n.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=$n.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};au.StreamDecoder=Ag});var k_=T(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.Http2SubchannelCall=void 0;var Qn=ae("http2"),Ex=ae("os"),he=ie(),Nr=Tt(),wx=Rg(),_x=Ae(),Cx=ie(),bx="subchannel_call";function Ix(n){for(let[e,t]of Object.entries(Ex.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Dg=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new wx.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=he.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=he.Status.INTERNAL;break;case 401:this.mappedStatusCode=he.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=he.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=he.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=he.Status.UNAVAILABLE;break;default:this.mappedStatusCode=he.Status.UNKNOWN}if(a&Qn.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=Nr.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:he.Status.UNKNOWN,details:u.message,metadata:new Nr.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===he.Status.OK)return;let a,l="";switch(e.rstCode){case Qn.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=he.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case Qn.constants.NGHTTP2_REFUSED_STREAM:a=he.Status.UNAVAILABLE,l="Stream refused by server";break;case Qn.constants.NGHTTP2_CANCEL:a=he.Status.CANCELLED,l="Call cancelled";break;case Qn.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=he.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case Qn.constants.NGHTTP2_INADEQUATE_SECURITY:a=he.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case Qn.constants.NGHTTP2_INTERNAL_ERROR:a=he.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=he.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=he.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new Nr.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+Ix(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:he.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Nr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){_x.trace(Cx.LogVerbosity.DEBUG,bx,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===he.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==he.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Nr.Metadata.fromHttp2Headers(e)}catch{r=new Nr.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===he.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in he.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===he.Status.OK?t=Qn.constants.NGHTTP2_NO_ERROR:t=Qn.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Nr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==he.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=he.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=he.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:he.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Nr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};lu.Http2SubchannelCall=Dg});var Ng=T(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});cu.getNextCallNumber=void 0;var Ax=0;function Rx(){return Ax++}cu.getNextCallNumber=Rx});var P_=T(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.Http2SubchannelConnector=void 0;var Pg=ae("http2"),x_=ae("tls"),Og=mi(),ba=ie(),Dx=Ig(),Ns=Ae(),M_=mn(),uu=vn(),Ds=Ot(),Nx=ae("net"),Ox=k_(),kx=Ng(),kg="transport",xx="transport_flowctrl",Mx=vf().version,{HTTP2_HEADER_AUTHORITY:Px,HTTP2_HEADER_CONTENT_TYPE:Lx,HTTP2_HEADER_METHOD:Fx,HTTP2_HEADER_PATH:Bx,HTTP2_HEADER_TE:qx,HTTP2_HEADER_USER_AGENT:Ux}=Pg.constants,Vx=2e4,zx=Buffer.from("too_many_pings","ascii"),xg=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=Vx,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Og.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,uu.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Og.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${Mx}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Pg.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(zx)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Ns.isTracerEnabled(kg)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,uu.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,uu.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),h=c.getCertificate(),d=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:h&&"raw"in h?h.raw:null,remoteCertificate:d&&"raw"in d?d.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Ns.trace(ba.LogVerbosity.DEBUG,kg,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Ns.trace(ba.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Ns.trace(ba.LogVerbosity.DEBUG,xx,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Ns.trace(ba.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[Px]=t,o[Ux]=this.userAgent,o[Lx]="application/grpc",o[Fx]="POST",o[Bx]=r,o[qx]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}},c=new Ox.Http2SubchannelCall(a,l,i,this,(0,kx.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,Og.unregisterChannelzRef)(this.channelzRef)}},Mg=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Ns.trace(ba.LogVerbosity.DEBUG,kg,(0,Ds.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Ds.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Ds.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,uu.subchannelAddressToString)(e)));let h=(0,M_.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),d=t._getConnectionOptions()||{};d.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?d.maxSessionMemory=r["grpc-node.max_session_memory"]:d.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in d){if(p="https://",r["grpc.ssl_target_name_override"]){let E=r["grpc.ssl_target_name_override"];d.checkServerIdentity=(D,C)=>(0,x_.checkServerIdentity)(E,C),d.servername=E}else{let E=(c=(l=(0,Ds.splitHostPort)(h))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";d.servername=E}i.socket&&(d.createConnection=(E,D)=>i.socket)}else d.createConnection=(E,D)=>i.socket?i.socket:Nx.connect(e);d=Object.assign(Object.assign(Object.assign({},d),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let v=Pg.connect(p+h,d);this.session=v;let S="Failed to connect";v.unref(),v.once("connect",()=>{v.removeAllListeners(),s(new xg(v,e,r,u)),this.session=null}),v.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),v.once("error",E=>{S=E.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,x_.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,M_.getDefaultAuthority)((i=(0,Ds.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Ds.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,Dx.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};hu.Http2SubchannelConnector=Mg});var L_=T(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.getSubchannelPool=Os.SubchannelPool=void 0;var Gx=SE(),jx=I_(),Kx=vn(),Wx=Ot(),Hx=P_(),$x=1e4,Ia=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},$x),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,Wx.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,Kx.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,Gx.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new jx.Subchannel(e,t,r,i,new Hx.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Os.SubchannelPool=Ia;var Qx=new Ia;function Yx(n){return n?Qx:new Ia}Os.getSubchannelPool=Yx});var Fg=T(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.FilterStackFactory=ks.FilterStack=void 0;var du=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};ks.FilterStack=du;var Lg=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new du(this.factories.map(e=>e.createFilter()))}};ks.FilterStackFactory=Lg});var Bg=T(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});fu.CompressionAlgorithms=void 0;var F_=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(F_||(fu.CompressionAlgorithms=F_={}))});var gu=T(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.BaseFilter=void 0;var qg=class{sendMetadata(e){return g(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return g(this,null,function*(){return e})}receiveMessage(e){return g(this,null,function*(){return e})}receiveTrailers(e){return e}};pu.BaseFilter=qg});var U_=T(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.CompressionFilterFactory=Ms.CompressionFilter=void 0;var mu=ae("zlib"),q_=Bg(),Xx=ie(),Jx=gu(),Zx=Ae(),eM=n=>typeof n=="number"&&typeof q_.CompressionAlgorithms[n]=="string",xs=class{writeMessage(e,t){return g(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return g(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},yi=class extends xs{compressMessage(e){return g(this,null,function*(){return e})}writeMessage(e,t){return g(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Ug=class extends xs{compressMessage(e){return new Promise((t,r)=>{mu.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{mu.inflate(e,(i,s)=>{i?r(i):t(s)})})}},Vg=class extends xs{compressMessage(e){return new Promise((t,r)=>{mu.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{mu.unzip(e,(i,s)=>{i?r(i):t(s)})})}},zg=class extends xs{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function B_(n){switch(n){case"identity":return new yi;case"deflate":return new Ug;case"gzip":return new Vg;default:return new zg(n)}}var yu=class extends Jx.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new yi,this.receiveCompression=new yi,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(eM(i)){let s=q_.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=B_(this.currentCompressionAlgorithm))}else Zx.log(Xx.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return g(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=B_(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new yi,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return g(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof yi?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return g(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Ms.CompressionFilter=yu;var Gg=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new yu(this.options,this.sharedFilterConfig)}};Ms.CompressionFilterFactory=Gg});var z_=T(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.MaxMessageSizeFilterFactory=Ps.MaxMessageSizeFilter=void 0;var tM=gu(),vu=ie(),V_=Tt(),Su=class extends tM.BaseFilter{constructor(e){super(),this.maxSendMessageSize=vu.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=vu.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return g(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:vu.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new V_.Metadata};return t}})}receiveMessage(e){return g(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:vu.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new V_.Metadata};return t}})}};Ps.MaxMessageSizeFilter=Su;var jg=class{constructor(e){this.options=e}createFilter(){return new Su(this.options)}};Ps.MaxMessageSizeFilterFactory=jg});var Tu=T(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.deadlineToString=Rn.getRelativeTimeout=Rn.getDeadlineTimeoutString=Rn.minDeadline=void 0;function nM(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Rn.minDeadline=nM;var rM=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function iM(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of rM){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Rn.getDeadlineTimeoutString=iM;var sM=2147483647;function oM(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>sM?1/0:r}Rn.getRelativeTimeout=oM;function aM(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Rn.deadlineToString=aM});var wu=T(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.restrictControlPlaneStatusCode=void 0;var Dn=ie(),lM=[Dn.Status.OK,Dn.Status.INVALID_ARGUMENT,Dn.Status.NOT_FOUND,Dn.Status.ALREADY_EXISTS,Dn.Status.FAILED_PRECONDITION,Dn.Status.ABORTED,Dn.Status.OUT_OF_RANGE,Dn.Status.DATA_LOSS];function cM(n,e){return lM.includes(n)?{code:Dn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Dn.Status[n]} ${e}`}:{code:n,details:e}}Eu.restrictControlPlaneStatusCode=cM});var j_=T(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.LoadBalancingCall=void 0;var G_=qt(),_u=ie(),uM=Tu(),Cu=Tt(),Aa=pr(),hM=Ot(),dM=Ae(),Kg=wu(),fM=ae("http2"),pM="load_balancing_call",Wg=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),h="";u.length>=2&&(h=u[1]);let d=(c=(l=(0,hM.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){dM.trace(_u.LogVerbosity.DEBUG,pM,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Aa.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Aa.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let h=this.metadata.clone();if(h.merge(a),h.get("authorization").length>1&&this.outputStatus({code:_u.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Cu.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==G_.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+G_.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&h.set("grpc-timeout",(0,uM.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(h,this.host,this.methodName,{onReceiveMetadata:d=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(d)},onReceiveMessage:d=>{this.trace("Received message"),this.listener.onReceiveMessage(d)},onReceiveStatus:d=>{this.trace("Received status"),d.rstCode===fM.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(d,"REFUSED"):this.outputStatus(d,"PROCESSED")}})}catch(d){this.trace("Failed to start call on picked subchannel "+i+" with error "+d.message),this.outputStatus({code:_u.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+d.message,metadata:new Cu.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Kg.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:_u.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new Cu.Metadata},"PROCESSED")});break;case Aa.PickResultType.DROP:let{code:s,details:o}=(0,Kg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Aa.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Kg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Aa.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Cu.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};bu.LoadBalancingCall=Wg});var W_=T(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.ResolvingCall=void 0;var Ls=ie(),Iu=Tu(),K_=Tt(),gM=Ae(),mM=wu(),yM="resolving_call",Hg=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Ls.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Ls.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Ls.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Iu.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){gM.trace(Ls.LogVerbosity.DEBUG,yM,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Iu.deadlineToString)(this.deadline));let e=(0,Iu.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Ls.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Ls.Status.OK){let{code:r,details:i}=(0,mM.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new K_.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Iu.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new K_.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Au.ResolvingCall=Hg});var H_=T(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.RetryingCall=Or.MessageBufferTracker=Or.RetryThrottler=void 0;var Ru=ie(),vM=Tt(),SM=Ae(),TM="retrying_call",Qg=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Or.RetryThrottler=Qg;var Yg=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Or.MessageBufferTracker=Yg;var $g="grpc-previous-rpc-attempts",Xg=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){SM.trace(Ru.LogVerbosity.DEBUG,TM,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new vM.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Ru.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Ru.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Ru.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set($g,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set($g,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set($g,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Or.RetryingCall=Xg});var Nu=T(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});Du.BaseSubchannelWrapper=void 0;var Jg=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Du.BaseSubchannelWrapper=Jg});var Y_=T(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});xu.InternalChannel=void 0;var EM=fc(),wM=vE(),_M=L_(),$_=pr(),Ra=ie(),CM=Fg(),bM=U_(),Q_=mn(),Zg=Ae(),IM=z_(),AM=Ig(),Ou=Ot(),Nn=qt(),Da=mi(),RM=j_(),DM=Tu(),NM=W_(),em=Ng(),OM=wu(),tm=H_(),kM=Nu(),xM=2147483647,MM=1e3,PM=30*60*1e3,ku=new Map,LM=1<<24,FM=1<<20,nm=class extends kM.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},rm=class{constructor(e,t,r){var i,s,o,a,l,c,u,h;if(this.credentials=t,this.options=r,this.connectivityState=Nn.ConnectivityState.IDLE,this.currentPicker=new $_.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Da.ChannelzCallTracker,this.childrenTracker=new Da.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof EM.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let d=(0,Ou.parseUri)(e);if(d===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,Q_.mapUriDefaultScheme)(d);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},xM),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Da.ChannelzTrace,this.channelzRef=(0,Da.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,Q_.getDefaultAuthority)(p);let v=(0,AM.mapProxyName)(p,r);this.target=v.target,this.options=Object.assign({},this.options,v.extraOptions),this.subchannelPool=(0,_M.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new tm.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:LM,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:FM),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:PM,MM);let S={createSubchannel:(D,C)=>{let B=this.subchannelPool.getOrCreateSubchannel(this.target,D,Object.assign({},this.options,C),this.credentials);B.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",B.getChannelzRef());let k=new nm(B,this);return this.wrappedSubchannels.add(k),k},updateState:(D,C)=>{this.currentPicker=C;let B=this.pickQueue.slice();this.pickQueue=[],B.length>0&&this.callRefTimerUnref();for(let k of B)k.doPick();this.updateState(D)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:D=>{this.channelzEnabled&&this.childrenTracker.refChild(D)},removeChannelzChild:D=>{this.channelzEnabled&&this.childrenTracker.unrefChild(D)}};this.resolvingLoadBalancer=new wM.ResolvingLoadBalancer(this.target,S,r,(D,C)=>{D.retryThrottling?ku.set(this.getTarget(),new tm.RetryThrottler(D.retryThrottling.maxTokens,D.retryThrottling.tokenRatio,ku.get(this.getTarget()))):ku.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=C,this.currentResolutionError=null,process.nextTick(()=>{let B=this.configSelectionQueue;this.configSelectionQueue=[],B.length>0&&this.callRefTimerUnref();for(let k of B)k.getConfig()})},D=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+D.code+' and details "'+D.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,OM.restrictControlPlaneStatusCode)(D.code,D.details)),{metadata:D.metadata}));let C=this.configSelectionQueue;this.configSelectionQueue=[],C.length>0&&this.callRefTimerUnref();for(let B of C)B.reportResolverError(D)}),this.filterStackFactory=new CM.FilterStackFactory([new IM.MaxMessageSizeFilterFactory(this.options),new bM.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let E=new Error;(0,Zg.trace)(Ra.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((h=E.stack)===null||h===void 0?void 0:h.substring(E.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Zg.trace)(t??Ra.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Ou.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Zg.trace)(Ra.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Ou.uriToString)(this.target)+" "+Nn.ConnectivityState[this.connectivityState]+" -> "+Nn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Nn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Nn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Nn.ConnectivityState.IDLE),this.currentPicker=new $_.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Nn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Ra.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,em.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new RM.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,em.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new tm.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,ku.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,em.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,DM.deadlineToString)(t));let a={deadline:t,flags:s??Ra.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new NM.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Nn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Da.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Ou.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Nn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Nn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};xu.InternalChannel=rm});var ap=T(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});Mu.ChannelImplementation=void 0;var BM=fc(),qM=Y_(),im=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof BM.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new qM.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Mu.ChannelImplementation=im});var oC=T($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.Http2ServerCallStream=$t.ServerDuplexStreamImpl=$t.ServerWritableStreamImpl=$t.ServerReadableStreamImpl=$t.ServerUnaryCallImpl=void 0;var tC=ae("events"),Fs=ae("http2"),am=ae("stream"),nC=ae("zlib"),rC=ae("util"),Ee=ie(),lm=Tt(),UM=Rg(),iC=Ae(),Oa=ac(),sC="server_call",VM=(0,rC.promisify)(nC.unzip),zM=(0,rC.promisify)(nC.inflate);function Na(n){iC.trace(Ee.LogVerbosity.DEBUG,sC,n)}var GM="grpc-accept-encoding",jM="grpc-encoding",X_="grpc-message",J_="grpc-status",Z_="grpc-timeout",KM=/(\d{1,8})\s*([HMSmun])/,WM={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},HM={[GM]:"identity,deflate,gzip",[jM]:"identity"},eC={[Fs.constants.HTTP2_HEADER_STATUS]:Fs.constants.HTTP_STATUS_OK,[Fs.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},$M={waitForTrailers:!0},sm=class extends tC.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};$t.ServerUnaryCallImpl=sm;var Pu=class extends am.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};$t.ServerReadableStreamImpl=Pu;var ka=class extends am.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new lm.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Oa.getErrorMessage)(i),code:Ee.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Ee.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};$t.ServerWritableStreamImpl=ka;var Bs=class extends am.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new lm.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};$t.ServerDuplexStreamImpl=Bs;Bs.prototype._read=Pu.prototype._read;Bs.prototype._write=ka.prototype._write;Bs.prototype._final=ka.prototype._final;var om=class extends tC.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Ee.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ee.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Na("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Ee.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?zM(e.subarray(5)):t==="gzip"?VM(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:Ee.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},eC),HM),t);this.stream.respond(r,$M)}receiveMetadata(e){let t=lm.Metadata.fromHttp2Headers(e);iC.isTracerEnabled(sC)&&Na("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(Z_);if(r.length>0){let i=r[0].toString().match(KM);if(i===null){let a=new Error("Invalid deadline");return a.code=Ee.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*WM[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(QM,s,this),t.remove(Z_)}return t.remove(Fs.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Fs.constants.HTTP2_HEADER_TE),t.remove(Fs.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(h){if(s+=h.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Ee.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(h)}function u(h){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),h!==void 0){r({code:Ee.Status.INTERNAL,details:h.message});return}if(s===0){r({code:Ee.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let d=Buffer.concat(a,s),v=d.readUInt8(0)===1?e:"identity",S=o.getDecompressedMessage(d,v);if(Buffer.isBuffer(S)){t(o.deserializeMessageWithInternalError(S));return}S.then(E=>t(o.deserializeMessageWithInternalError(E)),E=>r(E.code?E:{code:Ee.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return g(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Oa.getErrorMessage)(t),code:Ee.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return g(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Ee.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Oa.getErrorMessage)(s),code:Ee.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Ee.Status.OK),!this.checkCancelled())if(Na("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Ee.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[J_]:e.code,[X_]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[J_]:e.code,[X_]:encodeURI(e.details)},eC),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Ee.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Ee.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new UM.StreamDecoder,i=!1,s=!1,o=!1,a=()=>g(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>g(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:Ee.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let d=u.readUInt8(0)===1?t:"identity",p=yield this.getDecompressedMessage(u,d);if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>g(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return g(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return g(this,null,function*(){if(t===null){Na("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Na("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Oa.getErrorCode)(r);(i===null||i<Ee.Status.OK||i>Ee.Status.UNAUTHENTICATED)&&(i=Ee.Status.INTERNAL),e.emit("error",{details:(0,Oa.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};$t.Http2ServerCallStream=om;function QM(n){let e=new Error("Deadline exceeded");e.code=Ee.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var hm=T(Lu=>{"use strict";Object.defineProperty(Lu,"__esModule",{value:!0});Lu.ServerCredentials=void 0;var aC=Of(),xa=class{static createInsecure(){return new cm}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new um({ca:e||(0,aC.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:aC.CIPHER_SUITES})}};Lu.ServerCredentials=xa;var cm=class extends xa{_isSecure(){return!1}_getSettings(){return null}},um=class extends xa{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var uC=T(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});qu.Server=void 0;var kr=ae("http2"),Yn=ie(),vi=oC(),YM=hm(),lC=mn(),Fu=Ae(),an=vn(),XM=Ot(),At=mi(),Bu=~(1<<31),JM=~(1<<31),ZM=2e4,{HTTP2_HEADER_PATH:cC}=kr.constants,eP="server";function tP(){}function dm(n){return{code:Yn.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function nP(n,e){let t=dm(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var fm=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new At.ChannelzTrace,this.callTracker=new At.ChannelzCallTracker,this.listenerChildrenTracker=new At.ChannelzChildrenTracker,this.sessionChildrenTracker=new At.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,At.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Bu,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Bu,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:JM,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:ZM,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,an.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,an.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let h=o,d=h.getCipher(),p=h.getCertificate(),v=h.getPeerCertificate();c={cipherSuiteStandardName:(t=d.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:d.standardName?null:d.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:v&&"raw"in v?v.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Fu.trace(Yn.LogVerbosity.DEBUG,eP,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=nP(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof YM.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,XM.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,lC.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,v)=>{process.nextTick(()=>r(p,v))},l=()=>{let p;if(t._isSecure()){let v=Object.assign(o,t._getSettings());v.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=kr.createSecureServer(v),p.on("secureConnection",S=>{S.on("error",E=>{this.trace("An incoming TLS connection closed with error: "+E.message)})})}else p=kr.createServer(o);return p.setTimeout(0,tP),this._setupHandlers(p),p},c=(p,v,S)=>p.length===0?Promise.resolve({port:v,count:S}):Promise.all(p.map(E=>{this.trace("Attempting to bind "+(0,an.subchannelAddressToString)(E));let D;(0,an.isTcpSubchannelAddress)(E)?D={host:E.host,port:v}:D=E;let C=l();return new Promise((B,k)=>{let j=W=>{this.trace("Failed to bind "+(0,an.subchannelAddressToString)(E)+" with error "+W.message),B(W)};C.once("error",j),C.listen(D,()=>{if(this.shutdown){C.close(),B(new Error("bindAsync failed because server is shutdown"));return}let W=C.address(),Z;typeof W=="string"?Z={path:W}:Z={host:W.address,port:W.port};let Ge=(0,At.registerChannelzSocket)((0,an.subchannelAddressToString)(Z),()=>({localAddress:Z,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(Ge),this.http2ServerList.push({server:C,channelzRef:Ge}),this.trace("Successfully bound "+(0,an.subchannelAddressToString)(Z)),B("port"in Z?Z.port:v),C.removeListener("error",j)})})})).then(E=>{let D=0;for(let C of E)if(typeof C=="number"&&(D+=1,C!==v))throw new Error("Invalid state: multiple port numbers added from single address");return{port:v,count:D+S}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let v=p[0],S=l();return new Promise((E,D)=>{let C=B=>{this.trace("Failed to bind "+(0,an.subchannelAddressToString)(v)+" with error "+B.message),E(u(p.slice(1)))};S.once("error",C),S.listen(v,()=>{if(this.shutdown){S.close(),E({port:0,count:0});return}let B=S.address(),k={host:B.address,port:B.port},j=(0,At.registerChannelzSocket)((0,an.subchannelAddressToString)(k),()=>({localAddress:k,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(j),this.http2ServerList.push({server:S,channelzRef:j}),this.trace("Successfully bound "+(0,an.subchannelAddressToString)(k)),E(c(p.slice(1),B.port,1)),S.removeListener("error",C)})})},h={onSuccessfulResolution:(p,v,S)=>{if(h.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let E;(0,an.isTcpSubchannelAddress)(p[0])?p[0].port===0?E=u(p):E=c(p,p[0].port,0):E=c(p,1,0),E.then(D=>{if(D.count===0){let C=`No address added out of total ${p.length} resolved`;Fu.log(Yn.LogVerbosity.ERROR,C),a(new Error(C),0)}else D.count<p.length&&Fu.log(Yn.LogVerbosity.INFO,`WARNING Only ${D.count} addresses added out of total ${p.length} resolved`),a(null,D.port)},D=>{let C=`No address added out of total ${p.length} resolved`;Fu.log(Yn.LogVerbosity.ERROR,C),a(new Error(C),0)})},onError:p=>{a(new Error(p.details),0)}};(0,lC.createResolver)(s,h,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,At.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(kr.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,At.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,At.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,At.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[kr.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[kr.constants.HTTP2_HEADER_STATUS]:kr.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new vi.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Yn.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[cC],s=this._retrieveHandler(i);if(!s){this._respondWithError(dm(i),e,r);return}let o=new vi.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Yn.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Yn.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[cC],i=this._retrieveHandler(r);if(!i){this._respondWithError(dm(r),e,null);return}let s=new vi.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Yn.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")rP(e,t,s,o);else if(a==="clientStream")iP(e,t,s,o);else if(a==="serverStream")sP(e,t,s,o);else if(a==="bidi")oP(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let h=(0,At.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),d={ref:h,streamTracker:new At.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,d);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(h));let v=null,S=null,E=!1;if(this.maxConnectionAgeMs!==Bu){let C=this.maxConnectionAgeMs/10,B=Math.random()*C*2-C;v=(l=(a=setTimeout(()=>{var k,j;E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(kr.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Bu&&(S=(j=(k=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||j===void 0?void 0:j.call(k))},this.maxConnectionAgeMs+B)).unref)===null||l===void 0?void 0:l.call(a)}let D=(u=(c=setInterval(()=>{var C,B;let k=(B=(C=setTimeout(()=>{E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||B===void 0?void 0:B.call(C);try{s.ping((j,W,Z)=>{clearTimeout(k)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(E||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(h),(0,At.unregisterChannelzRef)(h)),v&&clearTimeout(v),S&&clearTimeout(S),D&&clearTimeout(D),this.sessions.delete(s)})})}};qu.Server=fm;function rP(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new vi.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function iP(n,e,t,r){let i=new vi.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function sP(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new vi.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function oP(n,e,t,r){let i=new vi.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var hC=T(Uu=>{"use strict";Object.defineProperty(Uu,"__esModule",{value:!0});Uu.StatusBuilder=void 0;var pm=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Uu.StatusBuilder=pm});var gm=T(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.isDuration=xr.durationToMs=xr.msToDuration=void 0;function aP(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}xr.msToDuration=aP;function lP(n){return n.seconds*1e3+n.nanos/1e6|0}xr.durationToMs=lP;function cP(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}xr.isDuration=cP});var _m=T(Mr=>{"use strict";var mm;Object.defineProperty(Mr,"__esModule",{value:!0});Mr.setup=Mr.OutlierDetectionLoadBalancer=Mr.OutlierDetectionLoadBalancingConfig=void 0;var zu=qt(),fC=ie(),Si=gm(),pC=Cm(),gC=ur(),uP=Tc(),hP=pr(),dC=vn(),dP=Nu(),fP=Ae(),pP="outlier_detection";function Xe(n){fP.trace(fC.LogVerbosity.DEBUG,pP,n)}var wm="outlier_detection",gP=((mm=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&mm!==void 0?mm:"true")==="true",mP={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},yP={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function qs(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function ym(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Si.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Vu(n,e,t){let r=t?`${t}.${e}`:e;if(qs(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var Ma=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},mP),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},yP),o):null}getLoadBalancerName(){return wm}toJsonObject(){return{interval:(0,Si.msToDuration)(this.intervalMs),base_ejection_time:(0,Si.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Si.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(ym(e,"interval"),ym(e,"base_ejection_time"),ym(e,"max_ejection_time"),Vu(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");qs(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Vu(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),qs(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),qs(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Vu(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Vu(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),qs(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),qs(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Si.durationToMs)(e.interval):null,e.base_ejection_time?(0,Si.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Si.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(gC.validateLoadBalancingConfig))}};Mr.OutlierDetectionLoadBalancingConfig=Ma;var Sm=class extends dP.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?zu.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,zu.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,zu.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function vm(){return{success:0,failure:0}}var Tm=class{constructor(){this.activeBucket=vm(),this.inactiveBucket=vm()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=vm()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Em=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===hP.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===fC.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Gu=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new uP.ChildLoadBalancerHandler((0,pC.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,dC.subchannelAddressToString)(t)),o=new Sm(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===zu.ConnectivityState.READY?e.updateState(t,new Em(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Xe("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[h,d]of this.addressMap){let p=d.counter.getLastSuccesses(),v=d.counter.getLastFailures();Xe("Stats for "+h+": successes="+p+" failures="+v+" targetRequestVolume="+r),p+v>=r&&(i+=1,s.push(p/(p+v)))}if(Xe("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((h,d)=>h+d)/s.length,a=0;for(let h of s){let d=h-o;a+=d*d}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);Xe("stdev="+c+" ejectionThreshold="+u);for(let[h,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=d.counter.getLastSuccesses(),v=d.counter.getLastFailures();if(p+v<r)continue;let S=p/(p+v);if(Xe("Checking candidate "+h+" successRate="+S),S<u){let E=Math.random()*100;Xe("Candidate "+h+" randomNumber="+E+" enforcement_percentage="+t.enforcement_percentage),E<t.enforcement_percentage&&(Xe("Ejecting candidate "+h),this.eject(d,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Xe("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(Xe("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;Xe("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Xe("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Xe("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(Xe("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof Ma))return;let i=new Set;for(let o of e)i.add((0,dC.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(Xe("Adding map entry for "+o),this.addressMap.set(o,{counter:new Tm,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(Xe("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,gC.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Xe("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else Xe("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Xe("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return wm}};Mr.OutlierDetectionLoadBalancer=Gu;function vP(){gP&&(0,pC.registerLoadBalancerType)(wm,Gu,Ma)}Mr.setup=vP});var Cm=T(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.OutlierDetectionLoadBalancingConfig=H.BaseSubchannelWrapper=H.registerAdminService=H.FilterStackFactory=H.BaseFilter=H.PickResultType=H.QueuePicker=H.UnavailablePicker=H.ChildLoadBalancerHandler=H.subchannelAddressToString=H.validateLoadBalancingConfig=H.getFirstUsableConfig=H.registerLoadBalancerType=H.createChildChannelControlHelper=H.BackoffTimeout=H.durationToMs=H.uriToString=H.createResolver=H.registerResolver=H.log=H.trace=void 0;var mC=Ae();Object.defineProperty(H,"trace",{enumerable:!0,get:function(){return mC.trace}});Object.defineProperty(H,"log",{enumerable:!0,get:function(){return mC.log}});var yC=mn();Object.defineProperty(H,"registerResolver",{enumerable:!0,get:function(){return yC.registerResolver}});Object.defineProperty(H,"createResolver",{enumerable:!0,get:function(){return yC.createResolver}});var SP=Ot();Object.defineProperty(H,"uriToString",{enumerable:!0,get:function(){return SP.uriToString}});var TP=gm();Object.defineProperty(H,"durationToMs",{enumerable:!0,get:function(){return TP.durationToMs}});var EP=na();Object.defineProperty(H,"BackoffTimeout",{enumerable:!0,get:function(){return EP.BackoffTimeout}});var ju=ur();Object.defineProperty(H,"createChildChannelControlHelper",{enumerable:!0,get:function(){return ju.createChildChannelControlHelper}});Object.defineProperty(H,"registerLoadBalancerType",{enumerable:!0,get:function(){return ju.registerLoadBalancerType}});Object.defineProperty(H,"getFirstUsableConfig",{enumerable:!0,get:function(){return ju.getFirstUsableConfig}});Object.defineProperty(H,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return ju.validateLoadBalancingConfig}});var wP=vn();Object.defineProperty(H,"subchannelAddressToString",{enumerable:!0,get:function(){return wP.subchannelAddressToString}});var _P=Tc();Object.defineProperty(H,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return _P.ChildLoadBalancerHandler}});var bm=pr();Object.defineProperty(H,"UnavailablePicker",{enumerable:!0,get:function(){return bm.UnavailablePicker}});Object.defineProperty(H,"QueuePicker",{enumerable:!0,get:function(){return bm.QueuePicker}});Object.defineProperty(H,"PickResultType",{enumerable:!0,get:function(){return bm.PickResultType}});var CP=gu();Object.defineProperty(H,"BaseFilter",{enumerable:!0,get:function(){return CP.BaseFilter}});var bP=Fg();Object.defineProperty(H,"FilterStackFactory",{enumerable:!0,get:function(){return bP.FilterStackFactory}});var IP=wc();Object.defineProperty(H,"registerAdminService",{enumerable:!0,get:function(){return IP.registerAdminService}});var AP=Nu();Object.defineProperty(H,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return AP.BaseSubchannelWrapper}});var RP=_m();Object.defineProperty(H,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return RP.OutlierDetectionLoadBalancingConfig}})});var vC=T(Ku=>{"use strict";Object.defineProperty(Ku,"__esModule",{value:!0});Ku.setup=void 0;var DP=mn(),Im=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function NP(){(0,DP.registerResolver)("unix",Im)}Ku.setup=NP});var _C=T($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.setup=void 0;var SC=ae("net"),Wu=ie(),Am=Tt(),TC=mn(),EC=Ot(),OP=Ae(),kP="ip_resolver";function wC(n){OP.trace(Wu.LogVerbosity.DEBUG,kP,n)}var Rm="ipv4",Dm="ipv6",xP=443,Hu=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,wC("Resolver constructed for target "+(0,EC.uriToString)(e));let s=[];if(!(e.scheme===Rm||e.scheme===Dm)){this.error={code:Wu.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Am.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,EC.splitHostPort)(a);if(l===null){this.error={code:Wu.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Am.Metadata};return}if(e.scheme===Rm&&!(0,SC.isIPv4)(l.host)||e.scheme===Dm&&!(0,SC.isIPv6)(l.host)){this.error={code:Wu.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Am.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:xP})}this.addresses=s,wC("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function MP(){(0,TC.registerResolver)(Rm,Hu),(0,TC.registerResolver)(Dm,Hu)}$u.setup=MP});var IC=T(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.setup=On.PickFirstLoadBalancer=On.shuffled=On.PickFirstLoadBalancingConfig=void 0;var CC=ur(),ft=qt(),Qu=pr(),PP=Ae(),LP=ie(),FP="pick_first";function Nm(n){PP.trace(LP.LogVerbosity.DEBUG,FP,n)}var Pa="pick_first",BP=250,La=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Pa}toJsonObject(){return{[Pa]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};On.PickFirstLoadBalancingConfig=La;var Om=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Qu.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function bC(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}On.shuffled=bC;var Yu=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=ft.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(ft.ConnectivityState.READY,new Om(this.currentPick)):this.children.length===0?this.updateState(ft.ConnectivityState.IDLE,new Qu.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(ft.ConnectivityState.TRANSIENT_FAILURE,new Qu.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(ft.ConnectivityState.CONNECTING,new Qu.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==ft.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===ft.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===ft.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===ft.ConnectivityState.IDLE||i===ft.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===ft.ConnectivityState.IDLE&&(Nm("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},BP)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Nm("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Nm(ft.ConnectivityState[this.currentState]+" -> "+ft.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===ft.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===ft.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof La&&(t.getShuffleAddressList()&&(e=bC(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===ft.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Pa}};On.PickFirstLoadBalancer=Yu;function qP(){(0,CC.registerLoadBalancerType)(Pa,Yu,La),(0,CC.registerDefaultLoadBalancerType)(Pa)}On.setup=qP});var RC=T(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.setup=Us.RoundRobinLoadBalancer=void 0;var UP=ur(),pt=qt(),Xu=pr(),VP=vn(),zP=Ae(),GP=ie(),jP="round_robin";function AC(n){zP.trace(GP.LogVerbosity.DEBUG,jP,n)}var Ju="round_robin",km=class n{getLoadBalancerName(){return Ju}constructor(){}toJsonObject(){return{[Ju]:{}}}static createFromJson(e){return new n}},xm=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Xu.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Zu=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=pt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===pt.ConnectivityState.TRANSIENT_FAILURE||i===pt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(pt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===pt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(pt.ConnectivityState.READY,new xm(e,t))}else this.countSubchannelsWithState(pt.ConnectivityState.CONNECTING)>0?this.updateState(pt.ConnectivityState.CONNECTING,new Xu.QueuePicker(this)):this.countSubchannelsWithState(pt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(pt.ConnectivityState.TRANSIENT_FAILURE,new Xu.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(pt.ConnectivityState.IDLE,new Xu.QueuePicker(this))}updateState(e,t){AC(pt.ConnectivityState[this.currentState]+" -> "+pt.ConnectivityState[e]),e===pt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),AC("Connect to address list "+e.map(r=>(0,VP.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===pt.ConnectivityState.IDLE||i===pt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Ju}};Us.RoundRobinLoadBalancer=Zu;function KP(){(0,UP.registerLoadBalancerType)(Ju,Zu,km)}Us.setup=KP});var kC=T(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.experimental=F.addAdminServicesToServer=F.getChannelzHandlers=F.getChannelzServiceDefinition=F.InterceptorConfigurationError=F.InterceptingCall=F.RequesterBuilder=F.ListenerBuilder=F.StatusBuilder=F.getClientChannel=F.ServerCredentials=F.Server=F.setLogVerbosity=F.setLogger=F.load=F.loadObject=F.CallCredentials=F.ChannelCredentials=F.waitForClientReady=F.closeClient=F.Channel=F.makeGenericClientConstructor=F.makeClientConstructor=F.loadPackageDefinition=F.Client=F.compressionAlgorithms=F.propagate=F.connectivityState=F.status=F.logVerbosity=F.Metadata=F.credentials=void 0;var eh=Df();Object.defineProperty(F,"CallCredentials",{enumerable:!0,get:function(){return eh.CallCredentials}});var WP=ap();Object.defineProperty(F,"Channel",{enumerable:!0,get:function(){return WP.ChannelImplementation}});var HP=Bg();Object.defineProperty(F,"compressionAlgorithms",{enumerable:!0,get:function(){return HP.CompressionAlgorithms}});var $P=qt();Object.defineProperty(F,"connectivityState",{enumerable:!0,get:function(){return $P.ConnectivityState}});var th=fc();Object.defineProperty(F,"ChannelCredentials",{enumerable:!0,get:function(){return th.ChannelCredentials}});var DC=op();Object.defineProperty(F,"Client",{enumerable:!0,get:function(){return DC.Client}});var Mm=ie();Object.defineProperty(F,"logVerbosity",{enumerable:!0,get:function(){return Mm.LogVerbosity}});Object.defineProperty(F,"status",{enumerable:!0,get:function(){return Mm.Status}});Object.defineProperty(F,"propagate",{enumerable:!0,get:function(){return Mm.Propagate}});var NC=Ae(),Pm=cp();Object.defineProperty(F,"loadPackageDefinition",{enumerable:!0,get:function(){return Pm.loadPackageDefinition}});Object.defineProperty(F,"makeClientConstructor",{enumerable:!0,get:function(){return Pm.makeClientConstructor}});Object.defineProperty(F,"makeGenericClientConstructor",{enumerable:!0,get:function(){return Pm.makeClientConstructor}});var QP=Tt();Object.defineProperty(F,"Metadata",{enumerable:!0,get:function(){return QP.Metadata}});var YP=uC();Object.defineProperty(F,"Server",{enumerable:!0,get:function(){return YP.Server}});var XP=hm();Object.defineProperty(F,"ServerCredentials",{enumerable:!0,get:function(){return XP.ServerCredentials}});var JP=hC();Object.defineProperty(F,"StatusBuilder",{enumerable:!0,get:function(){return JP.StatusBuilder}});F.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:th.ChannelCredentials.createInsecure,createSsl:th.ChannelCredentials.createSsl,createFromSecureContext:th.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:eh.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:eh.CallCredentials.createFromGoogleCredential,createEmpty:eh.CallCredentials.createEmpty};var ZP=n=>n.close();F.closeClient=ZP;var eL=(n,e,t)=>n.waitForReady(e,t);F.waitForClientReady=eL;var tL=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};F.loadObject=tL;var nL=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};F.load=nL;var rL=n=>{NC.setLogger(n)};F.setLogger=rL;var iL=n=>{NC.setLoggerVerbosity(n)};F.setLogVerbosity=iL;var sL=n=>DC.Client.prototype.getChannel.call(n);F.getClientChannel=sL;var nh=rp();Object.defineProperty(F,"ListenerBuilder",{enumerable:!0,get:function(){return nh.ListenerBuilder}});Object.defineProperty(F,"RequesterBuilder",{enumerable:!0,get:function(){return nh.RequesterBuilder}});Object.defineProperty(F,"InterceptingCall",{enumerable:!0,get:function(){return nh.InterceptingCall}});Object.defineProperty(F,"InterceptorConfigurationError",{enumerable:!0,get:function(){return nh.InterceptorConfigurationError}});var OC=mi();Object.defineProperty(F,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return OC.getChannelzServiceDefinition}});Object.defineProperty(F,"getChannelzHandlers",{enumerable:!0,get:function(){return OC.getChannelzHandlers}});var oL=wc();Object.defineProperty(F,"addAdminServicesToServer",{enumerable:!0,get:function(){return oL.addAdminServicesToServer}});var aL=Cm();F.experimental=aL;var lL=bg(),cL=vC(),uL=_C(),hL=IC(),dL=RC(),fL=_m(),pL=mi();lL.setup(),cL.setup(),uL.setup(),hL.setup(),dL.setup(),fL.setup(),pL.setup()});import{inspect as gL,TextEncoder as mL,TextDecoder as yL}from"util";import{randomBytes as vL}from"crypto";var iR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Jt={},x,Qd=Qd||{},K=iR||self;function Wl(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Ho(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function sR(n){return Object.prototype.hasOwnProperty.call(n,Rd)&&n[Rd]||(n[Rd]=++oR)}var Rd="closure_uid_"+(1e9*Math.random()>>>0),oR=0;function aR(n,e,t){return n.call.apply(n.bind,arguments)}function lR(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ct(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ct=aR:ct=lR,ct.apply(null,arguments)}function xl(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function $e(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function or(){this.s=this.s,this.o=this.o}var cR=0;or.prototype.s=!1;or.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),cR!=0)&&sR(this)};or.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var eT=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Yd(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function zS(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Wl(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ut(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ut.prototype.h=function(){this.defaultPrevented=!0};var uR=function(){if(!K.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};K.addEventListener("test",t,e),K.removeEventListener("test",t,e)}catch{}return n}();function qo(n){return/^[\s\xa0]*$/.test(n)}function Hl(){var n=K.navigator;return n&&(n=n.userAgent)?n:""}function fn(n){return Hl().indexOf(n)!=-1}function Xd(n){return Xd[" "](n),n}Xd[" "]=function(){};function hR(n,e){var t=ZR;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var dR=fn("Opera"),Xi=fn("Trident")||fn("MSIE"),tT=fn("Edge"),xd=tT||Xi,nT=fn("Gecko")&&!(Hl().toLowerCase().indexOf("webkit")!=-1&&!fn("Edge"))&&!(fn("Trident")||fn("MSIE"))&&!fn("Edge"),fR=Hl().toLowerCase().indexOf("webkit")!=-1&&!fn("Edge");function rT(){var n=K.document;return n?n.documentMode:void 0}var Md;e:{if(Ml="",Pl=function(){var n=Hl();if(nT)return/rv:([^\);]+)(\)|;)/.exec(n);if(tT)return/Edge\/([\d\.]+)/.exec(n);if(Xi)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(fR)return/WebKit\/(\S+)/.exec(n);if(dR)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Pl&&(Ml=Pl?Pl[1]:""),Xi&&(Ll=rT(),Ll!=null&&Ll>parseFloat(Ml))){Md=String(Ll);break e}Md=Ml}var Ml,Pl,Ll,Pd;K.document&&Xi?(Dd=rT(),Pd=Dd||parseInt(Md,10)||void 0):Pd=void 0;var Dd,pR=Pd;function Uo(n,e){if(ut.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(nT){e:{try{Xd(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:gR[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Uo.$.h.call(this)}}$e(Uo,ut);var gR={2:"touch",3:"pen",4:"mouse"};Uo.prototype.h=function(){Uo.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var $o="closure_listenable_"+(1e6*Math.random()|0),mR=0;function yR(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++mR,this.fa=this.ia=!1}function $l(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Jd(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function vR(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function iT(n){let e={};for(let t in n)e[t]=n[t];return e}var GS="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function sT(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<GS.length;s++)t=GS[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ql(n){this.src=n,this.g={},this.h=0}Ql.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Fd(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new yR(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function Ld(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=eT(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&($l(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Fd(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Zd="closure_lm_"+(1e6*Math.random()|0),Nd={};function oT(n,e,t,r,i){if(r&&r.once)return lT(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)oT(n,e[s],t,r,i);return null}return t=nf(t),n&&n[$o]?n.O(e,t,Ho(r)?!!r.capture:!!r,i):aT(n,e,t,!1,r,i)}function aT(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Ho(i)?!!i.capture:!!i,a=tf(n);if(a||(n[Zd]=a=new Ql(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=SR(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)uR||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(uT(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function SR(){function n(t){return e.call(n.src,n.listener,t)}let e=TR;return n}function lT(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)lT(n,e[s],t,r,i);return null}return t=nf(t),n&&n[$o]?n.P(e,t,Ho(r)?!!r.capture:!!r,i):aT(n,e,t,!0,r,i)}function cT(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)cT(n,e[s],t,r,i);else r=Ho(r)?!!r.capture:!!r,t=nf(t),n&&n[$o]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Fd(s,t,r,i),-1<t&&($l(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=tf(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Fd(e,t,r,i)),(t=-1<n?e[n]:null)&&ef(t))}function ef(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[$o])Ld(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(uT(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=tf(e))?(Ld(t,n),t.h==0&&(t.src=null,e[Zd]=null)):$l(n)}}}function uT(n){return n in Nd?Nd[n]:Nd[n]="on"+n}function TR(n,e){if(n.fa)n=!0;else{e=new Uo(e,this);var t=n.listener,r=n.la||n.src;n.ia&&ef(n),n=t.call(r,e)}return n}function tf(n){return n=n[Zd],n instanceof Ql?n:null}var Od="__closure_events_fn_"+(1e9*Math.random()>>>0);function nf(n){return typeof n=="function"?n:(n[Od]||(n[Od]=function(e){return n.handleEvent(e)}),n[Od])}function He(){or.call(this),this.i=new Ql(this),this.S=this,this.J=null}$e(He,or);He.prototype[$o]=!0;He.prototype.removeEventListener=function(n,e,t,r){cT(this,n,e,t,r)};function rt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new ut(e,n);else if(e instanceof ut)e.target=e.target||n;else{var i=e;e=new ut(r,n),sT(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Fl(o,r,!0,e)&&i}if(o=e.g=n,i=Fl(o,r,!0,e)&&i,i=Fl(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=Fl(o,r,!1,e)&&i}He.prototype.N=function(){if(He.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)$l(t[r]);delete n.g[e],n.h--}}this.J=null};He.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};He.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Fl(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&Ld(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var rf=K.JSON.stringify,Bd=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function ER(){var n=sf;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var qd=class{constructor(){this.h=this.g=null}add(e,t){let r=hT.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},hT=new Bd(()=>new Ud,n=>n.reset()),Ud=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function wR(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function _R(n){K.setTimeout(()=>{throw n},0)}var Vo,zo=!1,sf=new qd,dT=()=>{let n=K.Promise.resolve(void 0);Vo=()=>{n.then(CR)}},CR=()=>{for(var n;n=ER();){try{n.h.call(n.g)}catch(t){_R(t)}var e=hT;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}zo=!1};function Yl(n,e){He.call(this),this.h=n||1,this.g=e||K,this.j=ct(this.qb,this),this.l=Date.now()}$e(Yl,He);x=Yl.prototype;x.ga=!1;x.T=null;x.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),rt(this,"tick"),this.ga&&(of(this),this.start()))}};x.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function of(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}x.N=function(){Yl.$.N.call(this),of(this),delete this.g};function af(n,e,t){if(typeof n=="function")t&&(n=ct(n,t));else if(n&&typeof n.handleEvent=="function")n=ct(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:K.setTimeout(n,e||0)}function fT(n){n.g=af(()=>{n.g=null,n.i&&(n.i=!1,fT(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Vd=class extends or{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:fT(this)}N(){super.N(),this.g&&(K.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Go(n){or.call(this),this.h=n,this.g={}}$e(Go,or);var jS=[];function pT(n,e,t,r){Array.isArray(t)||(t&&(jS[0]=t.toString()),t=jS);for(var i=0;i<t.length;i++){var s=oT(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function gT(n){Jd(n.g,function(e,t){this.g.hasOwnProperty(t)&&ef(e)},n),n.g={}}Go.prototype.N=function(){Go.$.N.call(this),gT(this)};Go.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Xl(){this.g=!0}Xl.prototype.Ea=function(){this.g=!1};function bR(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function IR(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Qi(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+RR(n,t)+(r?" "+r:"")})}function AR(n,e){n.info(function(){return"TIMEOUT: "+e})}Xl.prototype.info=function(){};function RR(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return rf(t)}catch{return e}}var li={},KS=null;function Jl(){return KS=KS||new He}li.Ta="serverreachability";function mT(n){ut.call(this,li.Ta,n)}$e(mT,ut);function jo(n){let e=Jl();rt(e,new mT(e))}li.STAT_EVENT="statevent";function yT(n,e){ut.call(this,li.STAT_EVENT,n),this.stat=e}$e(yT,ut);function vt(n){let e=Jl();rt(e,new yT(e,n))}li.Ua="timingevent";function vT(n,e){ut.call(this,li.Ua,n),this.size=e}$e(vT,ut);function Qo(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return K.setTimeout(function(){n()},e)}var Zl={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ST={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function lf(){}lf.prototype.h=null;function WS(n){return n.h||(n.h=n.i())}function TT(){}var Yo={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function cf(){ut.call(this,"d")}$e(cf,ut);function uf(){ut.call(this,"c")}$e(uf,ut);var zd;function ec(){}$e(ec,lf);ec.prototype.g=function(){return new XMLHttpRequest};ec.prototype.i=function(){return{}};zd=new ec;function Xo(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Go(this),this.P=DR,n=xd?125:void 0,this.V=new Yl(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ET}function ET(){this.i=null,this.g="",this.h=!1}var DR=45e3,wT={},Gd={};x=Xo.prototype;x.setTimeout=function(n){this.P=n};function jd(n,e,t){n.L=1,n.A=nc(Vn(e)),n.u=t,n.S=!0,_T(n,null)}function _T(n,e){n.G=Date.now(),Jo(n),n.B=Vn(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),OT(t.i,"t",r),n.o=0,t=n.l.J,n.h=new ET,n.g=JT(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Vd(ct(n.Pa,n,n.g),n.O)),pT(n.U,n.g,"readystatechange",n.nb),e=n.I?iT(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),jo(),bR(n.j,n.v,n.B,n.m,n.W,n.u)}x.nb=function(n){n=n.target;let e=this.M;e&&pn(n)==3?e.l():this.Pa(n)};x.Pa=function(n){try{if(n==this.g)e:{let u=pn(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>u)&&(u!=3||xd||this.g&&(this.h.h||this.g.ja()||YS(this.g)))){this.J||u!=4||e==7||(e==8||0>=h?jo(3):jo(2)),tc(this);var t=this.g.da();this.ca=t;t:if(CT(this)){var r=YS(this.g);n="";var i=r.length,s=pn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){si(this),Bo(this);var o="";break t}this.h.i=new K.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,IR(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!qo(a)){var c=a;break t}}c=null}if(t=c)Qi(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Kd(this,t);else{this.i=!1,this.s=3,vt(12),si(this),Bo(this);break e}}this.S?(bT(this,u,o),xd&&this.i&&u==3&&(pT(this.U,this.V,"tick",this.mb),this.V.start())):(Qi(this.j,this.m,o,null),Kd(this,o)),u==4&&si(this),this.i&&!this.J&&(u==4?$T(this.l,this):(this.i=!1,Jo(this)))}else YR(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,vt(12)):(this.s=0,vt(13)),si(this),Bo(this)}}}catch{}finally{}};function CT(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function bT(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=NR(n,t),i==Gd){e==4&&(n.s=4,vt(14),r=!1),Qi(n.j,n.m,null,"[Incomplete Response]");break}else if(i==wT){n.s=4,vt(15),Qi(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Qi(n.j,n.m,i,null),Kd(n,i);CT(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,vt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),mf(e),e.M=!0,vt(11))):(Qi(n.j,n.m,t,"[Invalid Chunked Response]"),si(n),Bo(n))}x.mb=function(){if(this.g){var n=pn(this.g),e=this.g.ja();this.o<e.length&&(tc(this),bT(this,n,e),this.i&&n!=4&&Jo(this))}};function NR(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Gd:(t=Number(e.substring(t,r)),isNaN(t)?wT:(r+=1,r+t>e.length?Gd:(e=e.slice(r,r+t),n.o=r+t,e)))}x.cancel=function(){this.J=!0,si(this)};function Jo(n){n.Y=Date.now()+n.P,IT(n,n.P)}function IT(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Qo(ct(n.lb,n),e)}function tc(n){n.C&&(K.clearTimeout(n.C),n.C=null)}x.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(AR(this.j,this.B),this.L!=2&&(jo(),vt(17)),si(this),this.s=2,Bo(this)):IT(this,this.Y-n)};function Bo(n){n.l.H==0||n.J||$T(n.l,n)}function si(n){tc(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,of(n.V),gT(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Kd(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Wd(t.i,n))){if(!n.K&&Wd(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)zl(t),sc(t);else break e;gf(t),vt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=Qo(ct(t.ib,t),6e3));if(1>=MT(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else oi(t,11)}else if((n.K||t.g==n)&&zl(t),!qo(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let p=n.g;if(p){let v=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(v){var s=r.i;s.g||v.indexOf("spdy")==-1&&v.indexOf("quic")==-1&&v.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(hf(s,s.h),s.h=null))}if(r.F){let S=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,ye(r.I,r.F,S))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=XT(r,r.J?r.pa:null,r.Y),o.K){PT(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(tc(a),Jo(a)),r.g=o}else WT(r);0<t.j.length&&oc(t)}else c[0]!="stop"&&c[0]!="close"||oi(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?oi(t,7):pf(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}jo(4)}catch{}}function OR(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Wl(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function kR(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Wl(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function AT(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Wl(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=kR(n),r=OR(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var RT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xR(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function ai(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof ai){this.h=n.h,Ul(this,n.j),this.s=n.s,this.g=n.g,Vl(this,n.m),this.l=n.l;var e=n.i,t=new Ko;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),HS(this,t),this.o=n.o}else n&&(e=String(n).match(RT))?(this.h=!1,Ul(this,e[1]||"",!0),this.s=Lo(e[2]||""),this.g=Lo(e[3]||"",!0),Vl(this,e[4]),this.l=Lo(e[5]||"",!0),HS(this,e[6]||"",!0),this.o=Lo(e[7]||"")):(this.h=!1,this.i=new Ko(null,this.h))}ai.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Fo(e,$S,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Fo(e,$S,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Fo(t,t.charAt(0)=="/"?LR:PR,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Fo(t,BR)),n.join("")};function Vn(n){return new ai(n)}function Ul(n,e,t){n.j=t?Lo(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Vl(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function HS(n,e,t){e instanceof Ko?(n.i=e,qR(n.i,n.h)):(t||(e=Fo(e,FR)),n.i=new Ko(e,n.h))}function ye(n,e,t){n.i.set(e,t)}function nc(n){return ye(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Lo(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Fo(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,MR),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function MR(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var $S=/[#\/\?@]/g,PR=/[#\?:]/g,LR=/[#\?]/g,FR=/[#\?@]/g,BR=/#/g;function Ko(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function ar(n){n.g||(n.g=new Map,n.h=0,n.i&&xR(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}x=Ko.prototype;x.add=function(n,e){ar(this),this.i=null,n=Ji(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function DT(n,e){ar(n),e=Ji(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function NT(n,e){return ar(n),e=Ji(n,e),n.g.has(e)}x.forEach=function(n,e){ar(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};x.ta=function(){ar(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};x.Z=function(n){ar(this);let e=[];if(typeof n=="string")NT(this,n)&&(e=e.concat(this.g.get(Ji(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};x.set=function(n,e){return ar(this),this.i=null,n=Ji(this,n),NT(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};x.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function OT(n,e,t){DT(n,e),0<t.length&&(n.i=null,n.g.set(Ji(n,e),Yd(t)),n.h+=t.length)}x.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Ji(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function qR(n,e){e&&!n.j&&(ar(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(DT(this,r),OT(this,i,t))},n)),n.j=e}var UR=class{constructor(n,e){this.g=n,this.map=e}};function kT(n){this.l=n||VR,K.PerformanceNavigationTiming?(n=K.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(K.g&&K.g.Ka&&K.g.Ka()&&K.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var VR=10;function xT(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function MT(n){return n.h?1:n.g?n.g.size:0}function Wd(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function hf(n,e){n.g?n.g.add(e):n.h=e}function PT(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}kT.prototype.cancel=function(){if(this.i=LT(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function LT(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Yd(n.i)}var zR=class{stringify(n){return K.JSON.stringify(n,void 0)}parse(n){return K.JSON.parse(n,void 0)}};function GR(){this.g=new zR}function jR(n,e,t){let r=t||"";try{AT(n,function(i,s){let o=i;Ho(i)&&(o=rf(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function KR(n,e){let t=new Xl;if(K.Image){let r=new Image;r.onload=xl(Bl,t,r,"TestLoadImage: loaded",!0,e),r.onerror=xl(Bl,t,r,"TestLoadImage: error",!1,e),r.onabort=xl(Bl,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=xl(Bl,t,r,"TestLoadImage: timeout",!1,e),K.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Bl(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Zo(n){this.l=n.ec||null,this.j=n.ob||!1}$e(Zo,lf);Zo.prototype.g=function(){return new rc(this.l,this.j)};Zo.prototype.i=function(n){return function(){return n}}({});function rc(n,e){He.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=df,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}$e(rc,He);var df=0;x=rc.prototype;x.open=function(n,e){if(this.readyState!=df)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Wo(this)};x.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||K).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};x.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ea(this)),this.readyState=df};x.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Wo(this)),this.g&&(this.readyState=3,Wo(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof K.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;FT(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function FT(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}x.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ea(this):Wo(this),this.readyState==3&&FT(this)}};x.Za=function(n){this.g&&(this.response=this.responseText=n,ea(this))};x.Ya=function(n){this.g&&(this.response=n,ea(this))};x.ka=function(){this.g&&ea(this)};function ea(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Wo(n)}x.setRequestHeader=function(n,e){this.v.append(n,e)};x.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};x.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Wo(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(rc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var WR=K.JSON.parse;function Ie(n){He.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=BT,this.L=this.M=!1}$e(Ie,He);var BT="",HR=/^https?$/i,$R=["POST","PUT"];x=Ie.prototype;x.Oa=function(n){this.M=n};x.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():zd.g(),this.C=this.u?WS(this.u):WS(zd),this.g.onreadystatechange=ct(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){QS(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=K.FormData&&n instanceof K.FormData,!(0<=eT($R,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{VT(this),0<this.B&&((this.L=QR(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ct(this.ua,this)):this.A=af(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){QS(this,s)}};function QR(n){return Xi&&typeof n.timeout=="number"&&n.ontimeout!==void 0}x.ua=function(){typeof Qd<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,rt(this,"timeout"),this.abort(8))};function QS(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,qT(n),ic(n)}function qT(n){n.F||(n.F=!0,rt(n,"complete"),rt(n,"error"))}x.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,rt(this,"complete"),rt(this,"abort"),ic(this))};x.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ic(this,!0)),Ie.$.N.call(this)};x.La=function(){this.s||(this.G||this.v||this.l?UT(this):this.kb())};x.kb=function(){UT(this)};function UT(n){if(n.h&&typeof Qd<"u"&&(!n.C[1]||pn(n)!=4||n.da()!=2)){if(n.v&&pn(n)==4)af(n.La,0,n);else if(rt(n,"readystatechange"),pn(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(RT)[1]||null;!i&&K.self&&K.self.location&&(i=K.self.location.protocol.slice(0,-1)),r=!HR.test(i?i.toLowerCase():"")}t=r}if(t)rt(n,"complete"),rt(n,"success");else{n.m=6;try{var s=2<pn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",qT(n)}}finally{ic(n)}}}}function ic(n,e){if(n.g){VT(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||rt(n,"ready");try{t.onreadystatechange=r}catch{}}}function VT(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(K.clearTimeout(n.A),n.A=null)}x.isActive=function(){return!!this.g};function pn(n){return n.g?n.g.readyState:0}x.da=function(){try{return 2<pn(this)?this.g.status:-1}catch{return-1}};x.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};x.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),WR(e)}};function YS(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case BT:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function YR(n){let e={};n=(n.g&&2<=pn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(qo(n[r]))continue;var t=wR(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}vR(e,function(r){return r.join(", ")})}x.Ia=function(){return this.m};x.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function zT(n){let e="";return Jd(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function ff(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=zT(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):ye(n,e,t))}function Mo(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function GT(n){this.Ga=0,this.j=[],this.l=new Xl,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Mo("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Mo("baseRetryDelayMs",5e3,n),this.hb=Mo("retryDelaySeedMs",1e4,n),this.eb=Mo("forwardChannelMaxRetries",2,n),this.xa=Mo("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new kT(n&&n.concurrentRequestLimit),this.Ja=new GR,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}x=GT.prototype;x.ra=8;x.H=1;function pf(n){if(jT(n),n.H==3){var e=n.W++,t=Vn(n.I);if(ye(t,"SID",n.K),ye(t,"RID",e),ye(t,"TYPE","terminate"),ta(n,t),e=new Xo(n,n.l,e),e.L=2,e.A=nc(Vn(t)),t=!1,K.navigator&&K.navigator.sendBeacon)try{t=K.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&K.Image&&(new Image().src=e.A,t=!0),t||(e.g=JT(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Jo(e)}YT(n)}function sc(n){n.g&&(mf(n),n.g.cancel(),n.g=null)}function jT(n){sc(n),n.u&&(K.clearTimeout(n.u),n.u=null),zl(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&K.clearTimeout(n.m),n.m=null)}function oc(n){if(!xT(n.i)&&!n.m){n.m=!0;var e=n.Na;Vo||dT(),zo||(Vo(),zo=!0),sf.add(e,n),n.C=0}}function XR(n,e){return MT(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Qo(ct(n.Na,n,e),QT(n,n.C)),n.C++,!0)}x.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Xo(this,this.l,n),s=this.s;if(this.U&&(s?(s=iT(s),sT(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=KT(this,i,e),t=Vn(this.I),ye(t,"RID",n),ye(t,"CVER",22),this.F&&ye(t,"X-HTTP-Session-Id",this.F),ta(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(zT(s)))+"&"+e:this.o&&ff(t,this.o,s)),hf(this.i,i),this.bb&&ye(t,"TYPE","init"),this.P?(ye(t,"$req",e),ye(t,"SID","null"),i.aa=!0,jd(i,t,null)):jd(i,t,e),this.H=2}}else this.H==3&&(n?XS(this,n):this.j.length==0||xT(this.i)||XS(this))};function XS(n,e){var t;e?t=e.m:t=n.W++;let r=Vn(n.I);ye(r,"SID",n.K),ye(r,"RID",t),ye(r,"AID",n.V),ta(n,r),n.o&&n.s&&ff(r,n.o,n.s),t=new Xo(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=KT(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),hf(n.i,t),jd(t,r,e)}function ta(n,e){n.na&&Jd(n.na,function(t,r){ye(e,r,t)}),n.h&&AT({},function(t,r){ye(e,r,t)})}function KT(n,e,t){t=Math.min(n.j.length,t);var r=n.h?ct(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{jR(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function WT(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Vo||dT(),zo||(Vo(),zo=!0),sf.add(e,n),n.A=0}}function gf(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Qo(ct(n.Ma,n),QT(n,n.A)),n.A++,!0)}x.Ma=function(){if(this.u=null,HT(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Qo(ct(this.jb,this),n)}};x.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,vt(10),sc(this),HT(this))};function mf(n){n.B!=null&&(K.clearTimeout(n.B),n.B=null)}function HT(n){n.g=new Xo(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=Vn(n.wa);ye(e,"RID","rpc"),ye(e,"SID",n.K),ye(e,"AID",n.V),ye(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ye(e,"TO",n.qa),ye(e,"TYPE","xmlhttp"),ta(n,e),n.o&&n.s&&ff(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=nc(Vn(e)),t.u=null,t.S=!0,_T(t,n)}x.ib=function(){this.v!=null&&(this.v=null,sc(this),gf(this),vt(19))};function zl(n){n.v!=null&&(K.clearTimeout(n.v),n.v=null)}function $T(n,e){var t=null;if(n.g==e){zl(n),mf(n),n.g=null;var r=2}else if(Wd(n.i,e))t=e.F,PT(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Jl(),rt(r,new vT(r,t)),oc(n)}else WT(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&XR(n,e)||r==2&&gf(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:oi(n,5);break;case 4:oi(n,10);break;case 3:oi(n,6);break;default:oi(n,2)}}}function QT(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function oi(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=ct(n.pb,n);t||(t=new ai("//www.google.com/images/cleardot.gif"),K.location&&K.location.protocol=="http"||Ul(t,"https"),nc(t)),KR(t.toString(),r)}else vt(2);n.H=0,n.h&&n.h.za(e),YT(n),jT(n)}x.pb=function(n){n?(this.l.info("Successfully pinged google.com"),vt(2)):(this.l.info("Failed to ping google.com"),vt(1))};function YT(n){if(n.H=0,n.ma=[],n.h){let e=LT(n.i);(e.length!=0||n.j.length!=0)&&(zS(n.ma,e),zS(n.ma,n.j),n.i.i.length=0,Yd(n.j),n.j.length=0),n.h.ya()}}function XT(n,e,t){var r=t instanceof ai?Vn(t):new ai(t);if(r.g!="")e&&(r.g=e+"."+r.g),Vl(r,r.m);else{var i=K.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new ai(null);r&&Ul(s,r),e&&(s.g=e),i&&Vl(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&ye(r,t,e),ye(r,"VER",n.ra),ta(n,r),r}function JT(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new Ie(new Zo({ob:t})):new Ie(n.va),e.Oa(n.J),e}x.isActive=function(){return!!this.h&&this.h.isActive(this)};function ZT(){}x=ZT.prototype;x.Ba=function(){};x.Aa=function(){};x.za=function(){};x.ya=function(){};x.isActive=function(){return!0};x.Va=function(){};function Gl(){if(Xi&&!(10<=Number(pR)))throw Error("Environmental error: no available transport.")}Gl.prototype.g=function(n,e){return new Nt(n,e)};function Nt(n,e){He.call(this),this.g=new GT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!qo(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!qo(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Zi(this)}$e(Nt,He);Nt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;vt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=XT(n,null,n.Y),oc(n)};Nt.prototype.close=function(){pf(this.g)};Nt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=rf(n),n=t);e.j.push(new UR(e.fb++,n)),e.H==3&&oc(e)};Nt.prototype.N=function(){this.g.h=null,delete this.j,pf(this.g),delete this.g,Nt.$.N.call(this)};function eE(n){cf.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}$e(eE,cf);function tE(){uf.call(this),this.status=1}$e(tE,uf);function Zi(n){this.g=n}$e(Zi,ZT);Zi.prototype.Ba=function(){rt(this.g,"a")};Zi.prototype.Aa=function(n){rt(this.g,new eE(n))};Zi.prototype.za=function(n){rt(this.g,new tE)};Zi.prototype.ya=function(){rt(this.g,"b")};function JR(){this.blockSize=-1}function Xt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}$e(Xt,JR);Xt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function kd(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Xt.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)kd(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){kd(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){kd(this,r),i=0;break}}this.h=i,this.i+=e};Xt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function le(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var ZR={};function yf(n){return-128<=n&&128>n?hR(n,function(e){return new le([e|0],0>e?-1:0)}):new le([n|0],0>n?-1:0)}function gn(n){if(isNaN(n)||!isFinite(n))return Yi;if(0>n)return nt(gn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Hd;return new le(e,0)}function nE(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return nt(nE(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=gn(Math.pow(e,8)),r=Yi,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=gn(Math.pow(e,s)),r=r.R(s).add(gn(o))):(r=r.R(t),r=r.add(gn(o)))}return r}var Hd=4294967296,Yi=yf(0),$d=yf(1),JS=yf(16777216);x=le.prototype;x.ea=function(){if(Ft(this))return-nt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Hd+r)*e,e*=Hd}return n};x.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Un(this))return"0";if(Ft(this))return"-"+nt(this).toString(n);for(var e=gn(Math.pow(n,6)),t=this,r="";;){var i=Kl(t,e).g;t=jl(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,Un(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};x.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Un(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function Ft(n){return n.h==-1}x.X=function(n){return n=jl(this,n),Ft(n)?-1:Un(n)?0:1};function nt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new le(t,~n.h).add($d)}x.abs=function(){return Ft(this)?nt(this):this};x.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new le(t,t[t.length-1]&-2147483648?-1:0)};function jl(n,e){return n.add(nt(e))}x.R=function(n){if(Un(this)||Un(n))return Yi;if(Ft(this))return Ft(n)?nt(this).R(nt(n)):nt(nt(this).R(n));if(Ft(n))return nt(this.R(nt(n)));if(0>this.X(JS)&&0>n.X(JS))return gn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,ql(t,2*r+2*i),t[2*r+2*i+1]+=s*l,ql(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,ql(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,ql(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new le(t,0)};function ql(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Po(n,e){this.g=n,this.h=e}function Kl(n,e){if(Un(e))throw Error("division by zero");if(Un(n))return new Po(Yi,Yi);if(Ft(n))return e=Kl(nt(n),e),new Po(nt(e.g),nt(e.h));if(Ft(e))return e=Kl(n,nt(e)),new Po(nt(e.g),e.h);if(30<n.g.length){if(Ft(n)||Ft(e))throw Error("slowDivide_ only works with positive integers.");for(var t=$d,r=e;0>=r.X(n);)t=ZS(t),r=ZS(r);var i=$i(t,1),s=$i(r,1);for(r=$i(r,2),t=$i(t,2);!Un(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=$i(r,1),t=$i(t,1)}return e=jl(n,i.R(e)),new Po(i,e)}for(i=Yi;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=gn(t),o=s.R(e);Ft(o)||0<o.X(n);)t-=r,s=gn(t),o=s.R(e);Un(s)&&(s=$d),i=i.add(s),n=jl(n,o)}return new Po(i,n)}x.gb=function(n){return Kl(this,n).h};x.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new le(t,this.h&n.h)};x.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new le(t,this.h|n.h)};x.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new le(t,this.h^n.h)};function ZS(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new le(t,n.h)}function $i(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new le(i,n.h)}Gl.prototype.createWebChannel=Gl.prototype.g;Nt.prototype.send=Nt.prototype.u;Nt.prototype.open=Nt.prototype.m;Nt.prototype.close=Nt.prototype.close;Zl.NO_ERROR=0;Zl.TIMEOUT=8;Zl.HTTP_ERROR=6;ST.COMPLETE="complete";TT.EventType=Yo;Yo.OPEN="a";Yo.CLOSE="b";Yo.ERROR="c";Yo.MESSAGE="d";He.prototype.listen=He.prototype.O;Ie.prototype.listenOnce=Ie.prototype.P;Ie.prototype.getLastError=Ie.prototype.Sa;Ie.prototype.getLastErrorCode=Ie.prototype.Ia;Ie.prototype.getStatus=Ie.prototype.da;Ie.prototype.getResponseJson=Ie.prototype.Wa;Ie.prototype.getResponseText=Ie.prototype.ja;Ie.prototype.send=Ie.prototype.ha;Ie.prototype.setWithCredentials=Ie.prototype.Oa;Xt.prototype.digest=Xt.prototype.l;Xt.prototype.reset=Xt.prototype.reset;Xt.prototype.update=Xt.prototype.j;le.prototype.add=le.prototype.add;le.prototype.multiply=le.prototype.R;le.prototype.modulo=le.prototype.gb;le.prototype.compare=le.prototype.X;le.prototype.toNumber=le.prototype.ea;le.prototype.toString=le.prototype.toString;le.prototype.getBits=le.prototype.D;le.fromNumber=gn;le.fromString=nE;var eV=Jt.createWebChannelTransport=function(){return new Gl},tV=Jt.getStatEventTarget=function(){return Jl()},nV=Jt.ErrorCode=Zl,rV=Jt.EventType=ST,iV=Jt.Event=li,sV=Jt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},oV=Jt.FetchXmlHttpFactory=Zo,aV=Jt.WebChannel=TT,lV=Jt.XhrIo=Ie,rE=Jt.Md5=Xt,ci=Jt.Integer=le;var Di=OS(kC(),1),jb=OS(dg(),1);var xC="@firebase/firestore",MC="4.6.1";var ze=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ze.UNAUTHENTICATED=new ze(null);ze.GOOGLE_CREDENTIALS=new ze("google-credentials-uid");ze.FIRST_PARTY=new ze("first-party-uid");ze.MOCK_USER=new ze("mock-user");var SL="10.11.1";var _o=SL;function TL(n){_o=n}function EL(n){return gL(n,{depth:100})}var zr=new FS("@firebase/firestore");function $s(){return zr.logLevel}function D6(n){zr.setLogLevel(n)}function R(n,...e){if(zr.logLevel<=dn.DEBUG){let t=e.map(Kv);zr.debug(`Firestore (${_o}): ${n}`,...t)}}function _e(n,...e){if(zr.logLevel<=dn.ERROR){let t=e.map(Kv);zr.error(`Firestore (${_o}): ${n}`,...t)}}function Pn(n,...e){if(zr.logLevel<=dn.WARN){let t=e.map(Kv);zr.warn(`Firestore (${_o}): ${n}`,...t)}}function Kv(n){if(typeof n=="string")return n;try{return EL(n)}catch{return n}}function L(n="Unexpected state"){let e=`FIRESTORE (${_o}) INTERNAL ASSERTION FAILED: `+n;throw _e(e),new Error(e)}function q(n,e){n||L()}function N6(n,e){n||L()}function O(n,e){return n}var y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},b=class extends PS{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var xe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var fh=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Km=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ze.UNAUTHENTICATED))}shutdown(){}},Wm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Hm=class{constructor(e){this.authProvider=e,this.currentUser=ze.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new xe;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new xe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>g(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new xe)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string"),new fh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new ze(e)}},$m=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=ze.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Qm=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new $m(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(ze.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ym=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Xm=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,R("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Ym(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function wL(n){if(!n)return new Km;switch(n.type){case"firstParty":return new Qm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new b(y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function _L(n){return vL(n)}var ph=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=_L(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function $(n,e){return n<e?-1:n>e?1:0}function Ni(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function Kb(n){return n+"\0"}var PC=-62135596800,LC=1e6,Me=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new b(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new b(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<PC)throw new b(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new b(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*LC);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/LC}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-PC,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var z=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Me(0,0))}static max(){return new n(new Me(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var FC="__name__",gh=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(),r===void 0?r=e.length-t:r>e.length-t&&L(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},te=class n extends gh{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new b(y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},CL=/^[_a-zA-Z][_a-zA-Z0-9]*$/,We=class n extends gh{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return CL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===FC}static keyField(){return new n([FC])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new b(y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new b(y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new b(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new b(y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(te.fromString(e))}static fromName(e){return new n(te.fromString(e).popFirst(5))}static empty(){return new n(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new te(e.slice()))}};var ro=-1,bL=0,Jm=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function Wv(n){return n.fields.find(e=>e.kind===2)}function Oi(n){return n.fields.filter(e=>e.kind!==2)}function IL(n){let e=Oi(n);return e.length===0?0:e[e.length-1].kind}function AL(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var eo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Qa=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(bL,Yt.min())}};function Wb(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new Me(t+1,0):new Me(t,r));return new Yt(i,M.empty(),e)}function Hb(n){return new Yt(n.readTime,n.key,ro)}var Yt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),M.empty(),ro)}static max(){return new n(z.max(),M.empty(),ro)}};function Hv(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=M.comparator(n.documentKey,e.documentKey),t!==0)?t:$(n.largestBatchId,e.largestBatchId)}var $b="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",mh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ei(n){return g(this,null,function*(){if(n.code===y.FAILED_PRECONDITION&&n.message===$b)R("LocalStore","Unexpectedly lost primary lease");else throw n})}var m=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Mt="SimpleDb",RL=3,yh=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new xe,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Ri(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=$v(r.target.error);this.completionDeferred.reject(new Ri(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Ri(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(R(Mt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new ey(t)}},Gr=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(xo())===12.2&&_e("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R(Mt,"Removing database:",e),Ei(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!MS())return!1;if(n.isMockPersistence())return!0;let e=xo(),t=n.getIOSVersion(e),r=0<t&&t<10,i=Qb(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return g(this,null,function*(){return this.db||(R(Mt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Ri(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new b(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new b(y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ri(e,o))},i.onupgradeneeded=s=>{R(Mt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{R(Mt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=yh.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<RL;if(R(Mt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Qb(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Zm=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Ei(this.dbCursor.delete())}},Ri=class extends b{constructor(e,t){super(y.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ti(n){return n.name==="IndexedDbTransactionError"}var ey=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(R(Mt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(R(Mt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ei(r)}add(e){R(Mt,"ADD",this.store.name,e,e);let t=this.store.add(e);return Ei(t)}get(e){let t=this.store.get(e);return Ei(t).next(r=>(r===void 0&&(r=null),R(Mt,"GET",this.store.name,e,r),r))}delete(e){R(Mt,"DELETE",this.store.name,e);let t=this.store.delete(e);return Ei(t)}count(){R(Mt,"COUNT",this.store.name);let e=this.store.count();return Ei(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new m((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){R(Mt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{let o=$v(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Zm(a),c=t(a.primaryKey,a.value,l);if(c instanceof m){let u=c.catch(h=>(l.done(),m.reject(h)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>m.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Ei(n){return new m((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=$v(r.target.error);t(i)}})}var BC=!1;function $v(n){let e=Gr.getIOSVersion(xo());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new b("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return BC||(BC=!0,setTimeout(()=>{throw r},0)),r}}return n}var Ga="IndexBackfiller",DL=15*1e3,NL=60*1e3,OL=50,ty=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(DL)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){R(Ga,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();R(Ga,`Documents written: ${t}`)}catch(t){ti(t)?R(Ga,"Ignoring IndexedDB error during index backfill: ",t):yield ei(t)}yield this.schedule(NL)}))}},ny=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return g(this,arguments,function*(e=OL){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return R(Ga,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(R(Ga,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=Hb(s);Hv(o,r)>0&&(r=o)}),new Yt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Pt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),to="",ry="",Yb="",Xb="";function _t(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=qC(e)),e=kL(n.get(t),e);return qC(e)}function kL(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=to+Yb;break;case to:t+=to+Xb;break;default:t+=s}}return t}function qC(n){return n+to+ry}function xn(n){let e=n.length;if(q(e>=2),e===2)return q(n.charAt(0)===to&&n.charAt(1)===ry),te.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(to,s);switch((o<0||o>t)&&L(),n.charAt(o+1)){case ry:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case Yb:i+=n.substring(s,o),i+="\0";break;case Xb:i+=n.substring(s,o+1);break;default:L()}s=o+2}return new te(r)}var wi="remoteDocuments";var El="owner",Vs="owner",wl="mutationQueues",xL="userId",ln="mutations",Jb="batchId",Ii="userMutationsIndex",Zb=["userId","batchId"];function ML(n){return[n]}function ah(n,e){return[n,_t(e)]}function eI(n,e,t){return[n,_t(e),t]}var PL={},Co="documentMutations",sd="remoteDocumentsV14",LL=["prefixPath","collectionGroup","readTime","documentId"],lh="documentKeyIndex",FL=["prefixPath","collectionGroup","documentId"],tI="collectionGroupIndex",BL=["collectionGroup","readTime","prefixPath","documentId"],_l="remoteDocumentGlobal",iy="remoteDocumentGlobalKey",bo="targets",qL="targetId",nI="queryTargetsIndex",UL=["canonicalId","targetId"],Io="targetDocuments",VL=["targetId","path"],Qv="documentTargetsIndex",zL=["path","targetId"],vh="targetGlobalKey",Gi="targetGlobal",Ya="collectionParents",GL=["collectionId","parent"],io="clientMetadata",jL="clientId",od="bundles",KL="bundleId",ad="namedQueries",WL="name",Yv="indexConfiguration",HL="indexId",sy="collectionGroupIndex",$L="collectionGroup",ld="indexState",QL=["indexId","uid"],rI="sequenceNumberIndex",YL=["uid","sequenceNumber"],cd="indexEntries",XL=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iI="documentKeyIndex",JL=["indexId","uid","orderedDocumentKey"],ud="documentOverlays",ZL=["userId","collectionPath","documentId"],oy="collectionPathOverlayIndex",eF=["userId","collectionPath","largestBatchId"],sI="collectionGroupOverlayIndex",tF=["userId","collectionGroup","largestBatchId"],nF=[wl,ln,Co,wi,bo,El,Gi,Io],rF=nF,iF=[...rF,io],sF=[...iF,_l],oF=[...sF,Ya],oI=[...oF,od,ad],aF=[...oI,ud],aI=[wl,ln,Co,sd,bo,El,Gi,Io,io,_l,Ya,od,ad,ud],lI=aI,cI=[...lI,Yv,ld,cd],lF=cI;function cF(n){if(n===16)return lF;if(n===15)return cI;if(n===14)return lI;if(n===13)return aI;if(n===12)return aF;if(n===11)return oI;L()}var Xa=class extends mh{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function et(n,e){let t=O(n);return Gr.getStore(t.simpleDbTransaction,e)}function UC(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ji(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function uI(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ve=class n{constructor(e,t){this.comparator=e,this.root=t||ja.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ja.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ja.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Js(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Js(this.root,e,this.comparator,!1)}getReverseIterator(){return new Js(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Js(this.root,e,this.comparator,!0)}},Js=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ja=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),ay=class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,r,i,s){return this}insert(e,t,r){return new ja(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};ja.EMPTY=new ay;var de=class n{constructor(e){this.comparator=e,this.data=new ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Sh(this.data.getIterator())}getIteratorFrom(e){return new Sh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Sh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function uF(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=zs(s),l=zs(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let h=t(a,l);h<0?u=!0:h>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=zs(o)):u?(i(a),a=zs(s)):(a=zs(s),l=zs(o))}}function zs(n){return n.hasNext()?n.getNext():void 0}var Lt=class n{constructor(e){this.fields=e,e.sort(We.comparator)}static empty(){return new n([])}unionWith(e){let t=new de(We.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ni(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function hF(n){return Buffer.from(n,"base64").toString("binary")}function dF(n){return Buffer.from(n,"binary").toString("base64")}function O6(){return!0}var Ze=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=hF(e);return new n(t)}static fromUint8Array(e){let t=fF(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return dF(this.binaryString)}toUint8Array(){return pF(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ze.EMPTY_BYTE_STRING=new Ze("");function fF(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function pF(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var gF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Jn(n){if(q(!!n),typeof n=="string"){let e=0,t=gF.exec(n);if(q(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=De(n.seconds),t=De(n.nanos);return{seconds:e,nanos:t}}}function De(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function jr(n){return typeof n=="string"?Ze.fromBase64String(n):Ze.fromUint8Array(n)}var hI="server_timestamp",dI="__type__",fI="__previous_value__",pI="__local_write_time__";function hd(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[dI])===null||t===void 0?void 0:t.stringValue)===hI}function mF(n,e){let t={fields:{[dI]:{stringValue:hI},[pI]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&hd(e)&&(e=Xv(e)),e&&(t.fields[fI]=e),{mapValue:t}}function Xv(n){let e=n.mapValue.fields[fI];return hd(e)?Xv(e):e}function Ja(n){let e=Jn(n.mapValue.fields[pI].timestampValue);return new Me(e.seconds,e.nanos)}var ly=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},cy="(default)",so=class n{constructor(e,t){this.projectId=e,this.database=t||cy}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===cy}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function yF(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new b(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new so(n.options.projectId,e)}var Vr=-1;function Cl(n){return n==null}function Za(n){return n===0&&1/n===-1/0}function gI(n){return typeof n=="number"&&Number.isInteger(n)&&!Za(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var mI="__max__",qr={mapValue:{fields:{__type__:{stringValue:mI}}}},ch={nullValue:"NULL_VALUE"};function ki(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?hd(n)?4:yI(n)?9007199254740991:10:L()}function cn(n,e){if(n===e)return!0;let t=ki(n),r=ki(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ja(n).isEqual(Ja(e));case 3:return vF(n,e);case 5:return n.stringValue===e.stringValue;case 6:return TF(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return SF(n,e);case 2:return EF(n,e);case 9:return Ni(n.arrayValue.values||[],e.arrayValue.values||[],cn);case 10:return wF(n,e);case 9007199254740991:return!0;default:return L()}}function vF(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Jn(n.timestampValue),r=Jn(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function SF(n,e){return De(n.geoPointValue.latitude)===De(e.geoPointValue.latitude)&&De(n.geoPointValue.longitude)===De(e.geoPointValue.longitude)}function TF(n,e){return jr(n.bytesValue).isEqual(jr(e.bytesValue))}function EF(n,e){if("integerValue"in n&&"integerValue"in e)return De(n.integerValue)===De(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=De(n.doubleValue),r=De(e.doubleValue);return t===r?Za(t)===Za(r):isNaN(t)&&isNaN(r)}return!1}function wF(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(UC(t)!==UC(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!cn(t[i],r[i])))return!1;return!0}function el(n,e){return(n.values||[]).find(t=>cn(t,e))!==void 0}function Kr(n,e){if(n===e)return 0;let t=ki(n),r=ki(e);if(t!==r)return $(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,e.booleanValue);case 2:return _F(n,e);case 3:return VC(n.timestampValue,e.timestampValue);case 4:return VC(Ja(n),Ja(e));case 5:return $(n.stringValue,e.stringValue);case 6:return IF(n.bytesValue,e.bytesValue);case 7:return CF(n.referenceValue,e.referenceValue);case 8:return bF(n.geoPointValue,e.geoPointValue);case 9:return AF(n.arrayValue,e.arrayValue);case 10:return RF(n.mapValue,e.mapValue);default:throw L()}}function _F(n,e){let t=De(n.integerValue||n.doubleValue),r=De(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function VC(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $(n,e);let t=Jn(n),r=Jn(e),i=$(t.seconds,r.seconds);return i!==0?i:$(t.nanos,r.nanos)}function CF(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=$(t[i],r[i]);if(s!==0)return s}return $(t.length,r.length)}function bF(n,e){let t=$(De(n.latitude),De(e.latitude));return t!==0?t:$(De(n.longitude),De(e.longitude))}function IF(n,e){let t=jr(n),r=jr(e);return t.compareTo(r)}function AF(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Kr(t[i],r[i]);if(s)return s}return $(t.length,r.length)}function RF(n,e){if(n===qr.mapValue&&e===qr.mapValue)return 0;if(n===qr.mapValue)return 1;if(e===qr.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=$(r[o],s[o]);if(a!==0)return a;let l=Kr(t[r[o]],i[s[o]]);if(l!==0)return l}return $(r.length,s.length)}function oo(n){return Jv(n)}function Jv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?NF(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?DF(n.bytesValue):"referenceValue"in n?kF(n.referenceValue):"geoPointValue"in n?OF(n.geoPointValue):"arrayValue"in n?MF(n.arrayValue):"mapValue"in n?xF(n.mapValue):L()}function DF(n){return jr(n).toBase64()}function NF(n){let e=Jn(n);return`time(${e.seconds},${e.nanos})`}function OF(n){return`geo(${n.latitude},${n.longitude})`}function kF(n){return M.fromName(n).toString()}function xF(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Jv(n.fields[i])}`;return t+"}"}function MF(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Jv(r);return e+"]"}function xi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function uy(n){return!!n&&"integerValue"in n}function PF(n){return!!n&&"doubleValue"in n}function LF(n){return uy(n)||PF(n)}function tl(n){return!!n&&"arrayValue"in n}function zC(n){return!!n&&"nullValue"in n}function GC(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function uh(n){return!!n&&"mapValue"in n}function Ka(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return ji(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ka(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ka(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function yI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===mI}function FF(n){return"nullValue"in n?ch:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?xi(so.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:L()}function BF(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?xi(so.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?qr:L()}function jC(n,e){let t=Kr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function KC(n,e){let t=Kr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var gt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!uh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Ka(t)}setAll(e){let t=We.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Ka(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());uh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return cn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!uh(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ji(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ka(this.value))}};function vI(n){let e=[];return ji(n.fields,(t,r)=>{let i=new We([t]);if(uh(r)){let o=vI(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Lt(e)}var Ve=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),gt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),gt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),gt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(z.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function qF(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Kr(r,i):L()}var Bn=class{constructor(e,t){this.position=e,this.inclusive=t}};function SI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=M.comparator(M.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Kr(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function UF(n,e,t){let r=SI(n,e,t);return n.inclusive?r>=0:r>0}function VF(n,e,t){let r=SI(n,e,t);return n.inclusive?r<=0:r<0}function WC(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!cn(r,i))return!1}return!0}var Mi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function zF(n){return n.field.canonicalString()+n.dir}function GF(n){return`${n.field.canonicalString()} (${n.dir})`}function jF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Th=class{},J=class n extends Th{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new fy(e,t,r):t==="array-contains"?new my(e,r):t==="in"?new Eh(e,r):t==="not-in"?new yy(e,r):t==="array-contains-any"?new vy(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new py(e,r):new gy(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Kr(t,this.value)):t!==null&&ki(this.value)===ki(t)&&this.matchesComparison(Kr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ce=class n extends Th{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return ao(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function ao(n){return n.op==="and"}function hy(n){return n.op==="or"}function Zv(n){return TI(n)&&ao(n)}function TI(n){for(let e of n.filters)if(e instanceof ce)return!1;return!0}function dy(n){if(n instanceof J)return n.field.canonicalString()+n.op.toString()+oo(n.value);if(Zv(n))return n.filters.map(e=>dy(e)).join(",");{let e=n.filters.map(t=>dy(t)).join(",");return`${n.op}(${e})`}}function EI(n,e){if(n instanceof J)return KF(n,e);if(n instanceof ce)return WF(n,e);L()}function KF(n,e){return e instanceof J&&n.op===e.op&&n.field.isEqual(e.field)&&cn(n.value,e.value)}function WF(n,e){return e instanceof ce&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&EI(i,e.filters[s]),!0):!1}function wI(n,e){let t=n.filters.concat(e);return ce.create(t,n.op)}function _I(n){return n instanceof J?$F(n):n instanceof ce?HF(n):"Filter"}function HF(n){return n.op.toString()+" {"+n.getFilters().map(_I).join(" ,")+"}"}function $F(n){return`${n.field.canonicalString()} ${n.op} ${oo(n.value)}`}var fy=class extends J{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},py=class extends J{constructor(e,t){super(e,"in",t),this.keys=CI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},gy=class extends J{constructor(e,t){super(e,"not-in",t),this.keys=CI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function CI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var my=class extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return tl(t)&&el(t.arrayValue,this.value)}},Eh=class extends J{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&el(this.value.arrayValue,t)}},yy=class extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(el(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!el(this.value.arrayValue,t)}},vy=class extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!tl(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>el(this.value.arrayValue,r))}};var Sy=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function Ty(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Sy(n,e,t,r,i,s,o)}function Pi(n){let e=O(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>dy(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>zF(r)).join(","),Cl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>oo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>oo(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function QF(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>_I(t)).join(", ")}]`),Cl(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>GF(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>oo(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>oo(t)).join(",")),`Target(${e})`}function bl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!jF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!EI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!WC(n.startAt,e.startAt)?!1:WC(n.endAt,e.endAt)}function wh(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function dd(n,e){return n.filters.filter(t=>t instanceof J&&t.field.isEqual(e))}function YF(n,e){let t=Wv(e);if(t===void 0)return null;for(let r of dd(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function XF(n,e){let t=new Map;for(let r of Oi(e))for(let i of dd(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function JF(n,e){let t=[],r=!0;for(let i of Oi(e)){let s=i.kind===0?bI(n,i.fieldPath,n.startAt):II(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new Bn(t,r)}function ZF(n,e){let t=[],r=!0;for(let i of Oi(e)){let s=i.kind===0?II(n,i.fieldPath,n.endAt):bI(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new Bn(t,r)}function bI(n,e,t){let r=ch,i=!0;for(let s of dd(n,e)){let o=ch,a=!0;switch(s.op){case"<":case"<=":o=FF(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=ch;break}jC({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];jC({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function II(n,e,t){let r=qr,i=!0;for(let s of dd(n,e)){let o=qr,a=!0;switch(s.op){case">=":case">":o=BF(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=qr;break}KC({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];KC({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function e2(n){let e=new de(We.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function t2(n){return n.limit!==null}var un=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function AI(n,e,t,r,i,s,o,a){return new un(n,e,t,r,i,s,o,a)}function Ao(n){return new un(n)}function n2(n,e){return new un(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function HC(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function r2(n){let e=new de(We.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function i2(n){return new un(te.emptyPath(),n)}function s2(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function eS(n){return n.collectionGroup!==null}function lo(n){let e=O(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";r2(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Mi(s,r))}),t.has(We.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Mi(We.keyField(),r))}return e.memoizedNormalizedOrderBy}function Ct(n){let e=O(n);return e.memoizedTarget||(e.memoizedTarget=o2(e,lo(n))),e.memoizedTarget}function o2(n,e){if(n.limitType==="F")return Ty(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Mi(i.field,s)});let t=n.endAt?new Bn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Bn(n.startAt.position,n.startAt.inclusive):null;return Ty(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function tS(n,e){let t=n.filters.concat([e]);return new un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function a2(n,e){let t=n.explicitOrderBy.concat([e]);return new un(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function _h(n,e,t){return new un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function l2(n,e){return new un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function c2(n,e){return new un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Il(n,e){return bl(Ct(n),Ct(e))&&n.limitType===e.limitType}function RI(n){return`${Pi(Ct(n))}|lt:${n.limitType}`}function Qs(n){return`Query(target=${QF(Ct(n))}; limitType=${n.limitType})`}function Al(n,e){return e.isFoundDocument()&&u2(n,e)&&h2(n,e)&&d2(n,e)&&f2(n,e)}function u2(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):M.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function h2(n,e){for(let t of lo(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function d2(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function f2(n,e){return!(n.startAt&&!VF(n.startAt,lo(n),e)||n.endAt&&!UF(n.endAt,lo(n),e))}function DI(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function NI(n){return(e,t)=>{let r=!1;for(let i of lo(n)){let s=p2(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function p2(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):qF(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L()}}var qn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ji(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return uI(this.inner)}size(){return this.innerSize}};var g2=new ve(M.comparator);function Rt(){return g2}var OI=new ve(M.comparator);function Va(...n){let e=OI;for(let t of n)e=e.insert(t.key,t);return e}function m2(){return nl()}function kI(n){let e=OI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Mn(){return nl()}function xI(){return nl()}function nl(){return new qn(n=>n.toString(),(n,e)=>n.isEqual(e))}var y2=new ve(M.comparator);function v2(){return y2}var S2=new de(M.comparator);function Q(...n){let e=S2;for(let t of n)e=e.add(t);return e}var T2=new de($);function nS(){return T2}function MI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Za(e)?"-0":e}}function PI(n){return{integerValue:""+n}}function LI(n,e){return gI(e)?PI(e):MI(n,e)}var co=class{constructor(){this._=void 0}};function E2(n,e,t){return n instanceof Wr?mF(t,e):n instanceof Zn?BI(n,e):n instanceof er?qI(n,e):C2(n,e)}function w2(n,e,t){return n instanceof Zn?BI(n,e):n instanceof er?qI(n,e):t}function FI(n,e){return n instanceof Hr?LF(e)?e:{integerValue:0}:null}function _2(n,e){return n instanceof Zn&&e instanceof Zn||n instanceof er&&e instanceof er?Ni(n.elements,e.elements,cn):n instanceof Hr&&e instanceof Hr?cn(n.operand,e.operand):n instanceof Wr&&e instanceof Wr}var Wr=class extends co{},Zn=class extends co{constructor(e){super(),this.elements=e}};function BI(n,e){let t=UI(e);for(let r of n.elements)t.some(i=>cn(i,r))||t.push(r);return{arrayValue:{values:t}}}var er=class extends co{constructor(e){super(),this.elements=e}};function qI(n,e){let t=UI(e);for(let r of n.elements)t=t.filter(i=>!cn(i,r));return{arrayValue:{values:t}}}var Hr=class extends co{constructor(e,t){super(),this.serializer=e,this.operand=t}};function C2(n,e){let t=FI(n,e),r=$C(t)+$C(n.operand);return uy(t)&&uy(n.operand)?PI(r):MI(n.serializer,r)}function $C(n){return De(n.integerValue||n.doubleValue)}function UI(n){return tl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Li=class{constructor(e,t){this.field=e,this.transform=t}};function b2(n,e){return n.field.isEqual(e.field)&&_2(n.transform,e.transform)}function I2(n,e){return n===void 0&&e===void 0?!0:n&&e?Ni(n,e,(t,r)=>b2(t,r)):!1}var Ey=class{constructor(e,t){this.version=e,this.transformResults=t}},Re=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function fd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var uo=class{};function VI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Qr(n.key,Re.none()):new $r(n.key,n.data,Re.none());{let t=n.data,r=gt.empty(),i=new de(We.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new hn(n.key,r,new Lt(i.toArray()),Re.none())}}function A2(n,e,t){n instanceof $r?D2(n,e,t):n instanceof hn?O2(n,e,t):x2(n,e,t)}function Wa(n,e,t,r){return n instanceof $r?N2(n,e,t,r):n instanceof hn?k2(n,e,t,r):M2(n,e,t)}function R2(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=FI(r.transform,i||null);s!=null&&(t===null&&(t=gt.empty()),t.set(r.field,s))}return t||null}function QC(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!I2(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var $r=class extends uo{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function D2(n,e,t){let r=n.value.clone(),i=GI(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function N2(n,e,t,r){if(!fd(n.precondition,e))return t;let i=n.value.clone(),s=jI(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var hn=class extends uo{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function O2(n,e,t){if(!fd(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=GI(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(zI(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function k2(n,e,t,r){if(!fd(n.precondition,e))return t;let i=jI(n.fieldTransforms,r,e),s=e.data;return s.setAll(zI(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function zI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function GI(n,e,t){let r=new Map;q(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,w2(o,a,t[i]))}return r}function jI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,E2(s,o,e))}return r}var Qr=class extends uo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function x2(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function M2(n,e,t){return fd(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var rl=class extends uo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var il=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];A2(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Wa(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Wa(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=xI();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=VI(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&Ni(this.mutations,e.mutations,(t,r)=>QC(t,r))&&Ni(this.baseMutations,e.baseMutations,(t,r)=>QC(t,r))}},wy=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){q(e.mutations.length===r.length);let i=v2(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var sl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var _y=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Je=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Je||{});function KI(n){switch(n){case y.OK:return L();case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return!1;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return!0;default:return L()}}function P2(n){return KI(n)&&n!==y.ABORTED}function hh(n){if(n===void 0)return _e("GRPC error has no .code"),y.UNKNOWN;switch(n){case Je.OK:return y.OK;case Je.CANCELLED:return y.CANCELLED;case Je.UNKNOWN:return y.UNKNOWN;case Je.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case Je.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case Je.INTERNAL:return y.INTERNAL;case Je.UNAVAILABLE:return y.UNAVAILABLE;case Je.UNAUTHENTICATED:return y.UNAUTHENTICATED;case Je.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case Je.NOT_FOUND:return y.NOT_FOUND;case Je.ALREADY_EXISTS:return y.ALREADY_EXISTS;case Je.PERMISSION_DENIED:return y.PERMISSION_DENIED;case Je.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case Je.ABORTED:return y.ABORTED;case Je.OUT_OF_RANGE:return y.OUT_OF_RANGE;case Je.UNIMPLEMENTED:return y.UNIMPLEMENTED;case Je.DATA_LOSS:return y.DATA_LOSS;default:return L()}}var Cy=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Lm=null;function WI(){return new mL}function L2(){return new yL("utf-8")}var F2=new ci([4294967295,4294967295],0);function YC(n){let e=WI().encode(n),t=new rE;return t.update(e),new Uint8Array(t.digest())}function XC(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new ci([t,r],0),a=new ci([i,s],0);return[o,a]}var by=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ai(`Invalid padding: ${t}`);if(r<0)throw new Ai(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ai(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ai(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=ci.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(ci.fromNumber(r)));return i.compare(F2)===1&&(i=new ci([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=YC(e),[r,i]=XC(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=YC(e),[r,i]=XC(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ai=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ol=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,al.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new ve($),Rt(),Q())}},al=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Q(),Q(),Q())}};var no=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Ch=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},bh=class{constructor(e,t,r=Ze.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Ih=class{constructor(){this.pendingResponses=0,this.documentChanges=ZC(),this._resumeToken=Ze.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Q(),t=Q(),r=Q();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:L()}}),new al(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=ZC()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,q(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},B2="WatchChangeAggregator",Iy=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Rt(),this.pendingDocumentTargetMapping=JC(),this.pendingTargetResets=new ve($)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(wh(s))if(r===0){let o=new M(s.path);this.removeDocumentFromTarget(t,o,Ve.newNoDocument(o,z.min()))}else q(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Lm?.notifyOnExistenceFilterMismatch(q2(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=jr(r).toUint8Array()}catch(l){if(l instanceof Cy)return Pn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new by(o,i,s)}catch(l){return l instanceof Ai?Pn("BloomFilter error: ",l):Pn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&wh(a.target)){let l=new M(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Ve.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Q();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new ol(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Rt(),this.pendingDocumentTargetMapping=JC(),this.pendingTargetResets=new ve($),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Ih,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new de($),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||R(B2,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Ih),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function JC(){return new ve(M.comparator)}function ZC(){return new ve(M.comparator)}function q2(n,e,t,r,i){var s,o,a,l,c,u;let h={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},d=e.unchangedNames;return d&&(h.bloomFilter={applied:i===0,hashCount:(s=d?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=d?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=d?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var v;return(v=r?.mightContain(p))!==null&&v!==void 0?v:!1}}),h}var U2=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),V2=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),z2=(()=>{let n={};return n.and="AND",n.or="OR",n})();var Ay=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function G2(n){let e=n.code===void 0?y.UNKNOWN:hh(n.code);return new b(e,n.message||"")}function Ry(n,e){return n.useProto3Json||Cl(e)?e:{value:e}}function j2(n){let e;return typeof n=="object"?e=n.value:e=n,Cl(e)?null:e}function ho(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function K2(n){let e=Jn(n);return new Me(e.seconds,e.nanos)}function HI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function W2(n,e){return n.useProto3Json?(q(e===void 0||typeof e=="string"),Ze.fromBase64String(e||"")):(q(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Ze.fromUint8Array(e||new Uint8Array))}function H2(n,e){return ho(n,e.toTimestamp())}function Pe(n){return q(!!n),z.fromTimestamp(K2(n))}function rS(n,e){return Dy(n,e).canonicalString()}function Dy(n,e){let t=$2(n).child("documents");return e===void 0?t:t.child(e)}function $I(n){let e=te.fromString(n);return q(iA(e)),e}function ll(n,e){return rS(n.databaseId,e.path)}function Ln(n,e){let t=$I(e);if(t.get(1)!==n.databaseId.projectId)throw new b(y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new b(y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(XI(t))}function QI(n,e){return rS(n.databaseId,e)}function YI(n){let e=$I(n);return e.length===4?te.emptyPath():XI(e)}function Ny(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $2(n){return new te(["projects",n.projectId,"databases",n.database])}function XI(n){return q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function eb(n,e,t){return{name:ll(n,e),fields:t.value.mapValue.fields}}function Q2(n,e){return{name:ll(n,e.key),fields:e.data.value.mapValue.fields,updateTime:ho(n,e.version.toTimestamp()),createTime:ho(n,e.createTime.toTimestamp())}}function JI(n,e,t){let r=Ln(n,e.name),i=Pe(e.updateTime),s=e.createTime?Pe(e.createTime):z.min(),o=new gt({mapValue:{fields:e.fields}}),a=Ve.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Y2(n,e){q(!!e.found),e.found.name,e.found.updateTime;let t=Ln(n,e.found.name),r=Pe(e.found.updateTime),i=e.found.createTime?Pe(e.found.createTime):z.min(),s=new gt({mapValue:{fields:e.found.fields}});return Ve.newFoundDocument(t,r,i,s)}function X2(n,e){q(!!e.missing),q(!!e.readTime);let t=Ln(n,e.missing),r=Pe(e.readTime);return Ve.newNoDocument(t,r)}function J2(n,e){return"found"in e?Y2(n,e):"missing"in e?X2(n,e):L()}function Z2(n,e){let t;if("targetChange"in e){e.targetChange;let r=eB(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=W2(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&G2(o);t=new bh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ln(n,r.document.name),s=Pe(r.document.updateTime),o=r.document.createTime?Pe(r.document.createTime):z.min(),a=new gt({mapValue:{fields:r.document.fields}}),l=Ve.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new no(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ln(n,r.document),s=r.readTime?Pe(r.readTime):z.min(),o=Ve.newNoDocument(i,s),a=r.removedTargetIds||[];t=new no([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ln(n,r.document),s=r.removedTargetIds||[];t=new no([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new _y(i,s),a=r.targetId;t=new Ch(a,o)}else return L();return t}function eB(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:L()}function tB(n){if(!("targetChange"in n))return z.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?z.min():Pe(e.readTime)}function cl(n,e){let t;if(e instanceof $r)t={update:eb(n,e.key,e.value)};else if(e instanceof Qr)t={delete:ll(n,e.key)};else if(e instanceof hn)t={update:eb(n,e.key,e.data),updateMask:MB(e.fieldMask)};else if(e instanceof rl)t={verify:ll(n,e.key)};else return L();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>oB(n,r))),e.precondition.isNone||(t.currentDocument=nB(n,e.precondition)),t}function Oy(n,e){let t=e.currentDocument?rB(e.currentDocument):Re.none(),r=e.updateTransforms?e.updateTransforms.map(i=>aB(n,i)):[];if(e.update){e.update.name;let i=Ln(n,e.update.name),s=new gt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=PB(e.updateMask);return new hn(i,s,o,t,r)}else return new $r(i,s,t,r)}else if(e.delete){let i=Ln(n,e.delete);return new Qr(i,t)}else if(e.verify){let i=Ln(n,e.verify);return new rl(i,t)}else return L()}function nB(n,e){return e.updateTime!==void 0?{updateTime:H2(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:L()}function rB(n){return n.updateTime!==void 0?Re.updateTime(Pe(n.updateTime)):n.exists!==void 0?Re.exists(n.exists):Re.none()}function iB(n,e){let t=n.updateTime?Pe(n.updateTime):Pe(e);return t.isEqual(z.min())&&(t=Pe(e)),new Ey(t,n.transformResults||[])}function sB(n,e){return n&&n.length>0?(q(e!==void 0),n.map(t=>iB(t,e))):[]}function oB(n,e){let t=e.transform;if(t instanceof Wr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Zn)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof er)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Hr)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw L()}function aB(n,e){let t=null;if("setToServerValue"in e)q(e.setToServerValue==="REQUEST_TIME"),t=new Wr;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Zn(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new er(i)}else"increment"in e?t=new Hr(n,e.increment):L();let r=We.fromServerFormat(e.fieldPath);return new Li(r,t)}function ZI(n,e){return{documents:[QI(n,e.path)]}}function lB(n){let e=n.documents.length;q(e===1);let t=n.documents[0];return Ct(Ao(YI(t)))}function eA(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=QI(n,i);let s=fB(e.filters);s&&(t.structuredQuery.where=s);let o=gB(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Ry(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=yB(e.startAt)),e.endAt&&(t.structuredQuery.endAt=vB(e.endAt)),{queryTarget:t,parent:i}}function tA(n){let e=YI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){q(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=pB(t.where));let o=[];t.orderBy&&(o=mB(t.orderBy));let a=null;t.limit&&(a=j2(t.limit));let l=null;t.startAt&&(l=SB(t.startAt));let c=null;return t.endAt&&(c=TB(t.endAt)),AI(e,i,o,s,a,"F",l,c)}function cB(n){return Ct(tA(n))}function uB(n,e){let t=hB(e.purpose);return t==null?null:{"goog-listen-tags":t}}function hB(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}function dB(n,e){let t,r=e.target;if(wh(r)?t={documents:ZI(n,r)}:t={query:eA(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=HI(n,e.resumeToken);let i=Ry(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(z.min())>0){t.readTime=ho(n,e.snapshotVersion.toTimestamp());let i=Ry(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function fB(n){if(n.length!==0)return rA(ce.create(n,"and"))}function pB(n){let e=nA(n);return e instanceof ce&&Zv(e)?e.getFilters():[e]}function nA(n){return n.unaryFilter!==void 0?OB(n):n.fieldFilter!==void 0?kB(n):n.compositeFilter!==void 0?xB(n):L()}function gB(n){if(n.length!==0)return n.map(e=>AB(e))}function mB(n){return n.map(e=>RB(e))}function yB(n){return{before:n.inclusive,values:n.position}}function vB(n){return{before:!n.inclusive,values:n.position}}function SB(n){let e=!!n.before,t=n.values||[];return new Bn(t,e)}function TB(n){let e=!n.before,t=n.values||[];return new Bn(t,e)}function EB(n){return U2[n]}function wB(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function _B(n){return V2[n]}function CB(n){return z2[n]}function bB(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function IB(n){switch(n){case"AND":return"and";case"OR":return"or";default:return L()}}function Ys(n){return{fieldPath:n.canonicalString()}}function Zs(n){return We.fromServerFormat(n.fieldPath)}function AB(n){return{field:Ys(n.field),direction:EB(n.dir)}}function RB(n){return new Mi(Zs(n.field),wB(n.direction))}function rA(n){return n instanceof J?NB(n):n instanceof ce?DB(n):L()}function DB(n){let e=n.getFilters().map(t=>rA(t));return e.length===1?e[0]:{compositeFilter:{op:CB(n.op),filters:e}}}function NB(n){if(n.op==="=="){if(GC(n.value))return{unaryFilter:{field:Ys(n.field),op:"IS_NAN"}};if(zC(n.value))return{unaryFilter:{field:Ys(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(GC(n.value))return{unaryFilter:{field:Ys(n.field),op:"IS_NOT_NAN"}};if(zC(n.value))return{unaryFilter:{field:Ys(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ys(n.field),op:_B(n.op),value:n.value}}}function OB(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Zs(n.unaryFilter.field);return J.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Zs(n.unaryFilter.field);return J.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Zs(n.unaryFilter.field);return J.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Zs(n.unaryFilter.field);return J.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function kB(n){return J.create(Zs(n.fieldFilter.field),bB(n.fieldFilter.op),n.fieldFilter.value)}function xB(n){return ce.create(n.compositeFilter.filters.map(e=>nA(e)),IB(n.compositeFilter.op))}function MB(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function PB(n){let e=n.fieldPaths||[];return new Lt(e.map(t=>We.fromServerFormat(t)))}function iA(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var fo=class n{constructor(e,t,r,i,s=z.min(),o=z.min(),a=Ze.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ah=class{constructor(e){this.remoteSerializer=e}};function LB(n,e){let t;if(e.document)t=JI(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=M.fromSegments(e.noDocument.path),i=Bi(e.noDocument.readTime);t=Ve.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=M.fromSegments(e.unknownDocument.path),i=Bi(e.unknownDocument.version);t=Ve.newUnknownDocument(r,i)}else return L();return e.readTime&&t.setReadTime(FB(e.readTime)),t}function tb(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:pd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=Q2(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Fi(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Fi(e.version)};else return L();return r}function pd(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function FB(n){let e=new Me(n[0],n[1]);return z.fromTimestamp(e)}function Fi(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Bi(n){let e=new Me(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function BB(n,e,t){let r=t.baseMutations.map(s=>cl(n.remoteSerializer,s)),i=t.mutations.map(s=>cl(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function _i(n,e){let t=(e.baseMutations||[]).map(s=>Oy(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Oy(n.remoteSerializer,s)),i=Me.fromMillis(e.localWriteTimeMs);return new il(e.batchId,i,t,r)}function za(n){let e=Bi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Bi(n.lastLimboFreeSnapshotVersion):z.min(),r;return qB(n.query)?r=lB(n.query):r=cB(n.query),new fo(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ze.fromBase64String(n.resumeToken))}function sA(n,e){let t=Fi(e.snapshotVersion),r=Fi(e.lastLimboFreeSnapshotVersion),i;wh(e.target)?i=ZI(n.remoteSerializer,e.target):i=eA(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Pi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function qB(n){return n.documents!==void 0}function UB(n){return{id:n.bundleId,createTime:Bi(n.createTime),version:n.version}}function VB(n){return{bundleId:n.id,createTime:Fi(Pe(n.createTime)),version:n.version}}function zB(n){return{name:n.name,query:iS(n.bundledQuery),readTime:Bi(n.readTime)}}function GB(n){return{name:n.name,readTime:Fi(Pe(n.readTime)),bundledQuery:n.bundledQuery}}function iS(n){let e=tA({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_h(e,e.limit,"L"):e}function jB(n){return{name:n.name,query:iS(n.bundledQuery),readTime:Pe(n.readTime)}}function KB(n){return{id:n.id,version:n.version,createTime:Pe(n.createTime)}}function Fm(n,e){return new sl(e.largestBatchId,Oy(n.remoteSerializer,e.overlayMutation))}function WB(n,e,t){let[r,i,s]=oA(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:cl(n.remoteSerializer,t.mutation)}}function oA(n,e){let t=e.path.lastSegment(),r=_t(e.path.popLast());return[n,r,t]}function HB(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function $B(n,e){let t=e?new Qa(e.sequenceNumber,new Yt(Bi(e.readTime),new M(xn(e.documentKey)),e.largestBatchId)):Qa.empty(),r=n.fields.map(([i,s])=>new eo(We.fromServerFormat(i),s));return new Jm(n.indexId,n.collectionGroup,r,t)}function nb(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Fi(r.readTime),documentKey:_t(r.documentKey.path),largestBatchId:r.largestBatchId}}var ky=class{getBundleMetadata(e,t){return rb(e).get(t).next(r=>{if(r)return UB(r)})}saveBundleMetadata(e,t){return rb(e).put(VB(t))}getNamedQuery(e,t){return ib(e).get(t).next(r=>{if(r)return zB(r)})}saveNamedQuery(e,t){return ib(e).put(GB(t))}};function rb(n){return et(n,od)}function ib(n){return et(n,ad)}var Rh=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Fa(e).get(oA(this.userId,t)).next(r=>r?Fm(this.serializer,r):null)}getOverlays(e,t){let r=Mn();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new sl(t,o);i.push(this.saveOverlay(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(_t(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Fa(e).deleteAll(oy,a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Mn(),s=_t(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Fa(e).loadAll(oy,o).next(a=>{for(let l of a){let c=Fm(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Mn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Fa(e).iterate({index:sI,range:a},(l,c,u)=>{let h=Fm(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Fa(e).put(WB(this.serializer,this.userId,t))}};function Fa(n){return et(n,ud)}var QB=5,YB=10,XB=13,sb=15,JB=20,ZB=25,eq=30,tq=37,nq=45,rq=50,iq=55,sq=60,oq=2,Xn=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,QB);else if("booleanValue"in e)this.writeValueTypeLabel(t,YB),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,sb),t.writeNumber(De(e.integerValue));else if("doubleValue"in e){let r=De(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,XB):(this.writeValueTypeLabel(t,sb),Za(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,JB),typeof r=="string"&&(r=Jn(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,eq),t.writeBytes(jr(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,nq),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?yI(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):L()}writeIndexString(e,t){this.writeValueTypeLabel(t,ZB),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,iq);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,rq);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,tq),M.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,sq),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(oq)}};Xn.INSTANCE=new Xn;var ob="\uD800",ab="\uDBFF",Gs=0,lb=255,cb=1,js=255,ub=255,hb=0,aq=64,lq=8,cq=1024;function uq(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function hq(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function dq(n){let e=0;for(let t=0;t<8;++t){let r=hq(n[t]&255);if(e+=r,r!==8)break}return e}function db(n){let e=aq-dq(n);return Math.ceil(e/lq)}var xy=class{constructor(){this.buffer=new Uint8Array(cq),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<ob||ab<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<ob||ab<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=db(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=db(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(js),this.writeEscapedByteAscending(ub)}writeInfinityDescending(){this.writeEscapedByteDescending(js),this.writeEscapedByteDescending(ub)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=uq(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Gs?(this.writeEscapedByteAscending(Gs),this.writeEscapedByteAscending(lb)):t===js?(this.writeEscapedByteAscending(js),this.writeEscapedByteAscending(hb)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Gs?(this.writeEscapedByteDescending(Gs),this.writeEscapedByteDescending(lb)):t===js?(this.writeEscapedByteDescending(js),this.writeEscapedByteDescending(hb)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Gs),this.writeEscapedByteAscending(cb)}writeSeparatorDescending(){this.writeEscapedByteDescending(Gs),this.writeEscapedByteDescending(cb)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},My=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Py=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Ci=class{constructor(){this.orderedCode=new xy,this.ascending=new My(this.orderedCode),this.descending=new Py(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var bi=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Pr(n,e){let t=n.indexId-e.indexId;return t!==0||(t=fb(n.arrayValue,e.arrayValue),t!==0)||(t=fb(n.directionalValue,e.directionalValue),t!==0)?t:M.comparator(n.documentKey,e.documentKey)}function fb(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Dh=class{constructor(e){this.inequalityFilters=new de((t,r)=>We.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(q(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=Wv(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=Oi(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new de(We.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new eo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new eo(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new eo(r.field,r.dir==="asc"?0:1)));return new Jm(Jm.UNKNOWN_ID,this.collectionId,t,Qa.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function aA(n){var e,t;if(q(n instanceof J||n instanceof ce),n instanceof J)if(n instanceof Eh){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>J.create(n.field,"==",s)))||[];return ce.create(i,"or")}else return n;let r=n.filters.map(i=>aA(i));return ce.create(r,n.op)}function fq(n){if(n.getFilters().length===0)return[];let e=Ly(aA(n));return q(lA(e)),sS(e)||oS(e)?[e]:e.getFilters()}function sS(n){return n instanceof J}function oS(n){return n instanceof ce&&Zv(n)}function lA(n){return sS(n)||oS(n)||pq(n)}function pq(n){if(n instanceof ce&&hy(n)){for(let e of n.getFilters())if(!sS(e)&&!oS(e))return!1;return!0}return!1}function Ly(n){if(q(n instanceof J||n instanceof ce),n instanceof J)return n;if(n.filters.length===1)return Ly(n.filters[0]);let e=n.filters.map(r=>Ly(r)),t=ce.create(e,n.op);return t=Nh(t),lA(t)?t:(q(t instanceof ce),q(ao(t)),q(t.filters.length>1),t.filters.reduce((r,i)=>aS(r,i)))}function aS(n,e){q(n instanceof J||n instanceof ce),q(e instanceof J||e instanceof ce);let t;return n instanceof J?e instanceof J?t=gq(n,e):t=pb(n,e):e instanceof J?t=pb(e,n):t=mq(n,e),Nh(t)}function gq(n,e){return ce.create([n,e],"and")}function mq(n,e){if(q(n.filters.length>0&&e.filters.length>0),ao(n)&&ao(e))return wI(n,e.getFilters());let t=hy(n)?n:e,r=hy(n)?e:n,i=t.filters.map(s=>aS(s,r));return ce.create(i,"or")}function pb(n,e){if(ao(e))return wI(e,n.getFilters());{let t=e.filters.map(r=>aS(n,r));return ce.create(t,"or")}}function Nh(n){if(q(n instanceof J||n instanceof ce),n instanceof J)return n;let e=n.getFilters();if(e.length===1)return Nh(e[0]);if(TI(n))return n;let t=e.map(i=>Nh(i)),r=[];return t.forEach(i=>{i instanceof J?r.push(i):i instanceof ce&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ce.create(r,n.op)}var Fy=class{constructor(){this.collectionParentIndex=new ul}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(Yt.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(Yt.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}},ul=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new de(te.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new de(te.comparator)).toArray()}};var gb="IndexedDbIndexManager",rh=new Uint8Array(0),By=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new ul,this.targetToDnfSubTargets=new qn(r=>Pi(r),(r,i)=>bl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:_t(i)};return mb(e).put(s)}return m.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[Kb(t),""],!1,!0);return mb(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(xn(o.parent))}return r})}addFieldIndex(e,t){let r=Ba(e),i=HB(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ws(e);return s.next(a=>{o.put(nb(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Ba(e),i=Ws(e),s=Ks(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ba(e),r=Ks(e),i=Ws(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return m.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new Dh(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Ks(e),i=!0,s=new Map;return m.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Q(),a=[];return m.forEach(s,(l,c)=>{R(gb,`Using index ${AL(l)} to execute ${Pi(t)}`);let u=YF(c,l),h=XF(c,l),d=JF(c,l),p=ZF(c,l),v=this.encodeBound(l,c,d),S=this.encodeBound(l,c,p),E=this.encodeValues(l,c,h),D=this.generateIndexRanges(l.indexId,u,v,d.inclusive,S,p.inclusive,E);return m.forEach(D,C=>r.loadFirst(C,t.limit).next(B=>{B.forEach(k=>{let j=M.fromSegments(k.documentKey);o.has(j)||(o=o.add(j),a.push(j))})}))}).next(()=>a)}else return m.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=fq(ce.create(e.filters,"and")).map(i=>Ty(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let h=0;h<l;++h){let d=t?this.encodeSingleElement(t[h/c]):rh,p=this.generateLowerBound(e,d,r[h%c],i),v=this.generateUpperBound(e,d,s[h%c],o),S=a.map(E=>this.generateLowerBound(e,d,E,!0));u.push(...this.createRange(p,v,S))}return u}generateLowerBound(e,t,r,i){let s=new bi(e,M.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new bi(e,M.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new Dh(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return m.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<e2(s)&&(r=1):r=0})).next(()=>t2(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Ci;for(let i of Oi(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Xn.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Ci;return Xn.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Ci;return Xn.INSTANCE.writeIndexValue(xi(this.databaseId,t),r.forKind(IL(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Ci);let s=0;for(let o of Oi(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&tl(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);Xn.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Ci;l.seed(a.encodedBytes()),Xn.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof J&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ba(e),i=Ws(e);return(t?r.loadAll(sy,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push($B(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:$(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ba(e),s=Ws(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(sy,IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,l=>s.put(nb(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return m.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),m.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let h=this.computeIndexEntries(s,c);return u.isEqual(h)?m.resolve():this.updateEntries(e,s,c,u,h)}))))})}addIndexEntry(e,t,r,i){return Ks(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Ks(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Ks(e),s=new de(Pr);return i.iterate({index:iI,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new bi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new de(Pr),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=Wv(t);if(s!=null){let o=e.data.field(s.fieldPath);if(tl(o))for(let a of o.arrayValue.values||[])r=r.add(new bi(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new bi(t.indexId,e.key,rh,i));return r}updateEntries(e,t,r,i,s){R(gb,"Updating index entries for document '%s'",t.key);let o=[];return uF(i,s,Pr,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),m.waitFor(o)}getNextSequenceNumber(e){let t=1;return Ws(e).iterate({index:rI,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Pr(o,a)).filter((o,a,l)=>!a||Pr(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Pr(o,e),l=Pr(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,rh,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,rh,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return Pr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(yb)}getMinOffset(e,t){return m.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||L())).next(yb)}};function mb(n){return et(n,Ya)}function Ks(n){return et(n,cd)}function Ba(n){return et(n,Yv)}function Ws(n){return et(n,ld)}function yb(n){q(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Hv(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Yt(e.readTime,e.documentKey,t)}function cA(n,e,t){let r=n.store(ln),i=n.store(Co),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,h,d)=>(a++,d.delete()));s.push(l.next(()=>{q(a===1)}));let c=[];for(let u of t.mutations){let h=eI(e,u.key.path,t.batchId);s.push(i.delete(h)),c.push(u.key)}return m.waitFor(s).next(()=>c)}function Oh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw L();return JSON.stringify(e).length}var kh=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Lr(e).iterate({index:Ii,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Xs(e),o=Lr(e);return o.add({}).next(a=>{q(typeof a=="number");let l=new il(a,t,r,i),c=BB(this.serializer,this.userId,l),u=[],h=new de((d,p)=>$(d.canonicalString(),p.canonicalString()));for(let d of i){let p=eI(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,PL))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),m.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return Lr(e).get(t).next(r=>r?(q(r.userId===this.userId),_i(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?m.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Lr(e).iterate({index:Ii,range:i},(o,a,l)=>{a.userId===this.userId&&(q(a.batchId>=r),s=_i(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Vr;return Lr(e).iterate({index:Ii,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Vr],[this.userId,Number.POSITIVE_INFINITY]);return Lr(e).loadAll(Ii,t).next(r=>r.map(i=>_i(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=ah(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Xs(e).iterate({range:i},(o,a,l)=>{let[c,u,h]=o,d=xn(u);if(c!==this.userId||!t.path.isEqual(d)){l.done();return}return Lr(e).get(h).next(p=>{if(!p)throw L();q(p.userId===this.userId),s.push(_i(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de($),i=[];return t.forEach(s=>{let o=ah(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Xs(e).iterate({range:a},(c,u,h)=>{let[d,p,v]=c,S=xn(p);if(d!==this.userId||!s.path.isEqual(S)){h.done();return}r=r.add(v)});i.push(l)}),m.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=ah(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new de($);return Xs(e).iterate({range:o},(l,c,u)=>{let[h,d,p]=l,v=xn(d);if(h!==this.userId||!r.isPrefixOf(v)){u.done();return}v.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Lr(e).get(s).next(o=>{if(o===null)throw L();q(o.userId===this.userId),r.push(_i(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return cA(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();let r=IDBKeyRange.lowerBound(ML(this.userId)),i=[];return Xs(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=xn(s[1]);i.push(c)}}).next(()=>{q(i.length===0)})})}containsKey(e,t){return uA(e,this.userId,t)}getMutationQueueMetadata(e){return hA(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Vr,lastStreamToken:""})}};function uA(n,e,t){let r=ah(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Xs(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,h,d]=a;u===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function yq(n,e){let t=!1;return hA(n).iterateSerial(r=>uA(n,r,e).next(i=>(i&&(t=!0),m.resolve(!i)))).next(()=>t)}function Lr(n){return et(n,ln)}function Xs(n){return et(n,Co)}function hA(n){return et(n,wl)}var Bm=2,po=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Bm,this.lastId}static forTargetCache(){return new n(2-Bm)}static forSyncEngine(){return new n(1-Bm)}};var qy=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new po(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>z.fromTimestamp(new Me(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Hs(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(q(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Hs(e).iterate((o,a)=>{let l=za(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Hs(e).iterate((r,i)=>{let s=za(i);t(s)})}retrieveMetadata(e){return vb(e).get(vh).next(t=>(q(t!==null),t))}saveMetadata(e,t){return vb(e).put(vh,t)}saveTargetData(e,t){return Hs(e).put(sA(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Pi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Hs(e).iterate({range:i,index:nI},(o,a,l)=>{let c=za(a);bl(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Br(e);return t.forEach(o=>{let a=_t(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){let i=Br(e);return m.forEach(t,s=>{let o=_t(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Br(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Br(e),s=Q();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=xn(o[1]),u=new M(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=_t(t.path),i=IDBKeyRange.bound([r],[Kb(r)],!1,!0),s=0;return Br(e).iterate({index:Qv,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Hs(e).get(t).next(r=>r?za(r):null)}};function Hs(n){return et(n,bo)}function vb(n){return et(n,Gi)}function Br(n){return et(n,Io)}var Sb={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Rl=-1,dA=40*1024*1024,Qt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Qt.DEFAULT_COLLECTION_PERCENTILE=10;Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Qt.DEFAULT=new Qt(dA,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Qt.DISABLED=new Qt(Rl,0,0);var Tb="LruGarbageCollector",Eb=1*1024*1024,vq=1*60*1e3,Sq=5*60*1e3;function wb([n,e],[t,r]){let i=$(n,t);return i===0?$(e,r):i}var Uy=class{constructor(e){this.maxElements=e,this.buffer=new de(wb),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();wb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Vy=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Rl&&this.scheduleGC(vq)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){R(Tb,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ti(t)?R(Tb,"Ignoring IndexedDB error during garbage collection: ",t):yield ei(t)}yield this.scheduleGC(Sq)}))}},zy=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return m.resolve(Pt.INVALID);let r=new Uy(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Rl?(R("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(Sb)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Sb):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>{if(c=Date.now(),$s()<=dn.DEBUG){let d=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${h} documents in ${c-l}ms
Total Duration: ${c-u}ms`;R("LruGarbageCollector",d)}return m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})})}};function Tq(n,e){return new zy(n,e)}var Gy=class{constructor(e,t){this.db=e,this.garbageCollector=Tq(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return ih(e,r)}removeReference(e,t,r){return ih(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ih(e,t)}isPinned(e,t){return yq(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(h=>{if(!h)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,z.min()),Br(e).delete(Eq(l))))});s.push(u)}}).next(()=>m.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ih(e,t)}forEachOrphanedDocument(e,t){let r=Br(e),i=Pt.INVALID,s;return r.iterate({index:Qv},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Pt.INVALID&&t(new M(xn(s)),i),i=c,s=l):i=Pt.INVALID}).next(()=>{i!==Pt.INVALID&&t(new M(xn(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Eq(n){return[0,_t(n.path)]}function wq(n,e){return{targetId:0,path:_t(n.path),sequenceNumber:e}}function ih(n,e){return Br(n).put(wq(e,n.currentSequenceNumber))}var xh=class{constructor(){this.changes=new qn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ve.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var jy=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ti(e).put(r)}removeEntry(e,t,r){return Ti(e).delete(_q(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Ve.newInvalidDocument(t);return Ti(e).iterate({index:lh,range:IDBKeyRange.only(qa(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Ve.newInvalidDocument(t)};return Ti(e).iterate({index:lh,range:IDBKeyRange.only(qa(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:Oh(s)}}).next(()=>r)}getEntries(e,t){let r=Rt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Rt(),i=new ve(M.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,Oh(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return m.resolve();let i=new de(bb);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(qa(i.first()),qa(i.last())),o=i.getIterator(),a=o.getNext();return Ti(e).iterate({index:lh,range:s},(l,c,u)=>{let h=M.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&bb(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(qa(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),pd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ti(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Rt();for(let h of c){let d=this.maybeDecodeDocument(M.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Al(t,d)||i.has(d.key))&&(u=u.insert(d.key,d))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Rt(),o=Cb(t,r),a=Cb(t,Yt.max());return Ti(e).iterate({index:tI,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let h=this.maybeDecodeDocument(M.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Ky(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return _b(e).get(iy).next(t=>(q(!!t),t))}setMetadata(e,t){return _b(e).put(iy,t)}maybeDecodeDocument(e,t){if(t){let r=LB(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(z.min())))return r}return Ve.newInvalidDocument(e)}};function fA(n){return new jy(n)}var Ky=class extends xh{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new qn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new de((s,o)=>$(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=tb(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=Oh(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=tb(this.documentCache.serializer,o.convertToNoDocument(z.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function _b(n){return et(n,_l)}function Ti(n){return et(n,sd)}function qa(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function _q(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],pd(e),t[t.length-1]]}function Cb(n,e){let t=e.documentKey.path.toArray();return[n,pd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function bb(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=$(t[s],r[s]),i)return i;return i=$(t.length,r.length),i||(i=$(t[t.length-2],r[r.length-2]),i)?i:$(t[t.length-1],r[r.length-1])}var Cq=16;var Wy=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Mh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Wa(r.mutation,i,Lt.empty(),Me.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Q()){let i=Mn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Va();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Mn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Q()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Rt(),o=nl(),a=m2();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof hn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Wa(u.mutation,c,u.mutation.getFieldMask(),Me.now())):o.set(c.key,Lt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var h;return a.set(c,new Wy(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=nl(),i=new ve((o,a)=>o-a),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Lt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let h=(i.get(a.batchId)||Q()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,h=xI();u.forEach(d=>{if(!s.has(d)){let p=VI(t.get(d),r.get(d));p!==null&&h.set(d,p),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return s2(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):eS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(Mn()),a=ro,l=s;return o.next(c=>m.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?m.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Q())).next(u=>({batchId:a,changes:kI(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=Va();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Va();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,l=>{let c=n2(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Ve.newInvalidDocument(u)))});let a=Va();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Wa(u.mutation,c,Lt.empty(),Me.now()),Al(t,c)&&(a=a.insert(l,c))}),a})}};var Hy=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return m.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,KB(t)),m.resolve()}getNamedQuery(e,t){return m.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,jB(t)),m.resolve()}};var $y=class{constructor(){this.overlays=new ve(M.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Mn();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){let i=Mn(),s=t.length+1,o=new M(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ve((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=Mn(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Mn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return m.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new sl(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Q(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var hl=class{constructor(){this.refsByKey=new de(Ue.compareByKey),this.refsByTarget=new de(Ue.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Ue(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Ue(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new M(new te([])),r=new Ue(t,e),i=new Ue(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new M(new te([])),r=new Ue(t,e),i=new Ue(t,e+1),s=Q();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ue(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ue=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return M.comparator(e.key,t.key)||$(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return $(e.targetOrBatchId,t.targetOrBatchId)||M.comparator(e.key,t.key)}};var Qy=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new de(Ue.compareByKey)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new il(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Ue(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?Vr:this.nextBatchId-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ue(t,0),i=new Ue(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de($);return t.forEach(i=>{let s=new Ue(i,0),o=new Ue(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),m.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let o=new Ue(new M(s),0),a=new de($);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),m.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");q(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return m.forEach(t.mutations,s=>{let o=new Ue(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Ue(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function bq(){return new ve(M.comparator)}var Yy=class{constructor(e){this.sizer=e,this.docs=bq(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Ve.newInvalidDocument(t))}getEntries(e,t){let r=Rt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ve.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Rt(),o=t.path,a=new M(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Hv(Hb(u),r)<=0||!i.has(u.key)&&!Al(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){L()}forEachDocumentKey(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Xy(this)}getSize(e){return m.resolve(this.size)}};function Iq(n){return new Yy(n)}var Xy=class extends xh{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Jy=class{constructor(e){this.persistence=e,this.targets=new qn(t=>Pi(t),bl),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new hl,this.targetCount=0,this.targetIdGenerator=po.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),m.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new po(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.saveTargetData(t),m.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),m.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.references.containsKey(t))}};var Aq="MemoryPersistence",Ph=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new Pt(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new Jy(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Fy,this.remoteDocumentCache=Iq(r),this.serializer=new Ah(t),this.bundleCache=new Hy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $y,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Qy(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(Aq,"Starting transaction:",e);let i=new Zy(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return m.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Zy=class extends mh{constructor(e){super(),this.currentSequenceNumber=e}},Lh=class n{constructor(e){this.persistence=e,this.localViewReferences=new hl,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw L()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),m.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.orphanedDocuments,i=>{let s=M.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,z.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return m.or([()=>m.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var ev=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new yh("createOrUpgrade",t);r<1&&i>=1&&(Dq(e),Nq(e),Ib(e),kq(e));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(Pq(e),Ib(e)),o=o.next(()=>Fq(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>Oq(e,s))),o=o.next(()=>{Bq(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(Mq(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{Lq(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{qq(e),Uq(e)})),r<12&&i>=12&&(o=o.next(()=>{zq(e)})),r<13&&i>=13&&(o=o.next(()=>xq(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(wi))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>Vq(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(ld).clear()}).next(()=>{t.objectStore(cd).clear()})),o}addDocumentGlobal(e){let t=0;return e.store(wi).iterate((r,i)=>{t+=Oh(i)}).next(()=>{let r={byteSize:t};return e.store(_l).put(iy,r)})}removeAcknowledgedMutations(e){let t=e.store(wl),r=e.store(ln);return t.loadAll().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Vr],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Ii,o).next(a=>m.forEach(a,l=>{q(l.userId===s.userId);let c=_i(this.serializer,l);return cA(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(Io),r=e.store(wi);return e.store(Gi).get(vh).next(s=>{let o=l=>t.put({targetId:0,path:_t(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new te(l),h=Rq(u);a.push(t.get(h).next(d=>d?m.resolve():o(u)))}).next(()=>m.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Ya,{keyPath:GL});let r=t.store(Ya),i=new ul,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:_t(l)})}};return t.store(wi).iterate({keysOnly:!0},(o,a)=>{let l=new te(o);return s(l.popLast())}).next(()=>t.store(Co).iterate({keysOnly:!0},([o,a,l],c)=>{let u=xn(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(bo);return t.iterate((r,i)=>{let s=za(i),o=sA(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(wi),i=[];return r.iterate((s,o)=>{let a=t.store(sd),l=Gq(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}runOverlayMigration(e,t){let r=t.store(ln),i=fA(this.serializer),s=new Ph(Lh.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Q();_i(this.serializer,l).keys().forEach(d=>u=u.add(d)),a.set(l.userId,u)}),m.forEach(a,(l,c)=>{let u=new ze(c),h=Rh.forUser(this.serializer,u),d=s.getIndexManager(u),p=kh.forUser(u,this.serializer,d,s.referenceDelegate);return new Mh(i,p,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Xa(t,Pt.INVALID),l).next()})})}};function Rq(n){return[0,_t(n)]}function Dq(n){n.createObjectStore(El)}function Nq(n){n.createObjectStore(wl,{keyPath:xL}),n.createObjectStore(ln,{keyPath:Jb,autoIncrement:!0}).createIndex(Ii,Zb,{unique:!0}),n.createObjectStore(Co)}function Oq(n,e){return e.store(ln).loadAll().next(r=>{n.deleteObjectStore(ln),n.createObjectStore(ln,{keyPath:Jb,autoIncrement:!0}).createIndex(Ii,Zb,{unique:!0});let s=e.store(ln),o=r.map(a=>s.put(a));return m.waitFor(o)})}function kq(n){n.createObjectStore(wi)}function xq(n){let e=n.createObjectStore(sd,{keyPath:LL});e.createIndex(lh,FL),e.createIndex(tI,BL)}function Mq(n){n.createObjectStore(_l)}function Ib(n){n.createObjectStore(Io,{keyPath:VL}).createIndex(Qv,zL,{unique:!0}),n.createObjectStore(bo,{keyPath:qL}).createIndex(nI,UL,{unique:!0}),n.createObjectStore(Gi)}function Pq(n){n.deleteObjectStore(Io),n.deleteObjectStore(bo),n.deleteObjectStore(Gi)}function Lq(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function Fq(n){let e=n.store(Gi),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return e.put(vh,t)}function Bq(n){n.createObjectStore(io,{keyPath:jL})}function qq(n){n.createObjectStore(od,{keyPath:KL})}function Uq(n){n.createObjectStore(ad,{keyPath:WL})}function Vq(n){n.createObjectStore(Yv,{keyPath:HL,autoIncrement:!0}).createIndex(sy,$L,{unique:!1}),n.createObjectStore(ld,{keyPath:QL}).createIndex(rI,YL,{unique:!1}),n.createObjectStore(cd,{keyPath:XL}).createIndex(iI,JL,{unique:!1})}function zq(n){let e=n.createObjectStore(ud,{keyPath:ZL});e.createIndex(oy,eF,{unique:!1}),e.createIndex(sI,tF,{unique:!1})}function Gq(n){return n.document?new M(te.fromString(n.document.name).popFirst(5)):n.noDocument?M.fromSegments(n.noDocument.path):n.unknownDocument?M.fromSegments(n.unknownDocument.path):L()}var Fr="IndexedDbPersistence",qm=30*60*1e3,Um=5e3,jq=4e3,Vm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Kq="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",Wq="firestore_zombie",pA="main",tv=class n{constructor(e,t,r,i,s,o,a,l,c,u,h=Cq){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=h,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=d=>Promise.resolve(),!n.isAvailable())throw new b(y.UNIMPLEMENTED,Kq);this.referenceDelegate=new Gy(this,i),this.dbName=t+pA,this.serializer=new Ah(l),this.simpleDb=new Gr(this.dbName,this.schemaVersion,new ev(this.serializer)),this.targetCache=new qy(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fA(this.serializer),this.bundleCache=new ky,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&_e(Fr,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new b(y.FAILED_PRECONDITION,Vm);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new Pt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>sh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(ti(e))return R(Fr,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(Fr,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Ua(e).get(Vs).next(r=>m.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return sh(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return g(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,qm)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=et(t,io);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,qm),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",jq,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?m.resolve(!0):Ua(e).get(Vs).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Um)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new b(y.FAILED_PRECONDITION,Vm);return!1}}return this.networkEnabled&&this.inForeground?!0:sh(e).loadAll().next(s=>this.filterActiveClients(s,Um).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&R(Fr,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return g(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[El,io],e=>{let t=new Xa(e,Pt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>sh(e).loadAll().next(t=>this.filterActiveClients(t,qm).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return kh.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new By(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Rh.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(Fr,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=cF(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Xa(a,this.listenSequence?this.listenSequence.next():Pt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw _e(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new b(y.FAILED_PRECONDITION,$b);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Ua(e).get(Vs).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Um)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new b(y.FAILED_PRECONDITION,Vm)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ua(e).put(Vs,t)}static isAvailable(){return Gr.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Ua(e);return t.get(Vs).next(r=>this.isLocalClient(r)?(R(Fr,"Releasing primary lease."),t.delete(Vs)):m.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(_e(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;bd()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return R(Fr,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return _e(Fr,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){_e("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${Wq}_${this.persistenceKey}_${e}`}};function Ua(n){return et(n,El)}function sh(n){return et(n,io)}function lS(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function Hq(n){return g(this,null,function*(){if(!Gr.isAvailable())return Promise.resolve();let e=n+pA;yield Gr.delete(e)})}var cS="LocalStore",$q=5*60*1e6,dl=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new ve($),this.targetIdByTarget=new qn(s=>Pi(s),bl),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Mh(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function gA(n,e,t,r){return new dl(n,e,t,r)}function mA(n,e){return g(this,null,function*(){let t=O(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Q();for(let u of s){a.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}for(let u of o){l.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function Qq(n,e){let t=O(n),r=Me.now(),i=e.reduce((a,l)=>a.add(l.key),Q()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Rt(),c=Q();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((h,d)=>{d.isValidDocument()||(c=c.add(h))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let h=[];for(let d of e){let p=R2(d,s.get(d.key).overlayedDocument);p!=null&&h.push(new hn(d.key,p,vI(p.value.mapValue),Re.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,h,e)}).next(u=>{o=u;let h=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,h)})}).then(()=>({batchId:o.batchId,changes:kI(s)}))}function Yq(n,e){let t=O(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return oU(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,Xq(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Xq(n){let e=Q();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function Jq(n,e){let t=O(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(q(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function Zq(n){let e=O(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function yA(n){let e=O(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function eU(n,e){let t=O(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,h)=>{let d=i.get(h);if(!d)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,h)));let p=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(Ze.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(h,p),tU(d,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=Rt(),c=Q();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(vA(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(z.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(h=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function vA(n,e,t){let r=Q(),i=Q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Rt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(z.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):R(cS,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function tU(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=$q?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function nU(n,e){return g(this,null,function*(){let t=O(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>m.forEach(e,i=>m.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>m.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(ti(r))R(cS,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function rU(n,e){let t=O(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Vr),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function iU(n,e){let t=O(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function go(n,e){let t=O(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new fo(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function sU(n,e,t){let r=O(n),i=r.targetIdByTarget.get(t);return i!==void 0?m.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function mo(n,e,t){return g(this,null,function*(){let r=O(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(ti(o))R(cS,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function gd(n,e,t){let r=O(n),i=z.min(),s=Q();return r.persistence.runTransaction("Execute query","readwrite",o=>sU(r,o,Ct(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:Q())).next(a=>(EA(r,DI(e),a),{documents:a,remoteKeys:s})))}function oU(n,e,t,r){let i=t.batch,s=i.keys(),o=m.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);q(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function aU(n,e){let t=O(n),r=O(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):m.resolve(null)))}function lU(n,e){O(O(n,dl).mutationQueue).removeCachedMutationKeys(e)}function cU(n){return O(O(n,dl).persistence).getActiveClients()}function SA(n,e){let t=O(n),r=O(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function TA(n,e){let t=O(n),r=t.collectionGroupReadTime.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,Wb(r,ro),Number.MAX_SAFE_INTEGER)).then(i=>(EA(t,e,i),i))}function EA(n,e,t){let r=n.collectionGroupReadTime.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function uU(n){return Ct(Ao(te.fromString(`__bundle__/docs/${n}`)))}function hU(n,e,t,r){return g(this,null,function*(){let i=O(n),s=Q(),o=Rt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let h=e.toMutableDocument(c);h.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,h)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield go(i,uU(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>vA(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function dU(n,e){let t=O(n),r=Pe(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function fU(n,e){let t=O(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function pU(n,e){let t=O(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function gU(r,i){return g(this,arguments,function*(n,e,t=Q()){let s=yield go(n,Ct(iS(e.bundledQuery))),o=O(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Pe(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Ze.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var nv=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var mU=100;function yU(){return bd()?8:Qb(xo())>0?6:4}var Fh=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=mU,this.relativeIndexReadCostPerDocument=yU()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new nv;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?($s()<=dn.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",Qs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),m.resolve()):($s()<=dn.DEBUG&&R("QueryEngine","Query:",Qs(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?($s()<=dn.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",Qs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ct(t))):m.resolve())}performQueryUsingIndex(e,t){if(HC(t))return m.resolve(null);let r=Ct(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=_h(t,null,"F"),r=Ct(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Q(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,_h(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return HC(t)||i.isEqual(z.min())?m.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?m.resolve(null):($s()<=dn.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qs(t)),this.appendRemainingResults(e,o,t,Wb(i,ro)).next(a=>a))})}applyQuery(e,t){let r=new de(NI(e));return t.forEach((i,s)=>{Al(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return $s()<=dn.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",Qs(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Yt.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var wA="firestore_clients";function Ab(n,e){return`${wA}_${n}_${e}`}var _A="firestore_mutations";function Rb(n,e,t){let r=`${_A}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var CA="firestore_targets";function zm(n,e){return`${CA}_${n}_${e}`}var vU="firestore_online_state";function SU(n){return`${vU}_${n}`}var TU="firestore_bundle_loaded_v2";function EU(n){return`${TU}_${n}`}var wU="firestore_sequence_number";function _U(n){return`${wU}_${n}`}var kn="SharedClientState",Bh=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new b(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(_e(kn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ha=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new b(r.error.code,r.error.message))),i?new n(e,r.state,s):(_e(kn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},qh=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=nS();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=gI(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(_e(kn,`Failed to parse client data for instance '${e}': ${t}`),null)}},rv=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(_e(kn,`Failed to parse online state: ${e}`),null)}},fl=class{constructor(){this.activeTargetIds=nS()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},$a=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new ve($),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=Ab(this.persistenceKey,this.localClientId),this.sequenceNumberKey=_U(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new fl),this.clientStateKeyRe=new RegExp(`^${wA}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${_A}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${CA}_${o}_(\\d+)$`),this.onlineStateKey=SU(this.persistenceKey),this.bundleLoadedKey=EU(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(Ab(this.persistenceKey,r));if(i){let s=qh.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(zm(this.persistenceKey,e));if(r){let i=Ha.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(zm(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(kn,"READ",e,t),t}setItem(e,t){R(kn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(kn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(R(kn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){_e("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>g(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=CU(t.newValue);r!==Pt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Bh(this.currentUser,e,t,r),s=Rb(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=Rb(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=zm(this.persistenceKey,e),s=new Ha(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return qh.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Bh.fromWebStorageEntry(new ze(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Ha.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return rv.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return g(this,null,function*(){if(e.user.uid!==this.currentUser.uid){R(kn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=nS();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function CU(n){let e=Pt.INVALID;if(n!=null)try{let t=JSON.parse(n);q(typeof t=="number"),e=t}catch(t){_e(kn,"Failed to read sequence number from WebStorage",t)}return e}var Uh=class{constructor(){this.localState=new fl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new fl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var iv=class{addCallback(e){}shutdown(){}};var sv=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var oh=null;function bU(){return 268435456+Math.round(2147483648*Math.random())}function Gm(){return oh===null?oh=bU():oh++,"0x"+oh.toString(16)}function IU(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var AU="1.9.1",wt="GrpcConnection",RU=`gl-node/${process.versions.node} fire/${_o} grpc/${AU}`;function jm(n,e,t,r){q(e===null||e.type==="OAuth");let i=new Di.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",RU),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var ov=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){R(wt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Di.credentials.createSsl():Di.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Gm(),a=this.ensureActiveStub(),l=jm(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return IU(u=>(R(wt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(h,d)=>{h?(R(wt,`RPC '${e}' ${o} failed with error:`,h),u(new b(hh(h.code),h.message))):(R(wt,`RPC '${e}' ${o} completed with response:`,d),u(void 0,d))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Gm(),l=[],c=new xe;R(wt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),h=jm(this.databasePath,i,s,this.databaseInfo.appId),d=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](d,h),v=!1;return p.on("data",S=>{R(wt,`RPC ${e} ${a} received result:`,S),l.push(S),o!==void 0&&l.length===o&&(v=!0,c.resolve(l))}),p.on("end",()=>{R(wt,`RPC '${e}' ${a} completed.`),v||(v=!0,c.resolve(l))}),p.on("error",S=>{R(wt,`RPC '${e}' ${a} failed with error:`,S);let E=hh(S.code);c.reject(new b(E,S.message))}),c.promise}openStream(e,t,r){let i=Gm(),s=this.ensureActiveStub(),o=jm(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=d=>{l||(l=!0,u.callOnClose(d),a.end())},u=new sv({sendFn:d=>{if(l)R(wt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,d);else{R(wt,`RPC '${e}' stream ${i} sending:`,d);try{a.write(d)}catch(p){throw _e("Failure sending:",d),_e("Error:",p),p}}},closeFn:()=>{R(wt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),h=!1;return a.on("data",d=>{l||(R(wt,`RPC '${e}' stream ${i} received:`,d),h||(u.callOnConnected(),h=!0),u.callOnMessage(d))}),a.on("end",()=>{R(wt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",d=>{if(!l){Pn(wt,`RPC '${e}' stream ${i} error. Code:`,d.code,"Message:",d.message);let p=hh(d.code);c(new b(p,d.message))}}),R(wt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},bA={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},DU={nested:bA},NU=Object.freeze({__proto__:null,nested:bA,default:DU});var OU={longs:String,enums:String,defaults:!0,oneofs:!1};function kU(){let n=jb.fromJSON(NU,OU);return Di.loadPackageDefinition(n)}function xU(n){let e=kU();return new ov(e,n)}function MU(){return new iv}function IA(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function PU(){return null}function Dl(n){return new Ay(n,!1)}var LU="ExponentialBackoff",FU=1e3,BU=1.5,qU=60*1e3,pl=class{constructor(e,t,r=FU,i=BU,s=qU){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&R(LU,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var Db="PersistentStream",UU=60*1e3,VU=10*1e3,Vh=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new pl(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return g(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,UU,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return g(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return g(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===y.RESOURCE_EXHAUSTED?(_e(t.toString()),_e("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new b(y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,VU,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>g(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return R(Db,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(R(Db,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},av=class extends Vh{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=Z2(this.serializer,e),r=tB(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Ny(this.serializer),t.addTarget=dB(this.serializer,e);let r=uB(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Ny(this.serializer),t.removeTarget=e,this.sendRequest(t)}},lv=class extends Vh{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=sB(e.writeResults,e.commitTime),r=Pe(e.commitTime);return this.listener.onMutationResult(r,t)}else return q(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=Ny(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>cl(this.serializer,r))};this.sendRequest(t)}};var cv=class{},uv=class extends cv{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new b(y.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Dy(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new b(y.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Dy(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new b(y.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function zU(n,e,t,r){return new uv(n,e,t,r)}function GU(n,e){return g(this,null,function*(){let t=O(n),r={writes:e.map(i=>cl(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,te.emptyPath(),r)})}function jU(n,e){return g(this,null,function*(){let t=O(n),r={documents:e.map(a=>ll(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,te.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=J2(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());q(!!l),o.push(l)}),o})}function KU(n,e,t){let r=O(n);return r.verifyInitialized(),new lv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function WU(n,e,t){let r=O(n);return r.verifyInitialized(),new av(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var HU="OnlineStateTracker",Nb=1,Ob=10*1e3,hv=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",Ob,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${Ob/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=Nb&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${Nb} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(_e(t),this.shouldWarnClientIsOffline=!1):R(HU,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var qi="RemoteStore",$U=10,dv=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>g(this,null,function*(){ni(this)&&(R(qi,"Restarting streams for network reachability change."),yield d4(this))}))}),this.onlineStateTracker=new hv(r,i)}};function QU(n,e,t,r,i){return new dv(n,e,t,r,i)}function YU(n){let e=O(n);return e.offlineCauses.delete(0),Nl(e)}function Nl(n){return g(this,null,function*(){if(ni(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function XU(n){return g(this,null,function*(){let e=O(n);e.offlineCauses.add(0),yield Ro(e),e.onlineStateTracker.set("Offline")})}function Ro(n){return g(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function JU(n){return g(this,null,function*(){let e=O(n);R(qi,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Ro(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function md(n,e){let t=O(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),dS(t)?hS(t):Oo(t).isOpen()&&uS(t,e))}function Do(n,e){let t=O(n),r=Oo(t);t.listenTargets.delete(e),r.isOpen()&&AA(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():ni(t)&&t.onlineStateTracker.set("Unknown"))}function uS(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Oo(n).watch(e)}function AA(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Oo(n).unwatch(e)}function hS(n){n.watchChangeAggregator=new Iy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Oo(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function dS(n){return ni(n)&&!Oo(n).isStarted()&&n.listenTargets.size>0}function ni(n){return O(n).offlineCauses.size===0}function RA(n){n.watchChangeAggregator=void 0}function ZU(n){return g(this,null,function*(){n.onlineStateTracker.set("Online")})}function e4(n){return g(this,null,function*(){n.listenTargets.forEach((e,t)=>{uS(n,e)})})}function t4(n,e){return g(this,null,function*(){RA(n),dS(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),hS(n)):n.onlineStateTracker.set("Unknown")})}function n4(n,e,t){return g(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof bh&&e.state===2&&e.cause){try{yield i4(n,e)}catch(r){R(qi,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield zh(n,r)}return}if(e instanceof no?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Ch?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(z.min()))try{let r=yield yA(n.localStore);t.compareTo(r)>=0&&(yield r4(n,t))}catch(r){R(qi,"Failed to raise snapshot:",r),yield zh(n,r)}})}function zh(n,e,t){return g(this,null,function*(){if(ti(e))n.offlineCauses.add(1),yield Ro(n),n.onlineStateTracker.set("Offline"),t||(t=()=>yA(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){R(qi,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Nl(n)}));else throw e})}function DA(n,e){return e().catch(t=>zh(n,t,e))}function r4(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Ze.EMPTY_BYTE_STRING,s.snapshotVersion)),AA(n,r);let o=new fo(s.target,r,i,s.sequenceNumber);uS(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function i4(n,e){return g(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function No(n){return g(this,null,function*(){let e=O(n),t=ri(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Vr;for(;s4(e);)try{let i=yield rU(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,o4(e,i)}catch(i){yield zh(e,i)}NA(e)&&OA(e)})}function s4(n){return ni(n)&&n.writePipeline.length<$U}function o4(n,e){n.writePipeline.push(e);let t=ri(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function NA(n){return ni(n)&&!ri(n).isStarted()&&n.writePipeline.length>0}function OA(n){ri(n).start()}function a4(n){return g(this,null,function*(){ri(n).writeHandshake()})}function l4(n){return g(this,null,function*(){let e=ri(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function c4(n,e,t){return g(this,null,function*(){let r=n.writePipeline.shift(),i=wy.from(r,e,t);yield DA(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield No(n)})}function u4(n,e){return g(this,null,function*(){e&&ri(n).handshakeComplete&&(yield h4(n,e)),NA(n)&&OA(n)})}function h4(n,e){return g(this,null,function*(){if(P2(e.code)){let t=n.writePipeline.shift();ri(n).inhibitBackoff(),yield DA(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield No(n)}})}function d4(n){return g(this,null,function*(){let e=O(n);e.offlineCauses.add(4),yield Ro(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Nl(e)})}function kb(n,e){return g(this,null,function*(){let t=O(n);t.asyncQueue.verifyOperationInProgress(),R(qi,"RemoteStore received new credentials");let r=ni(t);t.offlineCauses.add(3),yield Ro(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Nl(t)})}function fv(n,e){return g(this,null,function*(){let t=O(n);e?(t.offlineCauses.delete(2),yield Nl(t)):e||(t.offlineCauses.add(2),yield Ro(t),t.onlineStateTracker.set("Unknown"))})}function Oo(n){return n.watchStream||(n.watchStream=WU(n.datastore,n.asyncQueue,{onConnected:ZU.bind(null,n),onOpen:e4.bind(null,n),onClose:t4.bind(null,n),onWatchChange:n4.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.watchStream.inhibitBackoff(),dS(n)?hS(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),RA(n))}))),n.watchStream}function ri(n){return n.writeStream||(n.writeStream=KU(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:a4.bind(null,n),onClose:u4.bind(null,n),onHandshakeComplete:l4.bind(null,n),onMutationResult:c4.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield No(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(R(qi,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var f4="AsyncQueue",pv=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new xe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new b(y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ko(n,e){if(_e(f4,`${e}: ${n}`),ti(n))return new b(y.UNAVAILABLE,`${e}: ${n}`);throw n}var Gh=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||M.comparator(t.key,r.key):this.comparator=(t,r)=>M.comparator(t.key,r.key),this.keyedMap=Va(),this.sortedSet=new ve(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var jh=class{constructor(){this.changeMap=new ve(M.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):L()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},yo=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Gh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Il(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var gv=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function p4(){return new mv}var mv=class{constructor(){this.queries=new qn(e=>RI(e),Il),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function fS(n,e){return g(this,null,function*(){let t=O(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new gv,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=ko(o,`Initialization of query '${Qs(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&gS(t)})}function pS(n,e){return g(this,null,function*(){let t=O(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function g4(n,e){let t=O(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&gS(t)}function m4(n,e,t){let r=O(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function y4(n,e){let t=O(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&gS(t)}function v4(n,e){O(n).snapshotsInSyncListeners.add(e),e.next()}function S4(n,e){O(n).snapshotsInSyncListeners.delete(e)}function gS(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var kA=function(n){return n.Default="default",n.Cache="cache",n}(kA||{}),gl=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new yo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=yo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==kA.Cache}};var yv=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Q(),i=Q();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Kh=class{constructor(e){this.serializer=e}toDocumentKey(e){return Ln(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?JI(this.serializer,e.document,!1):Ve.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Pe(e)}},vv=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=xA(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=te.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Kh(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||Q()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield hU(this.localStore,new Kh(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield gU(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function xA(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function T4(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Wh=class{constructor(e){this.key=e}},Hh=class{constructor(e){this.key=e}},$h=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Q(),this.mutatedKeys=Q(),this.docComparator=NI(e),this.documentSet=new Gh(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new jh,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{let d=i.get(u),p=Al(this.query,h)?h:null,v=d?this.mutatedKeys.has(d.key):!1,S=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,E=!1;d&&p?d.data.isEqual(p.data)?v!==S&&(r.track({type:3,doc:p}),E=!0):this.shouldWaitForSyncedDocument(d,p)||(r.track({type:2,doc:p}),E=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!d&&p?(r.track({type:0,doc:p}),E=!0):d&&!p&&(r.track({type:1,doc:d}),E=!0,(l||c)&&(a=!0)),E&&(p?(o=o.add(p),S?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((h,d)=>E4(h.type,d.type)||this.docComparator(h.doc,d.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new yo(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new jh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Q(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Hh(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Wh(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Q();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return yo.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function E4(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return L()}};return t(n)-t(e)}var ii="SyncEngine",Sv=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Tv=class{constructor(e){this.key=e,this.receivedDocument=!1}},Ev=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new qn(a=>RI(a),Il),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new ve(M.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new hl,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=po.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function w4(n,e,t,r,i,s,o){let a=new Ev(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function _4(n,e,t=!0){return g(this,null,function*(){let r=yd(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield MA(r,e,t,!0),i})}function C4(n,e){return g(this,null,function*(){let t=yd(n);yield MA(t,e,!0,!1)})}function MA(n,e,t,r){return g(this,null,function*(){let i=yield go(n.localStore,Ct(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield mS(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&md(n.remoteStore,i),a})}function mS(n,e,t,r,i){return g(this,null,function*(){n.applyDocChanges=(h,d,p)=>P4(n,h,d,p);let s=yield gd(n.localStore,e,!0),o=new $h(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=al.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);SS(n,t,c.limboChanges);let u=new Sv(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function b4(n,e,t){return g(this,null,function*(){let r=O(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Il(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield mo(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Do(r.remoteStore,i.targetId),vo(r,i.targetId)}).catch(ei))):(vo(r,i.targetId),yield mo(r.localStore,i.targetId,!0))})}function I4(n,e){return g(this,null,function*(){let t=O(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Do(t.remoteStore,r.targetId))})}function A4(n,e,t){return g(this,null,function*(){let r=ES(n);try{let i=yield Qq(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),x4(r,i.batchId,t),yield ir(r,i.changes),yield No(r.remoteStore)}catch(i){let s=ko(i,"Failed to persist write");t.reject(s)}})}function PA(n,e){return g(this,null,function*(){let t=O(n);try{let r=yield eU(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?q(o.receivedDocument):i.removedDocuments.size>0&&(q(o.receivedDocument),o.receivedDocument=!1))}),yield ir(t,r,e)}catch(r){yield ei(r)}})}function xb(n,e,t){let r=O(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),y4(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function R4(n,e,t){return g(this,null,function*(){let r=O(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new ve(M.comparator);o=o.insert(s,Ve.newNoDocument(s,z.min()));let a=Q().add(s),l=new ol(z.min(),new Map,new ve($),o,a);yield PA(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),TS(r)}else yield mo(r.localStore,e,!1).then(()=>vo(r,e,t)).catch(ei)})}function D4(n,e){return g(this,null,function*(){let t=O(n),r=e.batch.batchId;try{let i=yield Yq(t.localStore,e);vS(t,r,null),yS(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ir(t,i)}catch(i){yield ei(i)}})}function N4(n,e,t){return g(this,null,function*(){let r=O(n);try{let i=yield Jq(r.localStore,e);vS(r,e,t),yS(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ir(r,i)}catch(i){yield ei(i)}})}function O4(n,e){return g(this,null,function*(){let t=O(n);ni(t.remoteStore)||R(ii,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield Zq(t.localStore);if(r===Vr){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=ko(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function yS(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function k4(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new b(y.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function x4(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new ve($)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function vS(n,e,t){let r=O(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function vo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||LA(n,i)})}function LA(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Do(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),TS(n))}function SS(n,e,t){for(let r of t)r instanceof Wh?(n.limboDocumentRefs.addReference(r.key,e),M4(n,r)):r instanceof Hh?(R(ii,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||LA(n,r.key)):L()}function M4(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(R(ii,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),TS(n))}function TS(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new M(te.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new Tv(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),md(n.remoteStore,new fo(Ct(Ao(t.path)),r,"TargetPurposeLimboResolution",Pt.INVALID))}}function ir(n,e,t){return g(this,null,function*(){let r=O(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=yv.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield nU(r.localStore,s))})}function P4(n,e,t,r){return g(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield gd(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return SS(n,e.targetId,a.limboChanges),a.snapshot})}function L4(n,e){return g(this,null,function*(){let t=O(n);if(!t.currentUser.isEqual(e)){R(ii,"User change. New user:",e.toKey());let i=yield mA(t.localStore,e);t.currentUser=e,k4(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield ir(t,i.affectedDocuments)}})}function F4(n,e){let t=O(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Q().add(r.key);{let i=Q(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function B4(n,e){return g(this,null,function*(){let t=O(n),r=yield gd(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&SS(t,e.targetId,i.limboChanges),i})}function q4(n,e){return g(this,null,function*(){let t=O(n);return TA(t.localStore,e).then(r=>ir(t,r))})}function U4(n,e,t,r){return g(this,null,function*(){let i=O(n),s=yield aU(i.localStore,e);if(s===null){R(ii,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield No(i.remoteStore):t==="acknowledged"||t==="rejected"?(vS(i,e,r||null),yS(i,e),lU(i.localStore,e)):L(),yield ir(i,s)})}function V4(n,e){return g(this,null,function*(){let t=O(n);if(yd(t),ES(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Mb(t,r.toArray());t._isPrimaryClient=!0,yield fv(t.remoteStore,!0);for(let s of i)md(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(vo(t,o),mo(t.localStore,o,!0))),Do(t.remoteStore,o)}),yield i,yield Mb(t,r),z4(t),t._isPrimaryClient=!1,yield fv(t.remoteStore,!1)}})}function z4(n){let e=O(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Do(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new ve(M.comparator)}function Mb(n,e,t){return g(this,null,function*(){let r=O(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield go(r.localStore,Ct(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),h=yield B4(r,u);h.snapshot&&s.push(h.snapshot)}}else{let c=yield SA(r.localStore,o);a=yield go(r.localStore,c),yield mS(r,FA(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function FA(n){return AI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function G4(n){let e=O(n);return cU(e.localStore)}function j4(n,e,t,r){return g(this,null,function*(){let i=O(n);if(i._isPrimaryClient){R(ii,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield TA(i.localStore,DI(s[0])),a=ol.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ze.EMPTY_BYTE_STRING);yield ir(i,o,a);break}case"rejected":{yield mo(i.localStore,e,!0),vo(i,e,r);break}default:L()}})}function K4(n,e,t){return g(this,null,function*(){let r=yd(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){R(ii,"Adding an already active target "+i);continue}let o=yield SA(r.localStore,i),a=yield go(r.localStore,o);yield mS(r,FA(o),a.targetId,!1,a.resumeToken),md(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield mo(r.localStore,i,!1).then(()=>{Do(r.remoteStore,i),vo(r,i)}).catch(ei))}})}function yd(n){let e=O(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=PA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=F4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=R4.bind(null,e),e.syncEngineListener.onWatchChange=g4.bind(null,e.eventManager),e.syncEngineListener.onWatchError=m4.bind(null,e.eventManager),e}function ES(n){let e=O(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=D4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=N4.bind(null,e),e}function W4(n,e,t){let r=O(n);H4(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function H4(n,e,t){return g(this,null,function*(){try{let r=yield e.getMetadata();if(yield dU(n.localStore,r))return yield e.close(),t._completeWith(T4(r)),Promise.resolve(new Set);t._updateProgress(xA(r));let s=new vv(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield ir(n,a.changedDocs,void 0),yield fU(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return Pn(ii,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var ml=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Dl(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return gA(this.persistence,new Fh,e.initialUser,this.serializer)}createPersistence(e){return new Ph(Lh.factory,this.serializer)}createSharedClientState(e){return new Uh}terminate(){return g(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Qh=class n extends ml{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield Cd(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield ES(this.onlineComponentProvider.syncEngine),yield No(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return gA(this.persistence,new Fh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Vy(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new ny(t,this.persistence);return new ty(e.asyncQueue,r)}createPersistence(e){let t=lS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new tv(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,IA(),PU(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Uh}},wv=class n extends Qh{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield Cd(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof $a&&(this.sharedClientState.syncEngine={applyBatchState:U4.bind(null,t),applyTargetState:j4.bind(null,t),applyActiveTargetsChange:K4.bind(null,t),getActiveClients:G4.bind(null,t),synchronizeWithChangedDocuments:q4.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>g(this,null,function*(){yield V4(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=IA();if(!$a.isAvailable(t))throw new b(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=lS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new $a(t,e.asyncQueue,r,e.clientId,e.initialUser)}},yl=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>xb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=L4.bind(null,this.syncEngine),yield fv(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return p4()}createDatastore(e){let t=Dl(e.databaseInfo.databaseId),r=xU(e.databaseInfo);return zU(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return QU(this.localStore,this.datastore,e.asyncQueue,t=>xb(this.syncEngine,t,0),MU())}createSyncEngine(e,t){return w4(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e;yield JU(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var $4=10240;function Q4(n,e=$4){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function wS(n,e,t){if(!t)throw new b(y.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Y4(n,e,t,r){if(e===!0&&r===!0)throw new b(y.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Pb(n){if(!M.isDocumentKey(n))throw new b(y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Lb(n){if(M.isDocumentKey(n))throw new b(y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function X4(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ol(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=J4(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":L()}function J4(n){return n.constructor?n.constructor.name:null}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new b(y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ol(n);throw new b(y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function BA(n,e){if(e<=0)throw new b(y.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Z4(n,e){if(!(n instanceof Uint8Array))throw new b(y.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Ol(n)}`);return Q4(n,e)}var So=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):_e("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var _v=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var Cv=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new xe,this.buffer=new Uint8Array,this.textDecoder=L2(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}nextElement(){return g(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return g(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new _v(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return g(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return g(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function e3(n,e){return new Cv(n,e)}var bv=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new b(y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield jU(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Qr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=M.fromPath(r);this.mutations.push(new rl(i,this.precondition(i)))}),yield GU(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=z.min();else throw L();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new b(y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?Re.exists(!1):Re.updateTime(t):Re.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new b(y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Re.updateTime(t)}else return Re.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Iv=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new pl(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>g(this,null,function*(){let e=new bv(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return Cl(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!KI(t)}return!1}};var Yr="FirestoreClient",t3=100,n3=11,r3=20,i3=22,Av=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ze.UNAUTHENTICATED,this.clientId=ph.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){R(Yr,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(R(Yr,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:t3}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new b(y.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new xe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ko(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function dh(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),R(Yr,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield mA(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Rv(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield _S(n);R(Yr,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>kb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>kb(e.remoteStore,i)),n._onlineComponents=e})}function qA(n){return n.name==="FirebaseError"?n.code===y.FAILED_PRECONDITION||n.code===y.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===i3||n.code===r3||n.code===n3:!0}function _S(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){R(Yr,"Using user provided OfflineComponentProvider");try{yield dh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!qA(t))throw t;Pn("Error using user provided cache. Falling back to memory cache: "+t),yield dh(n,new ml)}}else R(Yr,"Using default OfflineComponentProvider"),yield dh(n,new ml);return n._offlineComponents})}function vd(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(R(Yr,"Using user provided OnlineComponentProvider"),yield Rv(n,n._uninitializedComponentsProvider._online)):(R(Yr,"Using default OnlineComponentProvider"),yield Rv(n,new yl))),n._onlineComponents})}function UA(n){return _S(n).then(e=>e.persistence)}function CS(n){return _S(n).then(e=>e.localStore)}function VA(n){return vd(n).then(e=>e.remoteStore)}function bS(n){return vd(n).then(e=>e.syncEngine)}function s3(n){return vd(n).then(e=>e.datastore)}function To(n){return g(this,null,function*(){let e=yield vd(n),t=e.eventManager;return t.onListen=_4.bind(null,e.syncEngine),t.onUnlisten=b4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=C4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=I4.bind(null,e.syncEngine),t})}function o3(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield UA(n),t=yield VA(n);return e.setNetworkEnabled(!0),YU(t)}))}function a3(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield UA(n),t=yield VA(n);return e.setNetworkEnabled(!1),XU(t)}))}function l3(n){let e=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let t=yield bS(n);return O4(t,e)})),e.promise}function c3(n,e,t,r){let i=new So(r),s=new gl(e,i,t);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield To(n);return fS(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield To(n);return pS(o,s)}))}}function u3(n,e){let t=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield CS(n);return g3(r,e,t)})),t.promise}function zA(n,e,t={}){let r=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield To(n);return m3(i,n.asyncQueue,e,t,r)})),r.promise}function h3(n,e){let t=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield CS(n);return y3(r,e,t)})),t.promise}function GA(n,e,t={}){let r=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield To(n);return v3(i,n.asyncQueue,e,t,r)})),r.promise}function d3(n,e){let t=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield bS(n);return A4(r,e,t)})),t.promise}function f3(n,e){let t=new So(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield To(n);return v4(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield To(n);return S4(r,t)}))}}function p3(n,e,t){let r=new xe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield s3(n);new Iv(n.asyncQueue,i,t,e,r).run()})),r.promise}function g3(n,e,t){return g(this,null,function*(){try{let r=yield iU(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new b(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=ko(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function m3(n,e,t,r,i){let s=new So({next:a=>{e.enqueueAndForget(()=>pS(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new b(y.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new b(y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new gl(Ao(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return fS(n,o)}function y3(n,e,t){return g(this,null,function*(){try{let r=yield gd(n,e,!0),i=new $h(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=ko(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function v3(n,e,t,r,i){let s=new So({next:a=>{e.enqueueAndForget(()=>pS(n,o)),a.fromCache&&r.source==="server"?i.reject(new b(y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new gl(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return fS(n,o)}function S3(n,e,t,r){let i=E3(t,Dl(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){W4(yield bS(n),i,r)}))}function T3(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return pU(yield CS(n),e)}))}function E3(n,e){let t;return typeof n=="string"?t=WI().encode(n):t=n,e3(Z4(t),e)}function w3(n,e){return n.timeoutSeconds===e.timeoutSeconds}function jA(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var _3="ComponentProvider",Fb=new Map;function C3(n){let e=Fb.get(n);e&&(R(_3,"Removing Datastore"),Fb.delete(n),e.terminate())}function b3(n,e,t,r){return new ly(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,jA(r.experimentalLongPollingOptions),r.useFetchStreams)}var KA="firestore.googleapis.com",Bb=!0,qb=5,Ub=30,I3=!0,Yh=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new b(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=KA,this.ssl=Bb}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Bb;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=dA;else{if(e.cacheSizeBytes!==Rl&&e.cacheSizeBytes<Eb)throw new b(y.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${Eb}`);this.cacheSizeBytes=e.cacheSizeBytes}Y4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=I3:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jA((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),A3(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&w3(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function A3(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new b(y.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<qb)throw new b(y.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${qb})`);if(n.timeoutSeconds>Ub)throw new b(y.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${Ub})`)}}var Ui=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new b(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new b(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yh(e),e.credentials!==void 0&&(this._authCredentials=wL(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return C3(this),Promise.resolve()}};function R3(n,e,t,r={}){var i;n=oe(n,Ui);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==KA&&s.host!==o&&Pn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=ze.MOCK_USER;else{a=xS(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new b(y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ze(c)}n._authCredentials=new Wm(new fh(a,l))}}var it=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Le=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Fn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Fn=class n extends it{constructor(e,t,r){super(e,t,Ao(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Le(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function k6(n,e,...t){if(n=je(n),wS("collection","path",e),n instanceof Ui){let r=te.fromString(e,...t);return Lb(r),new Fn(n,null,r)}else{if(!(n instanceof Le)&&!(n instanceof Fn))throw new b(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Lb(r),new Fn(n.firestore,null,r)}}function x6(n,e){if(n=oe(n,Ui),wS("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new b(y.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new it(n,null,i2(e))}function D3(n,e,...t){if(n=je(n),arguments.length===1&&(e=ph.newId()),wS("doc","path",e),n instanceof Ui){let r=te.fromString(e,...t);return Pb(r),new Le(n,null,new M(r))}else{if(!(n instanceof Le)&&!(n instanceof Fn))throw new b(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Pb(r),new Le(n.firestore,n instanceof Fn?n.converter:null,new M(r))}}function M6(n,e){return n=je(n),e=je(e),(n instanceof Le||n instanceof Fn)&&(e instanceof Le||e instanceof Fn)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function N3(n,e){return n=je(n),e=je(e),n instanceof it&&e instanceof it?n.firestore===e.firestore&&Il(n._query,e._query)&&n.converter===e.converter:!1}var O3="AsyncQueue",Dv=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new pl(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new xe;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return g(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(ti(e))R(O3,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=x3(r);throw _e("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=pv.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&L()}verifyOperationInProgress(){}drain(){return g(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function k3(){return new Dv}function x3(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var Nv=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new xe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var P6=Rl,we=class extends Ui{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=k3(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||WA(this),this._firestoreClient.terminate()}};function L6(n,e){let t=typeof n=="object"?n:VS(),r=typeof n=="string"?n:e||cy,i=qS(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=kS("firestore");s&&R3(i,...s)}return i}function st(n){return n._firestoreClient||WA(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function WA(n){var e,t,r;let i=n._freezeSettings(),s=b3(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Av(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function F6(n,e){n=oe(n,we),$A(n);let t=st(n);if(t._uninitializedComponentsProvider)throw new b(y.FAILED_PRECONDITION,"SDK cache is already specified.");Pn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new yl,s=new Qh(i,r.cacheSizeBytes,e?.forceOwnership);return HA(t,i,s)}function B6(n){n=oe(n,we),$A(n);let e=st(n);if(e._uninitializedComponentsProvider)throw new b(y.FAILED_PRECONDITION,"SDK cache is already specified.");Pn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new yl,i=new wv(r,t.cacheSizeBytes);return HA(e,r,i)}function HA(n,e,t){let r=new xe;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield dh(n,t),yield Rv(n,e),r.resolve()}catch(i){let s=i;if(!qA(s))throw s;Pn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function q6(n){if(n._initialized&&!n._terminated)throw new b(y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new xe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield Hq(lS(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function U6(n){n=oe(n,we);let e=st(n);return l3(e)}function V6(n){n=oe(n,we);let e=st(n);return o3(e)}function z6(n){n=oe(n,we);let e=st(n);return a3(e)}function G6(n,e){n=oe(n,we);let t=st(n),r=new Nv;return S3(t,n._databaseId,e,r),r}function j6(n,e){n=oe(n,we);let t=st(n);return T3(t,e).then(r=>r?new it(n,null,r.query):null)}function $A(n){if(n._initialized||n._terminated)throw new b(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function M3(n,e=!0){TL(US),BS(new LS("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new we(new Hm(t.getProvider("auth-internal")),new Xm(t.getProvider("app-check-internal")),yF(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Ad(xC,MC,n),Ad(xC,MC,"esm2017")}var Eo=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ze.fromBase64String(e))}catch(t){throw new b(y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ze.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Xr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new b(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new We(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var tr=class{constructor(e){this._methodName=e}};var vl=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new b(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new b(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}};var P3=/^__.*__$/,Ov=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new hn(e,this.data,this.fieldMask,t,this.fieldTransforms):new $r(e,this.data,t,this.fieldTransforms)}},Xh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new hn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function QA(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Jh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Zh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(QA(this.dataSource)&&P3.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},kv=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Dl(e)}createContext(e,t,r,i=!1){return new Jh({dataSource:e,methodName:t,targetDoc:r,path:We.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ki(n){let e=n._freezeSettings(),t=Dl(n._databaseId);return new kv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Sd(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);RS("Data must be an object, but it was:",o,r);let a=JA(r,o),l,c;if(s.merge)l=new Lt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let h of s.mergeFields){let d=Fv(e,h,t);if(!o.contains(d))throw new b(y.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);eR(u,d)||u.push(d)}l=new Lt(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new Ov(new gt(a),l,c)}var Sl=class n extends tr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function YA(n,e,t){return new Jh({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var xv=class n extends tr{_toFieldTransform(e){return new Li(e.path,new Wr)}isEqual(e){return e instanceof n}},Mv=class n extends tr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=YA(this,e,!0),r=this._elements.map(s=>Wi(s,t)),i=new Zn(r);return new Li(e.path,i)}isEqual(e){return e instanceof n&&Id(this._elements,e._elements)}},Pv=class n extends tr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=YA(this,e,!0),r=this._elements.map(s=>Wi(s,t)),i=new er(r);return new Li(e.path,i)}isEqual(e){return e instanceof n&&Id(this._elements,e._elements)}},Lv=class n extends tr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Hr(e.serializer,LI(e.serializer,this._operand));return new Li(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function IS(n,e,t,r){let i=n.createContext(1,e,t);RS("Data must be an object, but it was:",i,r);let s=[],o=gt.empty();ji(r,(l,c)=>{let u=DS(e,l,t);c=je(c);let h=i.childContextForFieldPath(u);if(c instanceof Sl)s.push(u);else{let d=Wi(c,h);d!=null&&(s.push(u),o.set(u,d))}});let a=new Lt(s);return new Xh(o,a,i.fieldTransforms)}function AS(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[Fv(e,r,t)],l=[i];if(s.length%2!==0)throw new b(y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Fv(e,s[d])),l.push(s[d+1]);let c=[],u=gt.empty();for(let d=a.length-1;d>=0;--d)if(!eR(c,a[d])){let p=a[d],v=l[d];v=je(v);let S=o.childContextForFieldPath(p);if(v instanceof Sl)c.push(p);else{let E=Wi(v,S);E!=null&&(c.push(p),u.set(p,E))}}let h=new Lt(c);return new Xh(u,h,o.fieldTransforms)}function XA(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Wi(t,i)}function Wi(n,e){if(n=je(n),ZA(n))return RS("Unsupported field value:",e,n),JA(n,e);if(n instanceof tr)return F3(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return L3(n,e)}else return B3(n,e)}function JA(n,e){let t={};return uI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ji(n,(r,i)=>{let s=Wi(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function L3(n,e){let t=[],r=0;for(let i of n){let s=Wi(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function F3(n,e){if(!QA(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function B3(n,e){if(n=je(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return LI(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Me.fromDate(n);return{timestampValue:ho(e.serializer,t)}}else if(n instanceof Me){let t=new Me(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:ho(e.serializer,t)}}else{if(n instanceof vl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Eo)return{bytesValue:HI(e.serializer,n._byteString)};if(n instanceof Le){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:rS(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${Ol(n)}`)}}function ZA(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Me)&&!(n instanceof vl)&&!(n instanceof Eo)&&!(n instanceof Le)&&!(n instanceof tr)}function RS(n,e,t){if(!ZA(t)||!X4(t)){let r=Ol(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Fv(n,e,t){if(e=je(e),e instanceof Xr)return e._internalPath;if(typeof e=="string")return DS(n,e);throw Zh("Field path arguments must be of type string or ",n,!1,void 0,t)}var q3=new RegExp("[~\\*/\\[\\]]");function DS(n,e,t){if(e.search(q3)>=0)throw Zh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Xr(...e.split("."))._internalPath}catch{throw Zh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Zh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new b(y.INVALID_ARGUMENT,a+n+l)}function eR(n,e){return n.some(t=>t.isEqual(e))}var Vi=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new Bv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Td("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Bv=class extends Vi{data(){return super.data()}};function Td(n,e){return typeof e=="string"?DS(n,e):e instanceof Xr?e._internalPath:e._delegate._internalPath}function tR(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new b(y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Tl=class{},zi=class extends Tl{};function K6(n,e,...t){let r=[];e instanceof Tl&&r.push(e),r=r.concat(t),H3(r);for(let i of r)n=i._apply(n);return n}var ed=class n extends zi{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return rR(e._query,t),new it(e.firestore,e.converter,tS(e._query,t))}_parse(e){let t=Ki(e.firestore);return U3(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function W6(n,e,t){let r=e,i=Td("where",n);return ed._create(i,r,t)}var qv=class n extends Tl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ce.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(K3(e._query,t),new it(e.firestore,e.converter,tS(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Uv=class n extends zi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=V3(e._query,this._field,this._direction);return new it(e.firestore,e.converter,a2(e._query,t))}};function H6(n,e="asc"){let t=e,r=Td("orderBy",n);return Uv._create(r,t)}var td=class n extends zi{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new it(e.firestore,e.converter,_h(e._query,this._limit,this._limitType))}};function $6(n){return BA("limit",n),td._create("limit",n,"F")}function Q6(n){return BA("limitToLast",n),td._create("limitToLast",n,"L")}var nd=class n extends zi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=nR(e,this.type,this._docOrFields,this._inclusive);return new it(e.firestore,e.converter,l2(e._query,t))}};function Y6(...n){return nd._create("startAt",n,!0)}function X6(...n){return nd._create("startAfter",n,!1)}var rd=class n extends zi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=nR(e,this.type,this._docOrFields,this._inclusive);return new it(e.firestore,e.converter,c2(e._query,t))}};function J6(...n){return rd._create("endBefore",n,!1)}function Z6(...n){return rd._create("endAt",n,!0)}function nR(n,e,t,r){if(t[0]=je(t[0]),t[0]instanceof Vi)return z3(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Ki(n.firestore);return G3(n._query,n.firestore._databaseId,i,e,t,r)}}function U3(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new b(y.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){zb(o,s);let c=[];for(let u of o)c.push(Vb(r,n,u));a={arrayValue:{values:c}}}else a=Vb(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&zb(o,s),a=XA(t,e,o,s==="in"||s==="not-in");return J.create(i,s,a)}function V3(n,e,t){if(n.startAt!==null)throw new b(y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new b(y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Mi(e,t)}function z3(n,e,t,r,i){if(!r)throw new b(y.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of lo(n))if(o.field.isKeyField())s.push(xi(e,r.key));else{let a=r.data.field(o.field);if(hd(a))throw new b(y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new b(y.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new Bn(s,i)}function G3(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new b(y.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new b(y.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!eS(n)&&c.indexOf("/")!==-1)throw new b(y.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let h=n.path.child(te.fromString(c));if(!M.isDocumentKey(h))throw new b(y.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);let d=new M(h);a.push(xi(e,d))}else{let h=XA(t,r,c);a.push(h)}}return new Bn(a,s)}function Vb(n,e,t){if(t=je(t),typeof t=="string"){if(t==="")throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eS(e)&&t.indexOf("/")!==-1)throw new b(y.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(te.fromString(t));if(!M.isDocumentKey(r))throw new b(y.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xi(n,new M(r))}else{if(t instanceof Le)return xi(n,t._key);throw new b(y.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ol(t)}.`)}}function zb(n,e){if(!Array.isArray(n)||n.length===0)throw new b(y.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function j3(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function rR(n,e){let t=W3(n.filters,j3(e.op));if(t!==null)throw t===e.op?new b(y.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new b(y.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function K3(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)rR(t,i),t=tS(t,i)}function W3(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function H3(n){let e=n.filter(r=>r instanceof qv).length,t=n.filter(r=>r instanceof ed).length;if(e>1||e>0&&t>0)throw new b(y.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var id=class{convertValue(e,t="none"){switch(ki(e)){case 0:return null;case 1:return e.booleanValue;case 2:return De(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ji(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new vl(De(e.latitude),De(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Xv(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ja(e));default:return null}}convertTimestamp(e){let t=Jn(e);return new Me(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=te.fromString(e);q(iA(r));let i=new so(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||_e(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Ed(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var Vv=class extends id{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eo(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Le(this.firestore,null,t)}};function zv(n){return $3(n,["next","error","complete"])}function $3(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var nr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Jr=class extends Vi{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new wo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(Td("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},wo=class extends Jr{data(e={}){return super.data(e)}},Zr=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new nr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new wo(this._firestore,this._userDataWriter,r.key,r,new nr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new b(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Q3(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Q3(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new wo(n._firestore,n._userDataWriter,r.doc.key,r.doc,new nr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new wo(n._firestore,n._userDataWriter,r.doc.key,r.doc,new nr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Y3(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Y3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function e9(n,e){return n instanceof Jr&&e instanceof Jr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Zr&&e instanceof Zr?n._firestore===e._firestore&&N3(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function t9(n){n=oe(n,Le);let e=oe(n.firestore,we),t=st(e);return zA(t,n._key).then(r=>NS(e,n,r))}var rr=class extends id{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eo(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Le(this.firestore,null,t)}};function n9(n){n=oe(n,Le);let e=oe(n.firestore,we),t=st(e),r=new rr(e);return u3(t,n._key).then(i=>new Jr(e,r,n._key,i,new nr(i!==null&&i.hasLocalMutations,!0),n.converter))}function r9(n){n=oe(n,Le);let e=oe(n.firestore,we),t=st(e);return zA(t,n._key,{source:"server"}).then(r=>NS(e,n,r))}function i9(n){n=oe(n,it);let e=oe(n.firestore,we),t=st(e),r=new rr(e);return tR(n._query),GA(t,n._query).then(i=>new Zr(e,r,n,i))}function s9(n){n=oe(n,it);let e=oe(n.firestore,we),t=st(e),r=new rr(e);return h3(t,n._query).then(i=>new Zr(e,r,n,i))}function o9(n){n=oe(n,it);let e=oe(n.firestore,we),t=st(e),r=new rr(e);return GA(t,n._query,{source:"server"}).then(i=>new Zr(e,r,n,i))}function a9(n,e,t){n=oe(n,Le);let r=oe(n.firestore,we),i=Ed(n.converter,e,t),s=Ki(r),a=Sd(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Re.none());return wd(r,[a])}function l9(n,e,t,...r){n=oe(n,Le);let i=oe(n.firestore,we),s=Ki(i);e=je(e);let o;typeof e=="string"||e instanceof Xr?o=AS(s,"updateDoc",n._key,e,t,r):o=IS(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Re.exists(!0));return wd(i,[a])}function c9(n){let e=oe(n.firestore,we),t=[new Qr(n._key,Re.none())];return wd(e,t)}function u9(n,e){let t=oe(n.firestore,we),r=D3(n),i=Ed(n.converter,e),s=Ki(n.firestore),a=Sd(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Re.exists(!1));return wd(t,[a]).then(()=>r)}function h9(n,...e){var t,r,i;n=je(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!zv(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(zv(e[o])){let d=e[o];e[o]=(t=d.next)===null||t===void 0?void 0:t.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(i=d.complete)===null||i===void 0?void 0:i.bind(d)}let l,c,u;if(n instanceof Le)c=oe(n.firestore,we),u=Ao(n._key.path),l={next:d=>{e[o]&&e[o](NS(c,n,d))},error:e[o+1],complete:e[o+2]};else{let d=oe(n,it);c=oe(d.firestore,we),u=d._query;let p=new rr(c);l={next:v=>{e[o]&&e[o](new Zr(c,p,d,v))},error:e[o+1],complete:e[o+2]},tR(n._query)}let h=st(c);return c3(h,u,a,l)}function d9(n,e){n=oe(n,we);let t=st(n),r=zv(e)?e:{next:e};return f3(t,r)}function wd(n,e){let t=st(n);return d3(t,e)}function NS(n,e,t){let r=t.docs.get(e._key),i=new rr(n);return new Jr(n,i,e._key,r,new nr(t.hasPendingWrites,t.fromCache),e.converter)}var X3={maxAttempts:5};function J3(n){if(n.maxAttempts<1)throw new b(y.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Gb=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ki(e)}set(e,t,r){this._verifyNotCommitted();let i=Ur(e,this._firestore),s=Ed(i.converter,t,r),o=Sd(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Re.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Ur(e,this._firestore);t=je(t);let o;return typeof t=="string"||t instanceof Xr?o=AS(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=IS(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Re.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ur(e,this._firestore);return this._mutations=this._mutations.concat(new Qr(t._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new b(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ur(n,e){if(n=je(n),n.firestore!==e)throw new b(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Gv=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ki(e)}get(e){let t=Ur(e,this._firestore),r=new Vv(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return L();let s=i[0];if(s.isFoundDocument())return new Vi(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Vi(this._firestore,r,t._key,null,t.converter);throw L()})}set(e,t,r){let i=Ur(e,this._firestore),s=Ed(i.converter,t,r),o=Sd(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Ur(e,this._firestore);t=je(t);let o;return typeof t=="string"||t instanceof Xr?o=AS(this._dataReader,"Transaction.update",s._key,t,r,i):o=IS(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Ur(e,this._firestore);return this._transaction.delete(t._key),this}};var jv=class extends Gv{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ur(e,this._firestore),r=new rr(this._firestore);return super.get(e).then(i=>new Jr(this._firestore,r,t._key,i._document,new nr(!1,!1),t.converter))}};function f9(n,e,t){n=oe(n,we);let r=Object.assign(Object.assign({},X3),t);J3(r);let i=st(n);return p3(i,s=>e(new jv(n,s)),r)}function p9(){return new Sl("deleteField")}function g9(){return new xv("serverTimestamp")}function m9(...n){return new Mv("arrayUnion",n)}function y9(...n){return new Pv("arrayRemove",n)}function v9(n){return new Lv("increment",n)}M3("node");export{D6 as a,Pn as b,N6 as c,b as d,Me as e,We as f,M as g,O6 as h,so as i,Y4 as j,oe as k,R3 as l,Le as m,k6 as n,x6 as o,D3 as p,M6 as q,N3 as r,P6 as s,L6 as t,st as u,F6 as v,B6 as w,q6 as x,U6 as y,V6 as z,z6 as A,G6 as B,j6 as C,Eo as D,Xr as E,vl as F,K6 as G,W6 as H,H6 as I,$6 as J,Q6 as K,Y6 as L,X6 as M,J6 as N,Z6 as O,id as P,Jr as Q,wo as R,Zr as S,e9 as T,t9 as U,n9 as V,r9 as W,i9 as X,s9 as Y,o9 as Z,a9 as _,l9 as $,c9 as aa,u9 as ba,h9 as ca,d9 as da,wd as ea,Gb as fa,f9 as ga,p9 as ha,g9 as ia,m9 as ja,y9 as ka,v9 as la};
